(function(){var w=Alfresco.util.encodeHTML,q=Alfresco.util.combinePaths,B=Alfresco.util.siteURL,F=Alfresco.util.isValueSet;Alfresco.doclib.Actions={};Alfresco.doclib.Actions.prototype={actionsView:null,onRegisterAction:function H(K,J){var L=J[1];if(L&&F(L.actionName)&&F(L.fn)){this.registerAction(L.actionName,L.fn)}else{Alfresco.logger.error("DL_onRegisterAction: Custom action registion invalid: "+L)}},registerAction:function n(J,K){if(F(J)&&F(K)){this.constructor.prototype[J]=K;return true}return false},renderAction:function f(K,N){var J=Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/actions/",O='style="background-image:url('+J+'{icon}-16.png)" ',M={link:'<div class="{id}"><a title="{label}" class="simple-link" href="{href}" '+O+"{target}><span>{label}</span></a></div>",pagelink:'<div class="{id}"><a title="{label}" class="simple-link" href="{pageUrl}" '+O+"><span>{label}</span></a></div>",javascript:'<div class="{id}" title="{jsfunction}"><a title="{label}" class="action-link" href="#"'+O+"><span>{label}</span></a></div>"};N.actionParams[K.id]=K.params;var L={id:K.id,icon:K.icon,label:Alfresco.util.substituteDotNotation(this.msg(K.label),N)};if(K.type==="link"){if(K.params.href){L.href=Alfresco.util.substituteDotNotation(K.params.href,N);L.target=K.params.target?'target="'+K.params.target+'"':""}else{Alfresco.logger.warn("Action configuration error: Missing 'href' parameter for actionId: ",K.id)}}else{if(K.type==="pagelink"){if(K.params.page){L.pageUrl=B(Alfresco.util.substituteDotNotation(K.params.page,N))}else{Alfresco.logger.warn("Action configuration error: Missing 'page' parameter for actionId: ",K.id)}}else{if(K.type==="javascript"){if(K.params["function"]){L.jsfunction=K.params["function"]}else{Alfresco.logger.warn("Action configuration error: Missing 'function' parameter for actionId: ",K.id)}}}}return YAHOO.lang.substitute(M[K.type],L)},getActionUrls:function E(N,K){var L=N.jsNode,R=L.isLink?L.linkedNode.nodeRef:L.nodeRef,P=R.toString(),J=R.uri,M=L.contentURL,S=N.workingCopy||{},O=YAHOO.lang.isString(K)?{site:K}:null,Q=Alfresco.util.bind(function(T){return Alfresco.util.siteURL(T,O)},this);return({downloadUrl:q(Alfresco.constants.PROXY_URI,M)+"?a=true",viewUrl:q(Alfresco.constants.PROXY_URI,M)+'" target="_blank',documentDetailsUrl:Q("document-details?nodeRef="+P),folderDetailsUrl:Q("folder-details?nodeRef="+P),editMetadataUrl:Q("edit-metadata?nodeRef="+P),inlineEditUrl:Q("inline-edit?nodeRef="+P),managePermissionsUrl:Q("manage-permissions?nodeRef="+P),manageTranslationsUrl:Q("manage-translations?nodeRef="+P),workingCopyUrl:Q("document-details?nodeRef="+(S.workingCopyNodeRef||P)),workingCopySourceUrl:Q("document-details?nodeRef="+(S.sourceNodeRef||P)),viewGoogleDocUrl:S.googleDocUrl+'" target="_blank',explorerViewUrl:q(this.options.repositoryUrl,"/n/showSpaceDetails/",J)+'" target="_blank',sourceRepositoryUrl:this.viewInSourceRepositoryURL(N)+'" target="_blank'})},getAction:function e(K,J,O){var Q=J.getAttribute("class"),N=Alfresco.util.findInArray(K.actions,Q,"id")||{};if(O===false){return N}else{N=Alfresco.util.deepCopy(N);var P=N.params||{};for(var L in P){P[L]=YAHOO.lang.substitute(P[L],K,function M(S,T,R){return Alfresco.util.findValueByDotNotation(K,S)})}return N}},getParentNodeRef:function G(K){var N=null;if(YAHOO.lang.isArray(K)){try{N=this.doclistMetadata.parent.nodeRef}catch(O){N=null}if(N===null){for(var M=1,L=K.length,J=true;M<L&&J;M++){J=(K[M].parent.nodeRef==K[M-1].parent.nodeRef)}N=J?K[0].parent.nodeRef:this.doclistMetadata.container}}else{N=K.parent.nodeRef}return N},onActionDetails:function d(M){var S=this,O=M.nodeRef,L=M.jsNode;var Q=function J(U,V){var T='<span class="light">'+w(M.displayName)+"</span>";Alfresco.util.populateHTML([V.id+"-dialogTitle",S.msg("edit-details.title",T)]);this.widgets.editMetadata=Alfresco.util.createYUIButton(V,"editMetadata",null,{type:"link",label:S.msg("edit-details.label.edit-metadata"),href:B("edit-metadata?nodeRef="+O)})};var K=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&formId={formId}&showCancelButton=true",{itemKind:"node",itemId:O,mode:"edit",submitType:"json",formId:"doclib-simple-metadata"});var R=new Alfresco.module.SimpleDialog(this.id+"-editDetails-"+Alfresco.util.generateDomId());R.setOptions({width:"40em",templateUrl:K,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:Q,scope:this},onSuccess:{fn:function N(U){Alfresco.util.Ajax.request({url:q(Alfresco.constants.URL_SERVICECONTEXT,"components/documentlibrary/data/node/",L.nodeRef.uri)+"?view="+this.actionsView,successCallback:{fn:function V(X){var W=X.json.item;W.jsNode=new Alfresco.util.Node(X.json.item.node);YAHOO.Bubbling.fire(W.node.isContainer?"folderRenamed":"fileRenamed",{file:W});YAHOO.Bubbling.fire("tagRefresh");Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.success")})},scope:this},failureCallback:{fn:function T(W){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}})},scope:this},onFailure:{fn:function P(T){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.details.failure")})},scope:this}}).show()},onActionLocate:function s(J){var L=J.jsNode,M=J.location.path,K=L.isLink?L.linkedNode.properties.name:J.displayName;if(Alfresco.util.isValueSet(this.options.siteId)&&J.location.site.name!==this.options.siteId){window.location=B("documentlibrary?file="+encodeURIComponent(K)+"&path="+encodeURIComponent(M),{site:J.location.site.name})}else{this.options.highlightFile=K;YAHOO.Bubbling.fire("changeFilter",{filterId:"path",filterData:M})}},onActionDelete:function D(K){var N=this,M=K.jsNode;Alfresco.util.PopupManager.displayPrompt({title:this.msg("actions."+(M.isContainer?"folder":"document")+".delete"),text:this.msg("message.confirm.delete",K.displayName),buttons:[{text:this.msg("button.delete"),handler:function L(){this.destroy();N._onActionDeleteConfirm.call(N,K)}},{text:this.msg("button.cancel"),handler:function J(){this.destroy()},isDefault:true}]})},_onActionDeleteConfirm:function h(K){var N=K.jsNode,O=K.location.path,P=K.location.file,L=q(O,P),J=K.displayName,M=N.nodeRef;this.modules.actions.genericAction({success:{activity:{siteId:this.options.siteId,activityType:"file-deleted",page:"documentlibrary",activityData:{fileName:P,path:O,nodeRef:M.toString()}},event:{name:N.isContainer?"folderDeleted":"fileDeleted",obj:{path:L}},message:this.msg("message.delete.success",J)},failure:{message:this.msg("message.delete.failure",J)},webscript:{method:Alfresco.util.Ajax.DELETE,name:"file/node/{nodeRef}",params:{nodeRef:M.uri}}})},onActionEditOffline:function b(J){Alfresco.logger.error("onActionEditOffline","Abstract implementation not overridden")},onlineEditMimetypes:{"application/vnd.ms-excel":"Excel.Sheet","application/vnd.ms-powerpoint":"PowerPoint.Slide","application/msword":"Word.Document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel.Sheet","application/vnd.openxmlformats-officedocument.presentationml.presentation":"PowerPoint.Slide","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word.Document"},onActionEditOnline:function k(J){if(this._launchOnlineEditor(J)){YAHOO.Bubbling.fire("metadataRefresh")}},_launchOnlineEditor:function I(N){var S="SharePoint.OpenDocuments",K=N.jsNode,O=N.location,V=K.mimetype,L=null,M=null,J={xls:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",doc:"application/msword",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"};if(this.onlineEditMimetypes.hasOwnProperty(V)){L=this.onlineEditMimetypes[V]}else{var R=Alfresco.util.getFileExtension(N.location.file);if(R!==null){R=R.toLowerCase();if(J.hasOwnProperty(R)){V=J[R];if(this.onlineEditMimetypes.hasOwnProperty(V)){L=this.onlineEditMimetypes[V]}}}}if(L!==null){if(!Alfresco.util.isValueSet(N.onlineEditUrl)){var Q=this.doclistMetadata.custom.vtiServer.host+":"+this.doclistMetadata.custom.vtiServer.port+"/"+q("alfresco",O.site.name,O.container.name,O.path,O.file);if(!(/^(http|https):\/\//).test(Q)){Q=window.location.protocol+"//"+Q}N.onlineEditUrl=Q}try{M=new ActiveXObject(S+".3");return M.EditDocument3(window,N.onlineEditUrl,true,L)}catch(P){try{M=new ActiveXObject(S+".2");return M.EditDocument2(window,N.onlineEditUrl,L)}catch(U){try{M=new ActiveXObject(S+".1");return M.EditDocument(N.onlineEditUrl,L)}catch(T){}}}}return window.open(N.onlineEditUrl,"_blank")},onActionCheckoutToGoogleDocs:function C(J){Alfresco.logger.error("onActionCheckoutToGoogleDocs","Abstract implementation not overridden")},onActionCheckinFromGoogleDocs:function z(J){Alfresco.logger.error("onActionCheckinFromGoogleDocs","Abstract implementation not overridden")},onActionSimpleRepoAction:function m(L,J){var N=this.getAction(L,J).params,K=L.displayName;var M={success:{event:{name:"metadataRefresh",obj:L}},failure:{message:this.msg(N.failureMessage,K)},webscript:{method:Alfresco.util.Ajax.POST,stem:Alfresco.constants.PROXY_URI+"api/",name:"actionQueue"},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{actionedUponNode:L.nodeRef,actionDefinitionName:N.action}}};if(YAHOO.lang.isFunction(this[N.success])){M.success.callback={fn:this[N.success],obj:L,scope:this}}if(N.successMessage){M.success.message=this.msg(N.successMessage,K)}if(YAHOO.lang.isFunction(this[N.failure])){M.failure.callback={fn:this[N.failure],obj:L,scope:this}}if(N.failureMessage){M.failure.message=this.msg(N.failureMessage,K)}this.modules.actions.genericAction(M)},onActionFormDialog:function i(L,J){var N=this.getAction(L,J),P=N.params,M={title:this.msg(N.label)},K=L.displayName;delete P["function"];var O=P.success;delete P.success;M.success={fn:function(Q,R){if(YAHOO.lang.isFunction(this[O])){this[O].call(this,Q,R)}YAHOO.Bubbling.fire("metadataRefresh",R)},obj:L,scope:this};if(P.successMessage){M.successMessage=this.msg(P.successMessage,K);delete P.successMessage}if(YAHOO.lang.isFunction(this[P.failure])){M.failure={fn:this[P.failure],obj:L,scope:this};delete P.failure}if(P.failureMessage){M.failureMessage=this.msg(P.failureMessage,K);delete P.failureMessage}M.properties=P;Alfresco.util.PopupManager.displayForm(M)},onActionUploadNewVersion:function y(L){var Q=L.jsNode,K=L.displayName,N=Q.nodeRef,J=L.version;if(!this.fileUpload){this.fileUpload=Alfresco.getFileUploadInstance()}var P=this.msg("label.filter-description",K),M="*";if(K&&new RegExp(/[^\.]+\.[^\.]+/).exec(K)){M="*"+K.substring(K.lastIndexOf("."))}if(L.workingCopy&&L.workingCopy.workingCopyVersion){J=L.workingCopy.workingCopyVersion}var O={updateNodeRef:N.toString(),updateFilename:K,updateVersion:J,overwrite:true,filter:[{description:P,extensions:M}],mode:this.fileUpload.MODE_SINGLE_UPDATE,onFileUploadComplete:{fn:this.onNewVersionUploadComplete,scope:this}};if(Alfresco.util.isValueSet(this.options.siteId)){O.siteId=this.options.siteId;O.containerId=this.options.containerId}this.fileUpload.show(O)},_uploadComplete:function A(J,N){var O=J.successful.length,K,M;if(O>0){if(O<(this.options.groupActivitiesAt||5)){for(var L=0;L<O;L++){M=J.successful[L];K={fileName:M.fileName,nodeRef:M.nodeRef};this.modules.actions.postActivity(this.options.siteId,"file-"+N,"document-details",K)}}else{K={fileCount:O,path:this.currentPath,parentNodeRef:this.doclistMetadata.parent.nodeRef};this.modules.actions.postActivity(this.options.siteId,"files-"+N,"documentlibrary",K)}}},onFileUploadComplete:function u(J){this._uploadComplete(J,"added")},onNewVersionUploadComplete:function a(J){this._uploadComplete(J,"updated")},onActionCancelEditing:function v(K){var J=K.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},message:this.msg("message.edit-cancel.success",J)},failure:{message:this.msg("message.edit-cancel.failure",J)},webscript:{method:Alfresco.util.Ajax.POST,name:"cancel-checkout/node/{nodeRef}",params:{nodeRef:K.jsNode.nodeRef.uri}}})},onActionCopyTo:function p(J){this._copyMoveTo("copy",J)},onActionMoveTo:function t(J){this._copyMoveTo("move",J)},_copyMoveTo:function l(L,K){if(!L in {copy:true,move:true}){throw new Error("'"+L+"' is not a valid Copy/Move to mode.")}if(!this.modules.copyMoveTo){this.modules.copyMoveTo=new Alfresco.module.DoclibCopyMoveTo(this.id+"-copyMoveTo")}var J=[Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE];if(this.options.repositoryBrowsing===true){J.push(Alfresco.module.DoclibGlobalFolder.VIEW_MODE_REPOSITORY,Alfresco.module.DoclibGlobalFolder.VIEW_MODE_USERHOME)}this.modules.copyMoveTo.setOptions({allowedViewModes:J,mode:L,siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:K,rootNode:this.options.rootNode,parentId:this.getParentNodeRef(K)}).showDialog()},onActionAssignWorkflow:function r(K){var O="",J=this.getParentNodeRef(K);if(YAHOO.lang.isArray(K)){for(var M=0,L=K.length;M<L;M++){O+=(M===0?"":",")+K[M].nodeRef}}else{O=K.nodeRef}var N={selectedItems:O};if(J){N.destination=J}Alfresco.util.navigateTo(B("start-workflow"),"POST",N)},onActionManagePermissions:function o(J){if(!this.modules.permissions){this.modules.permissions=new Alfresco.module.DoclibPermissions(this.id+"-permissions")}this.modules.permissions.setOptions({siteId:this.options.siteId,containerId:this.options.containerId,path:this.currentPath,files:J}).showDialog()},onActionManageAspects:function j(J){if(!this.modules.aspects){this.modules.aspects=new Alfresco.module.DoclibAspects(this.id+"-aspects")}this.modules.aspects.setOptions({file:J}).show()},onActionChangeType:function g(N){var J=N.jsNode,O=J.type,Q=N.displayName,K=Alfresco.constants.PROXY_URI+q("slingshot/doclib/type/node",J.nodeRef.uri);var R=function M(T){T.addValidation(this.id+"-changeType-type",function S(Z,V,Y,X,U,W){return Z.options[Z.selectedIndex].value!=="-"},null,"change");T.setShowSubmitStateDynamically(true,false)};this.modules.changeType=new Alfresco.module.SimpleDialog(this.id+"-changeType").setOptions({width:"30em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/change-type?currentType="+encodeURIComponent(O),actionUrl:K,doSetupFormsValidation:{fn:R,scope:this},firstFocus:this.id+"-changeType-type",onSuccess:{fn:function P(S){YAHOO.Bubbling.fire("metadataRefresh",{highlightFile:Q});Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.success",Q)})},scope:this},onFailure:{fn:function L(S){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.change-type.failure",Q)})},scope:this}});this.modules.changeType.show()},viewInSourceRepositoryURL:function x(L){var M=L.node,K=L.location.repositoryId,J=this.options.replicationUrlMapping,N;if(!K||!J||!J[K]){return"#"}N=this.getActionUrls(L)[M.isContainer?"folderDetailsUrl":"documentDetailsUrl"];N=N.substring(Alfresco.constants.URL_CONTEXT.length);return q(J[K],"/",N)},onActionPublish:function c(J){Alfresco.module.getSocialPublishingInstance().show({nodeRef:J.nodeRef,filename:J.fileName})}}})();(function(){var j=YAHOO.util.Dom,a=YAHOO.util.Selector,d=YAHOO.util.KeyListener;Alfresco.module.SimpleDialog=function(o,p){p=YAHOO.lang.isArray(p)?p:[];this.isFormOwner=false;if(o!=="null"){this.formsServiceDeferred=new Alfresco.util.Deferred(["onTemplateLoaded","onBeforeFormRuntimeInit"],{fn:this._showDialog,scope:this});YAHOO.Bubbling.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this)}return Alfresco.module.SimpleDialog.superclass.constructor.call(this,"Alfresco.module.SimpleDialog",o,["button","container","connection","json","selector"].concat(p))};YAHOO.extend(Alfresco.module.SimpleDialog,Alfresco.component.Base,{dialog:null,form:null,isFormOwner:null,options:{templateUrl:null,actionUrl:null,firstFocus:null,onSuccess:{fn:null,obj:null,scope:window},onSuccessMessage:"",onFailure:{fn:null,obj:null,scope:window},onFailureMessage:"",doBeforeDialogShow:{fn:null,obj:null,scope:null},doSetupFormsValidation:{fn:null,obj:null,scope:null},doBeforeFormSubmit:{fn:null,obj:null,scope:window},doBeforeAjaxRequest:{fn:null,obj:null,scope:window},width:"30em",clearForm:false,destroyOnHide:false},show:function b(){if(this.dialog){this._showDialog()}else{var o={htmlid:this.id};if(this.options.templateRequestParams){o=YAHOO.lang.merge(this.options.templateRequestParams,o)}Alfresco.util.Ajax.request({url:this.options.templateUrl,dataObj:o,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load dialog template from '"+this.options.templateUrl+"'.",scope:this,execScripts:true})}return this},_showDialog:function e(){var o=j.get(this.id+"-form");j.addClass(o,"bd");var x=this.options.doSetupFormsValidation;if(typeof x.fn=="function"){x.fn.call(x.scope||this,this.form,x.obj)}var q=this.options.doBeforeFormSubmit;if(typeof q.fn=="function"){this.form.doBeforeFormSubmit=q}else{this.form.doBeforeFormSubmit={fn:function p(){this.widgets.okButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true)},scope:this}}var s=this.options.doBeforeAjaxRequest;if(typeof s.fn=="function"){this.form.doBeforeAjaxRequest=s}if(this.options.actionUrl!==null){o.attributes.action.nodeValue=this.options.actionUrl}if(this.options.clearForm){var u=a.query("input",o),v;u=u.concat(a.query("textarea",o));for(var t=0,r=u.length;t<r;t++){v=u[t];if(v.getAttribute("type")!="radio"&&v.getAttribute("type")!="checkbox"&&v.getAttribute("type")!="hidden"){v.value=""}}}var w=this.options.doBeforeDialogShow;if(w&&typeof w.fn=="function"){w.fn.call(w.scope||this,this.form,this,w.obj)}if(this.isFormOwner){this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false)}this.form.updateSubmitElements();this.dialog.show();Alfresco.util.caretFix(o);this.form.applyTabFix();this.widgets.escapeListener=new d(document,{keys:d.KEY.ESCAPE},{fn:function(z,y){this.hide()},scope:this,correctScope:true});this.widgets.escapeListener.enable();if(this.options.firstFocus!==null){j.get(this.options.firstFocus).focus()}},hide:function k(){if(this.dialog){this.dialog.hide()}},_hideDialog:function g(){this.dialog.hideEvent.unsubscribe(this.onHideEvent,null,this);if(this.widgets.escapeListener){this.widgets.escapeListener.disable()}var o=j.get(this.id+"-form");Alfresco.util.undoCaretFix(o);if(this.options.destroyOnHide){YAHOO.Bubbling.fire("formContainerDestroyed");YAHOO.Bubbling.unsubscribe("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit);this.dialog.destroy();delete this.dialog;delete this.widgets;if(this.isFormOwner){delete this.form}}},onHideEvent:function n(p,o){YAHOO.lang.later(0,this,this._hideDialog)},onTemplateLoaded:function f(o){var q=document.createElement("div");q.innerHTML=o.serverResponse.responseText;var p=j.getFirstChild(q);while(p&&p.tagName.toLowerCase()!="div"){p=j.getNextSibling(p)}this.dialog=Alfresco.util.createYUIPanel(p,{width:this.options.width});this.dialog.hideEvent.subscribe(this.onHideEvent,null,this);if(j.get(this.id+"-form-submit")){this.isFormOwner=false;this.formsServiceDeferred.fulfil("onTemplateLoaded")}else{this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok",null,{type:"submit"});this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel",this.onCancel);this.isFormOwner=true;this.form=new Alfresco.forms.Form(this.id+"-form");this.form.setSubmitElements(this.widgets.okButton);this.form.setAJAXSubmit(true,{successCallback:{fn:this.onSuccess,scope:this},failureCallback:{fn:this.onFailure,scope:this}});this.form.setSubmitAsJSON(true);this.form.setShowSubmitStateDynamically(true,false);this.form.init();this._showDialog()}},onBeforeFormRuntimeInit:function c(p,o){var q=o[1].component,r=o[1].runtime;this.widgets.okButton=q.buttons.submit;this.widgets.okButton.set("label",this.msg("button.save"));this.widgets.cancelButton=q.buttons.cancel;this.widgets.cancelButton.set("onclick",{fn:this.onCancel,scope:this});this.form=r;this.form.setAJAXSubmit(true,{successCallback:{fn:this.onSuccess,scope:this},failureCallback:{fn:this.onFailure,scope:this}});this.formsServiceDeferred.fulfil("onBeforeFormRuntimeInit")},onCancel:function h(o,p){this.hide()},onSuccess:function i(o){this.hide();if(!o){if(this.options.onFailure&&typeof this.options.onFailure.fn=="function"){this.options.onFailure.fn.call(this.options.onFailure.scope,null,this.options.onFailure.obj)}else{Alfresco.util.PopupManager.displayMessage({text:this.options.failureMessage||"Operation failed."})}}else{if(this.options.onSuccess&&typeof this.options.onSuccess.fn=="function"){this.options.onSuccess.fn.call(this.options.onSuccess.scope,o,this.options.onSuccess.obj)}else{Alfresco.util.PopupManager.displayMessage({text:this.options.successMessage||"Operation succeeded."})}}},onFailure:function m(o){if(this.isFormOwner){this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false)}this.form.updateSubmitElements();if(typeof this.options.onFailure.fn=="function"){this.options.onFailure.fn.call(this.options.onFailure.scope,o,this.options.onFailure.obj)}else{if(o.json&&o.json.message&&o.json.status.name){Alfresco.util.PopupManager.displayPrompt({title:o.json.status.name,text:o.json.message})}else{Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:o.serverResponse})}}}});var l=new Alfresco.module.SimpleDialog("null")})();(function(){var b=YAHOO.util.Dom,B=YAHOO.util.Event,q=YAHOO.util.KeyListener,v=YAHOO.util.Selector;var s=Alfresco.util.encodeHTML,p=Alfresco.util.combinePaths,z=Alfresco.util.hasEventInterest;Alfresco.module.DoclibGlobalFolder=function(C){Alfresco.module.DoclibGlobalFolder.superclass.constructor.call(this,"Alfresco.module.DoclibGlobalFolder",C,["button","container","connection","json","treeview"]);this.containers={};if(C!="null"){this.eventGroup=C;YAHOO.Bubbling.on("siteChanged",this.onSiteChanged,this);YAHOO.Bubbling.on("containerChanged",this.onContainerChanged,this)}return this};var x=Alfresco.module.DoclibGlobalFolder;YAHOO.lang.augmentObject(x,{VIEW_MODE_SITE:0,VIEW_MODE_REPOSITORY:1,VIEW_MODE_USERHOME:2});YAHOO.extend(Alfresco.module.DoclibGlobalFolder,Alfresco.component.Base,{options:{siteId:"",siteTitle:"",containerId:"documentLibrary",containerType:"cm:folder",rootNode:"alfresco://company/home",userHome:"alfresco://user/home",path:"",pathNodeRef:null,width:"60em",files:null,templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/global-folder",viewMode:x.VIEW_MODE_SITE,allowedViewModes:[x.VIEW_MODE_SITE,x.VIEW_MODE_REPOSITORY,x.VIEW_MODE_USERHOME],evaluateChildFoldersSite:true,maximumFolderCountSite:-1,evaluateChildFoldersRepo:true,maximumFolderCountRepo:-1,siteTreeContainerTypes:{}},containerDiv:null,pathsToExpand:null,selectedNode:null,containers:null,showDialog:function k(){if(!this.containerDiv){Alfresco.util.Ajax.request({url:this.options.templateUrl,dataObj:{htmlid:this.id},successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load 'global-folder' template:"+this.options.templateUrl,execScripts:true})}else{this._beforeShowDialog()}},onTemplateLoaded:function m(D){var H=this;this.containerDiv=document.createElement("div");this.containerDiv.setAttribute("style","display:none");this.containerDiv.innerHTML=D.serverResponse.responseText;var F=b.getFirstChild(this.containerDiv);this.widgets.dialog=Alfresco.util.createYUIPanel(F,{width:this.options.width});this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok",this.onOK);this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel",this.onCancel);var J=new YAHOO.widget.ButtonGroup(this.id+"-modeGroup");J.on("checkedButtonChange",this.onViewModeChange,this.widgets.modeButtons,this);this.widgets.modeButtons=J;var G=this.widgets.modeButtons.getButtons(),I=function(K){if(q.KEY.ENTER==K.keyCode){this.set("checked",true)}};for(var E=0;E<G.length;E++){G[E].addListener("keydown",I)}this.fnLoadNodeData=function C(O,L){var M=O.data.path;var N=H._buildTreeNodeUrl.call(H,M);var Q={success:function K(U){var T=Alfresco.util.parseJSON(U.responseText);if(T.parent){if(O.data.nodeRef.indexOf("alfresco://")===0){O.data.nodeRef=T.parent.nodeRef}if(typeof O.data.userAccess=="undefined"){O.data.userAccess=T.parent.userAccess;O.setUpLabel({label:O.label,style:T.parent.userAccess.create?"":"no-permission"})}}if(T.items){var V,W;for(var S=0,R=T.items.length;S<R;S++){V=T.items[S];W=new YAHOO.widget.TextNode({label:s(V.name),path:p(M,V.name),nodeRef:V.nodeRef,description:V.description,userAccess:V.userAccess,style:V.userAccess.create?"":"no-permission"},O,false);if(!V.hasChildren){W.isLeaf=true}}if(T.resultsTrimmed){W=new YAHOO.widget.TextNode({label:"&lt;"+this.msg("message.folders-trimmed")+"&gt;",style:"folders-trimmed"},O,false)}}U.argument.fnLoadComplete()},failure:function P(U){try{var T=YAHOO.lang.JSON.parse(U.responseText);var S=this.widgets.treeview.getRoot();var R=S.children[0];R.isLoading=false;R.isLeaf=true;R.label=T.message;R.labelStyle="ygtverror";S.refresh()}catch(V){}},scope:H,argument:{node:O,fnLoadComplete:L},timeout:7000};YAHOO.util.Connect.asyncRequest("GET",N,Q)};this._beforeShowDialog()},_beforeShowDialog:function r(){if(this.options.pathNodeRef){var C=Alfresco.constants.PROXY_URI+"slingshot/doclib/node/"+this.options.pathNodeRef.uri+"/location";if(this.options.rootNode){C+="?libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}Alfresco.util.Ajax.jsonGet({url:C,successCallback:{fn:function(E){if(E.json!==undefined){var D=E.json;if(D.site){this.options.viewMode=x.VIEW_MODE_SITE;this.options.path=p(D.site.path,D.site.file);this.options.siteId=D.site.site;this.options.siteTitle=D.site.siteTitle}else{this.options.viewMode=x.VIEW_MODE_REPOSITORY;this.options.path=p(D.repo.path,D.repo.file);this.options.siteId=null;this.options.siteTitle=null}this._showDialog()}},scope:this},failureMessage:this.msg("message.failure")})}else{this._showDialog()}},_showDialog:function o(){this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false);var G=b.get(this.id+"-title");if(this.options.title){G.innerHTML=this.options.title}else{if(YAHOO.lang.isArray(this.options.files)){G.innerHTML=this.msg("title.multi",this.options.files.length)}else{G.innerHTML=this.msg("title.single",'<span class="light">'+s(this.options.files.displayName)+"</span>")}}var C=Alfresco.util.arrayToObject(this.options.allowedViewModes),H=this.widgets.modeButtons.getButtons(),I,E;if(!(this.options.viewMode in C)){this.options.viewMode=this.options.allowedViewModes[0]}for(var D=0,F=H.length;D<F;D++){I=H[D];E=parseInt(I.get("name"),10);I.set("disabled",!(E in C));I.setStyle("display",E in C?"block":"none");if(E==this.options.viewMode){if(I.get("checked")){this.setViewMode(E)}else{I.set("checked",true)}}}if(!this.widgets.escapeListener){this.widgets.escapeListener=new q(document,{keys:q.KEY.ESCAPE},{fn:function(K,J){this.onCancel()},scope:this,correctScope:true})}this.widgets.escapeListener.enable();this.widgets.dialog.show()},setViewMode:function i(C){this.options.viewMode=C;if(C==x.VIEW_MODE_SITE){b.removeClass(this.id+"-wrapper","repository-mode");this._populateSitePicker()}else{b.addClass(this.id+"-wrapper","repository-mode");this._buildTree(C==x.VIEW_MODE_USERHOME?this.options.userHome:this.options.rootNode);this.onPathChanged(this.options.path?this.options.path:"/")}},onSiteChanged:function y(H,F){if(z(this,F)){var J=F[1];if(J!==null){if(J.site!==null){this.options.siteId=J.site;this.options.siteTitle=J.siteTitle;this._populateContainerPicker();var I=v.query("a",this.id+"-sitePicker"),E,G,D,C=b.get(this.id+"-sitePicker");for(G=0,D=I.length;G<D;G++){E=I[G];if(E.getAttribute("rel")==J.site){b.addClass(E,"selected");if(J.scrollTo){C.scrollTop=b.getY(E)-b.getY(C)}}else{b.removeClass(E,"selected")}}}}}},onContainerChanged:function f(H,F){if(z(this,F)){var J=F[1];if(J!==null){if(J.container!==null){this.options.containerId=J.container;this.options.containerType=this.containers[J.container].type;this._buildTree(this.containers[J.container].nodeRef);this.onPathChanged(this.options.path);var I=v.query("a",this.id+"-containerPicker"),C,G,E,D=b.get(this.id+"-containerPicker");for(G=0,E=I.length;G<E;G++){C=I[G];if(C.getAttribute("rel")==J.container){b.addClass(C,"selected");if(J.scrollTo){D.scrollTop=b.getY(C)-b.getY(D)}}else{b.removeClass(C,"selected")}}}}}},onOK:function j(D,E){this.widgets.escapeListener.disable();this.widgets.dialog.hide();var C=this.selectedNode?this.selectedNode.data:null;if(C&&this.options.viewMode==x.VIEW_MODE_SITE){C.siteId=this.options.siteId;C.siteTitle=this.options.siteTitle;C.containerId=this.options.containerId}YAHOO.Bubbling.fire("folderSelected",{selectedFolder:C,eventGroup:this})},onCancel:function a(C,D){this.widgets.escapeListener.disable();this.widgets.dialog.hide()},onViewModeChange:function l(E,F){var D=this.options.viewMode;try{D=parseInt(E.newValue.get("name"),10);this.setViewMode(D)}catch(C){}},onExpandComplete:function h(F){Alfresco.logger.debug("DLGF_onExpandComplete");this.widgets.treeview.render();this._showHighlight(true);if(this.pathsToExpand&&this.pathsToExpand.length>0){var E=this.widgets.treeview.getNodeByProperty("path",this.pathsToExpand.shift());if(E!==null){var D=E.getContentEl(),C=b.get(this.id+"-treeview");C.scrollTop=b.getY(D)-(C.scrollHeight/3);if(E.data.path==this.currentPath){this._updateSelectedNode(E)}E.expand()}}},onNodeClicked:function u(D){Alfresco.logger.debug("DLGF_onNodeClicked");var F=D.event,E=D.node,C=E.data.userAccess;if((C&&C.create)||(E.data.nodeRef=="")||(E.data.nodeRef.indexOf("alfresco://")===0)){this.onPathChanged(E.data.path);this._updateSelectedNode(E)}B.preventDefault(F);return false},onPathChanged:function d(G){Alfresco.logger.debug("DLGF_onPathChanged:"+G);if(G.charAt(0)!="/"){G="/"+G}this.currentPath=G;var F=this.widgets.treeview.getNodeByProperty("path",G);if(F!==null){this._updateSelectedNode(F);F.expand();while(F.parent!==null){F=F.parent;F.expand()}return}var H=G.split("/"),E="/";if(G==="/"){H=[""]}this.pathsToExpand=[];for(var D=0,C=H.length;D<C;D++){E=p("/",E,H[D]);this.pathsToExpand.push(E)}Alfresco.logger.debug("DLGF_onPathChanged paths to expand:"+this.pathsToExpand.join(","));do{F=this.widgets.treeview.getNodeByProperty("path",this.pathsToExpand.shift())}while(this.pathsToExpand.length>0&&F.expanded);if(F!==null){F.expand()}},_populateSitePicker:function w(){var D=b.get(this.id+"-sitePicker"),G=this;D.innerHTML="";var F=function C(J,N){var O=J.json,L,H,M,K,Q=null;var P=function I(R){return function(){YAHOO.Bubbling.fire("siteChanged",{site:R.shortName,siteTitle:R.title,eventGroup:G});return false}};if(O.length>0){Q=O[0]}for(M=0,K=O.length;M<K;M++){H=O[M];L=document.createElement("div");if(M==K-1){b.addClass(L,"last")}L.innerHTML='<a rel="'+H.shortName+'" href="#""><h4>'+s(H.title)+"</h4><span>"+s(H.description)+"</span></a>";L.onclick=P(H);N.appendChild(L)}YAHOO.Bubbling.fire("siteChanged",{site:(this.options.siteId&&this.options.siteId.length>0)?this.options.siteId:Q.shortName,siteTitle:(this.options.siteId&&this.options.siteId.length>0)?this.options.siteTitle:Q.title,eventGroup:this,scrollTo:true})};var E={url:Alfresco.constants.PROXY_URI+"api/sites",responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:F,scope:this,obj:D},failureCallback:null};Alfresco.util.Ajax.request(E)},_populateContainerPicker:function e(){var G=b.get(this.id+"-containerPicker"),F=this;G.innerHTML="";var E=function C(J,O){var I=J.json.containers,L,H,M,K;this.containers={};var P=function N(Q){return function(){YAHOO.Bubbling.fire("containerChanged",{container:Q,eventGroup:F});return false}};for(M=0,K=I.length;M<K;M++){H=I[M];this.containers[H.name]=H;L=document.createElement("div");if(M==K-1){b.addClass(L,"last")}L.innerHTML='<a rel="'+H.name+'" href="#"><h4>'+H.name+"</h4><span>"+H.description+"</span></a>";L.onclick=P(H.name);O.appendChild(L)}YAHOO.Bubbling.fire("containerChanged",{container:this.options.containerId,eventGroup:this,scrollTo:true})};var D={url:Alfresco.constants.PROXY_URI+"slingshot/doclib/containers/"+this.options.siteId,responseContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:E,scope:this,obj:G},failureCallback:null};Alfresco.util.Ajax.request(D)},_buildTree:function g(F){Alfresco.logger.debug("DLGF__buildTree");var C=new YAHOO.widget.TreeView(this.id+"-treeview");this.widgets.treeview=C;YAHOO.widget.TreeView.FOCUS_CLASS_NAME="";C.setDynamicLoad(this.fnLoadNodeData);var D="location.path.repository";if(this.options.viewMode==x.VIEW_MODE_SITE){var E=this.options.siteTreeContainerTypes[this.options.containerType]||{};D=E.rootLabel||"location.path.documents"}else{if(this.options.viewMode==x.VIEW_MODE_USERHOME){D="location.path.userHome"}}var G=new YAHOO.widget.TextNode({label:this.msg(D),path:"/",nodeRef:F},C.getRoot(),false);C.subscribe("clickEvent",this.onNodeClicked,this,true);C.subscribe("expandComplete",this.onExpandComplete,this,true);C.render()},_showHighlight:function n(C){Alfresco.logger.debug("DLGF__showHighlight");if(this.selectedNode!==null){if(C){b.addClass(this.selectedNode.getEl(),"selected")}else{b.removeClass(this.selectedNode.getEl(),"selected")}}},_updateSelectedNode:function t(C){Alfresco.logger.debug("DLGF__updateSelectedNode");this._showHighlight(false);this.selectedNode=C;this._showHighlight(true)},_buildTreeNodeUrl:function c(E){var F=Alfresco.constants.PROXY_URI;if(this.options.viewMode==x.VIEW_MODE_SITE){var C=this.options.siteTreeContainerTypes[this.options.containerType]||{};if(C.uri){F+=C.uri}else{F+="slingshot/doclib/treenode/site/{site}/{container}{path}";F+="?children={evaluateChildFoldersSite}";F+="&max={maximumFolderCountSite}"}}else{if(this.options.viewMode==x.VIEW_MODE_USERHOME){F+="slingshot/doclib/treenode/node/{userHome}{path}";F+="?children={evaluateChildFoldersRepo}"}else{F+="slingshot/doclib/treenode/node/alfresco/company/home{path}";F+="?children={evaluateChildFoldersRepo}";F+="&libraryRoot={rootNode}"}F+="&max={maximumFolderCountRepo}"}var D=YAHOO.lang.substitute(F,{site:encodeURIComponent(this.options.siteId),container:encodeURIComponent(this.options.containerId),rootNode:this.options.rootNode,userHome:(this.options.userHome||"").replace(":/",""),path:Alfresco.util.encodeURIPath(E),evaluateChildFoldersSite:this.options.evaluateChildFoldersSite+"",maximumFolderCountSite:this.options.maximumFolderCountSite,evaluateChildFoldersRepo:this.options.evaluateChildFoldersRepo+"",maximumFolderCountRepo:this.options.maximumFolderCountRepo});return D}});var A=new Alfresco.module.DoclibGlobalFolder("null")})();(function(){Alfresco.module.DoclibCopyMoveTo=function(h){Alfresco.module.DoclibCopyMoveTo.superclass.constructor.call(this,h);this.name="Alfresco.module.DoclibCopyMoveTo";Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,{allowedViewModes:[Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE,Alfresco.module.DoclibGlobalFolder.VIEW_MODE_REPOSITORY,Alfresco.module.DoclibGlobalFolder.VIEW_MODE_USERHOME],extendedTemplateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/copy-move-to"});return this};YAHOO.extend(Alfresco.module.DoclibCopyMoveTo,Alfresco.module.DoclibGlobalFolder,{setOptions:function g(j){var h={};if(typeof j.mode!=="undefined"){var i={copy:"copy-to",move:"move-to"};if(typeof i[j.mode]=="undefined"){throw new Error("Alfresco.module.CopyMoveTo: Invalid mode '"+j.mode+"'")}h.dataWebScript=i[j.mode]}h.viewMode=Alfresco.util.isValueSet(this.options.siteId)?Alfresco.module.DoclibGlobalFolder.VIEW_MODE_SITE:Alfresco.module.DoclibGlobalFolder.VIEW_MODE_REPOSITORY;this.modules.actions=new Alfresco.module.DoclibActions();return Alfresco.module.DoclibCopyMoveTo.superclass.setOptions.call(this,YAHOO.lang.merge(h,j))},onTemplateLoaded:function a(h){Alfresco.util.Ajax.request({url:this.options.extendedTemplateUrl,dataObj:{htmlid:this.id},successCallback:{fn:this.onExtendedTemplateLoaded,obj:h,scope:this},failureMessage:"Could not load 'copy-move-to' template:"+this.options.extendedTemplateUrl,execScripts:true})},onExtendedTemplateLoaded:function c(h,i){Alfresco.module.DoclibCopyMoveTo.superclass.onTemplateLoaded.call(this,i)},onOK:function d(q,v){var k,w=[],n,p,o,m={copy:"Copied",move:"Moved"};if(YAHOO.lang.isArray(this.options.files)){k=this.options.files}else{k=[this.options.files]}for(p=0,o=k.length;p<o;p++){w.push(k[p].node.nodeRef)}var u=function s(A){var x,B=A.json.successCount,C=A.json.failureCount;this.widgets.dialog.hide();if(!A.json.overallSuccess){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")});return}YAHOO.Bubbling.fire("files"+m[this.options.mode],{destination:this.currentPath,successCount:B,failureCount:C});for(var z=0,y=A.json.totalResults;z<y;z++){x=A.json.results[z];if(x.success){YAHOO.Bubbling.fire((x.type=="folder"?"folder":"file")+m[this.options.mode],{multiple:true,nodeRef:x.nodeRef,destination:this.currentPath})}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.success",B)})};var l=function h(i){this.widgets.dialog.hide();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.failure")})};var r=this.options.dataWebScript+"/node/{nodeRef}",t=new Alfresco.util.NodeRef(this.selectedNode.data.nodeRef);this.modules.actions.genericAction({success:{callback:{fn:u,scope:this}},failure:{callback:{fn:l,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:r,params:{nodeRef:t.uri}},wait:{message:this.msg("message.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:w,parentId:this.options.parentId}}});this.widgets.okButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true)},msg:function b(i){var h=Alfresco.util.message.call(this,this.options.mode+"."+i,this.name,Array.prototype.slice.call(arguments).slice(1));if(h==(this.options.mode+"."+i)){h=Alfresco.util.message.call(this,i,this.name,Array.prototype.slice.call(arguments).slice(1))}if(h==i){h=Alfresco.util.message(i,"Alfresco.module.DoclibGlobalFolder",Array.prototype.slice.call(arguments).slice(1))}return h},_showDialog:function f(){this.widgets.okButton.set("label",this.msg("button"));return Alfresco.module.DoclibCopyMoveTo.superclass._showDialog.apply(this,arguments)}});var e=new Alfresco.module.DoclibCopyMoveTo("null")})();(function(){var g=YAHOO.util.Dom,p=YAHOO.util.Event;var f=Alfresco.util.encodeHTML,i=Alfresco.util.userProfileLink;Alfresco.PeopleFinder=function(r){Alfresco.PeopleFinder.superclass.constructor.call(this,"Alfresco.PeopleFinder",r,["button","container","datasource","datatable","json"]);this.userSelectButtons={};this.searchTerm="";this.singleSelectedUser="";this.selectedUsers={};this.notAllowed={};this.following={};YAHOO.Bubbling.on("personSelected",this.onPersonSelected,this);YAHOO.Bubbling.on("personDeselected",this.onPersonDeselected,this);return this};YAHOO.lang.augmentObject(Alfresco.PeopleFinder,{VIEW_MODE_DEFAULT:"",VIEW_MODE_COMPACT:"COMPACT",VIEW_MODE_FULLPAGE:"FULLPAGE"});YAHOO.lang.extend(Alfresco.PeopleFinder,Alfresco.component.Base,{options:{siteId:"",viewMode:Alfresco.PeopleFinder.VIEW_MODE_DEFAULT,singleSelectMode:false,showSelf:true,minSearchTermLength:1,maxSearchResults:100,setFocus:false,addButtonLabel:null,addButtonSuffix:"",dataWebScript:"",userId:""},userSelectButtons:null,searchTerm:null,singleSelectedUser:null,selectedUsers:null,notAllowed:null,isSearching:false,following:null,onReady:function c(){var s=this;if(this.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_COMPACT){g.addClass(this.id+"-body","compact");g.removeClass(this.id+"-results","hidden")}else{if(this.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_FULLPAGE){g.setStyle(this.id+"-results","height","auto");g.removeClass(this.id+"-help","hidden");Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"api/subscriptions/"+encodeURIComponent(this.options.userId)+"/following",successCallback:{fn:function(w){if(w.json.people){var z={};var y=w.json.people;for(var x=0;x<y.length;x++){z[y[x].userName]=true}s.following=z}},scope:this}})}else{g.setStyle(this.id+"-results","height","300px");g.removeClass(this.id+"-results","hidden")}}this.widgets.searchButton=Alfresco.util.createYUIButton(this,"search-button",this.onSearchClick);var v=Alfresco.constants.PROXY_URI+YAHOO.lang.substitute(this.options.dataWebScript,this.options);v+=(v.indexOf("?")<0)?"?":"&";this.widgets.dataSource=new YAHOO.util.DataSource(v,{responseType:YAHOO.util.DataSource.TYPE_JSON,connXhrMode:"queueRequests",responseSchema:{resultsList:"people"}});this.widgets.dataSource.doBeforeParseData=function u(B,y){var x=y;if(y){var w=y.people,z,A;if(w.length>s.options.maxSearchResults){w=w.slice(0,s.options.maxSearchResults-1)}if(!s.options.showSelf){for(z=0,A=w.length;z<A;z++){if(w[z].userName==Alfresco.constants.USERNAME){w.splice(z,1);break}}}w.sort(function(F,E){var D=F.firstName+F.lastName,C=E.firstName+E.lastName;return(D>C)?1:(D<C)?-1:0});s.notAllowed={};if(y.notAllowed){s.notAllowed=Alfresco.util.arrayToObject(y.notAllowed)}x={people:w}}return x};this._setupDataTable();var t=g.get(this.id+"-search-text");var r=new YAHOO.util.KeyListener(t,{keys:YAHOO.util.KeyListener.KEY.ENTER},{fn:function(w,x,y){s.onSearchClick();p.stopEvent(x[1]);return false},scope:this,correctScope:true},YAHOO.env.ua.ie>0?YAHOO.util.KeyListener.KEYDOWN:"keypress");r.enable();if(this.options.setFocus){t.focus()}},_setupDataTable:function d(){var x=this;var t=function w(C,B,D,E){g.setStyle(C.parentNode,"width",D.width+"px");var A=Alfresco.constants.URL_RESCONTEXT+"components/images/no-user-photo-64.png";if(B.getData("avatar")!==undefined){A=Alfresco.constants.PROXY_URI+B.getData("avatar")+"?c=queue&ph=true"}C.innerHTML='<img class="avatar" src="'+A+'" alt="avatar" />'};var s=function y(J,M,G,D){var I=M.getData("userName"),C=I,K=M.getData("firstName"),L=M.getData("lastName"),A=M.getData("userStatus"),E=M.getData("userStatusTime");if((K!==undefined)||(L!==undefined)){C=K?K+" ":"";C+=L?L:""}var H=M.getData("jobtitle")||"",B=M.getData("organization")||"";var F='<h3 class="itemname">'+i(I,C,'class="theme-color-1" tabindex="0"')+' <span class="lighter">('+f(I)+")</span></h3>";if(H.length!==0){if(x.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_COMPACT){F+='<div class="detail">'+f(H)+"</div>"}else{F+='<div class="detail"><span>'+x.msg("label.title")+":</span> "+f(H)+"</div>"}}if(B.length!==0){if(x.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_COMPACT){F+='<div class="detail">&nbsp;('+f(B)+")</div>"}else{F+='<div class="detail"><span>'+x.msg("label.company")+":</span> "+f(B)+"</div>"}}if(A!==null&&x.options.viewMode!==Alfresco.PeopleFinder.VIEW_MODE_COMPACT){F+='<div class="user-status">'+f(A)+" <span>("+Alfresco.util.relativeTime(Alfresco.util.fromISO8601(E.iso8601))+")</span></div>"}J.innerHTML=F};var r=function u(E,C,F,H){g.setStyle(E.parentNode,"width",F.width+"px");g.setStyle(E.parentNode,"text-align","right");var D=C.getData("userName"),G='<span id="'+x.id+"-action-"+D+'"></span>';E.innerHTML=G;if(x.options.viewMode!==Alfresco.PeopleFinder.VIEW_MODE_FULLPAGE){var A=new YAHOO.widget.Button({type:"button",label:(x.options.addButtonLabel?x.options.addButtonLabel:x.msg("button.add"))+" "+x.options.addButtonSuffix,name:x.id+"-selectbutton-"+D,container:x.id+"-action-"+D,tabindex:0,disabled:D in x.notAllowed,onclick:{fn:x.onPersonSelect,obj:C,scope:x}});x.userSelectButtons[D]=A;if((D in x.selectedUsers)||(x.options.singleSelectMode&&x.singleSelectedUser!=="")){x.userSelectButtons[D].set("disabled",true)}}if(x.options.viewMode===Alfresco.PeopleFinder.VIEW_MODE_FULLPAGE&&x.options.userId!==D){var B=x.following[D];var A=new YAHOO.widget.Button({type:"button",label:B?x.msg("button.unfollow"):x.msg("button.follow"),name:x.id+"-followbutton-"+D,container:x.id+"-action-"+D,tabindex:0});A.set("onclick",{fn:B?x.onPersonUnfollow:x.onPersonFollow,obj:{record:C,button:A},scope:x})}};var v=[{key:"avatar",label:"Avatar",sortable:false,formatter:t,width:this.options.viewMode==Alfresco.PeopleFinder.VIEW_MODE_COMPACT?36:70},{key:"person",label:"Description",sortable:false,formatter:s},{key:"actions",label:"Actions",sortable:false,formatter:r,width:80}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-results",v,this.widgets.dataSource,{renderLoopSize:Alfresco.util.RENDERLOOPSIZE,initialLoad:false,MSG_EMPTY:this.msg("message.instructions")});this.widgets.dataTable.doBeforeLoadData=function z(A,B,C){if(B.results){this.renderLoopSize=Alfresco.util.RENDERLOOPSIZE}return true};this.widgets.dataTable.subscribe("rowMouseoverEvent",this.widgets.dataTable.onEventHighlightRow);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.widgets.dataTable.onEventUnhighlightRow)},clearResults:function l(){if(this.widgets.dataTable){var r=this.widgets.dataTable.getRecordSet().getLength();this.widgets.dataTable.deleteRows(0,r)}g.get(this.id+"-search-text").value="";this.singleSelectedUser="";this.selectedUsers={}},onPersonSelect:function h(r,t){var s=t.getData("userName");YAHOO.Bubbling.fire("personSelected",{eventGroup:this,userName:s,firstName:t.getData("firstName"),lastName:t.getData("lastName"),email:t.getData("email")})},onPersonFollow:function o(s,u){var t=u.record.getData("userName");u.button.set("disabled",true);var r=this;Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/subscriptions/"+encodeURIComponent(this.options.userId)+"/follow",method:Alfresco.util.Ajax.POST,dataObj:[t],requestContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(v){u.button.set("label",r.msg("button.unfollow"));u.button.set("onclick",{fn:r.onPersonUnfollow,obj:{record:u.record,button:u.button},scope:r});r.following[t]=true;u.button.set("disabled",false)},scope:this},failureCallback:{fn:function(w){var v=Alfresco.util.parseJSON(w.serverResponse.responseText);Alfresco.util.PopupManager.displayPrompt({title:this._msg("message.failure"),text:v.message});u.button.set("disabled",false)},scope:this}})},onPersonUnfollow:function a(s,u){var t=u.record.getData("userName");u.button.set("disabled",true);var r=this;Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/subscriptions/"+encodeURIComponent(this.options.userId)+"/unfollow",method:Alfresco.util.Ajax.POST,dataObj:[t],requestContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(v){u.button.set("label",r.msg("button.follow"));u.button.set("onclick",{fn:r.onPersonFollow,obj:{record:u.record,button:u.button},scope:r});r.following[t]=false;u.button.set("disabled",false)},scope:this},failureCallback:{fn:function(w){var v=Alfresco.util.parseJSON(w.serverResponse.responseText);Alfresco.util.PopupManager.displayPrompt({title:this._msg("message.failure"),text:v.message});u.button.set("disabled",false)},scope:this}})},onSearchClick:function n(s,t){var r=g.get(this.id+"-search-text").value;if(r.replace(/\*/g,"").length<this.options.minSearchTermLength){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.minimum-length",this.options.minSearchTermLength)});return}this.userSelectButtons={};this._performSearch(r)},onPersonSelected:function j(t,r){var v=r[1];if(v&&(v.userName!==undefined)){var u=v.userName;this.selectedUsers[u]=true;this.singleSelectedUser=u;if(this.options.singleSelectMode){for(var s in this.userSelectButtons){if(this.userSelectButtons.hasOwnProperty(s)){this.userSelectButtons[s].set("disabled",true)}}}else{if(this.userSelectButtons[u]){this.userSelectButtons[u].set("disabled",true)}}}},onPersonDeselected:function b(t,r){var u=r[1];if(u&&(u.userName!==undefined)){delete this.selectedUsers[u.userName];this.singleSelectedUser="";if(this.options.singleSelectMode){for(var s in this.userSelectButtons){if(this.userSelectButtons.hasOwnProperty(s)){this.userSelectButtons[s].set("disabled",false)}}}else{if(this.userSelectButtons[u.userName]){this.userSelectButtons[u.userName].set("disabled",false)}}}},_setDefaultDataTableErrors:function q(r){var s=Alfresco.util.message;r.set("MSG_EMPTY",s("message.empty","Alfresco.PeopleFinder"));r.set("MSG_ERROR",s("message.error","Alfresco.PeopleFinder"))},_performSearch:function e(r){if(!this.isSearching){this.isSearching=true;this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.set("MSG_EMPTY",this.msg("message.searching"));this.widgets.dataTable.deleteRows(0,this.widgets.dataTable.getRecordSet().getLength());var s=function u(w,x,y){if(this.options.viewMode!=Alfresco.PeopleFinder.VIEW_MODE_COMPACT){if(g.hasClass(this.id+"-results","hidden")){g.removeClass(this.id+"-results","hidden");g.addClass(this.id+"-help","hidden")}}this._enableSearchUI();this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.onDataReturnInitializeTable.call(this.widgets.dataTable,w,x,y)};var t=function v(x,y){this._enableSearchUI();if(y.status==401){window.location.reload()}else{try{var w=YAHOO.lang.JSON.parse(y.responseText);this.widgets.dataTable.set("MSG_ERROR",w.message);this.widgets.dataTable.showTableMessage(w.message,YAHOO.widget.DataTable.CLASS_ERROR)}catch(z){this._setDefaultDataTableErrors(this.widgets.dataTable)}}};this.searchTerm=r;this.widgets.dataSource.sendRequest(this._buildSearchParams(r),{success:s,failure:t,scope:this});this.widgets.searchButton.set("disabled",true);YAHOO.lang.later(2000,this,function(){if(this.isSearching){if(!this.widgets.feedbackMessage){this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.searching",this.name),spanClass:"wait",displayTime:0})}else{if(!this.widgets.feedbackMessage.cfg.getProperty("visible")){this.widgets.feedbackMessage.show()}}}},[])}},_enableSearchUI:function m(){if(this.widgets.feedbackMessage&&this.widgets.feedbackMessage.cfg.getProperty("visible")){this.widgets.feedbackMessage.hide()}this.widgets.searchButton.set("disabled",false);this.isSearching=false},_buildSearchParams:function k(r){return"filter="+encodeURIComponent(r)+"&maxResults="+this.options.maxSearchResults}})})();(function(){var h=YAHOO.util.Dom;var e=Alfresco.util.encodeHTML;Alfresco.module.DoclibPermissions=function(n){Alfresco.module.DoclibPermissions.superclass.constructor.call(this,"Alfresco.module.DoclibPermissions",n,["button","container","connection","json"]);this.rolePickers={};this.hiddenRoles=[];return this};YAHOO.extend(Alfresco.module.DoclibPermissions,Alfresco.component.Base,{options:{siteId:"",roles:null,files:null,width:"44em"},rolePickers:null,hiddenRoles:null,containerDiv:null,showDialog:function f(){if(!this.modules.actions){this.modules.actions=new Alfresco.module.DoclibActions()}if(!this.containerDiv){Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/permissions",dataObj:{htmlid:this.id,site:this.options.siteId},successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load Document Library Permissions template",execScripts:true})}else{this._showDialog()}},onTemplateLoaded:function c(o){this.containerDiv=document.createElement("div");this.containerDiv.setAttribute("style","display:none");this.containerDiv.innerHTML=o.serverResponse.responseText;var s=h.getFirstChild(this.containerDiv);while(s&&s.tagName.toLowerCase()!="div"){s=h.getNextSibling(s)}this.widgets.dialog=Alfresco.util.createYUIPanel(s,{width:this.options.width});this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok",this.onOK);this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel",this.onCancel);var r=YAHOO.util.Selector.query("button.site-group",this.widgets.dialog.element),t,n;for(var q=0,p=r.length;q<p;q++){t=r[q].id;n=r[q].value;this.rolePickers[n]=new YAHOO.widget.Button(t,{type:"menu",menu:t+"-select"});this.rolePickers[n].getMenu().subscribe("click",this.onRoleSelected,this.rolePickers[n])}this.widgets.resetAll=Alfresco.util.createYUIButton(this,"reset-all",this.onResetAll);this._showDialog()},onRoleSelected:function m(o,n,p){var q=n[1];p.set("label",q.cfg.getProperty("text"));p.set("name",q.value)},onResetAll:function b(n,o){this._applyPermissions("reset-all")},onOK:function i(o,p){var n=this._parseUI();this._applyPermissions("set",n)},_applyPermissions:function d(q,t){var o,w=[];o=this.options.files;for(var s=0,r=o.length;s<r;s++){w.push(o[s].node.nodeRef)}var v=function u(A){var x;var B=A.json.successCount;var C=A.json.failureCount;this._hideDialog();if(!A.json.overallSuccess){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.permissions.failure")});return}YAHOO.Bubbling.fire("filesPermissionsUpdated",{successCount:B,failureCount:C});for(var z=0,y=A.json.totalResults;z<y;z++){x=A.json.results[z];if(x.success){YAHOO.Bubbling.fire(x.type=="folder"?"folderPermissionsUpdated":"filePermissionsUpdated",{multiple:true,nodeRef:x.nodeRef})}}Alfresco.util.PopupManager.displayMessage({text:this.msg("message.permissions.success",B)})};var p=function n(x){this._hideDialog();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.permissions.failure")})};this.modules.actions.genericAction({success:{callback:{fn:v,scope:this}},failure:{callback:{fn:p,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:"permissions/{operation}/site/{site}",params:{site:this.options.siteId,operation:q}},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:w,permissions:t}}});this.widgets.okButton.set("disabled",true);this.widgets.cancelButton.set("disabled",true)},onCancel:function a(n,o){this._hideDialog()},_showDialog:function g(){var q,p;this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false);var s=h.get(this.id+"-title");if(YAHOO.lang.isArray(this.options.files)){s.innerHTML=this.msg("title.multi",this.options.files.length)}else{var n='<span class="light">'+e(this.options.files.displayName)+"</span>";s.innerHTML=this.msg("title.single",n);this.options.files=[this.options.files]}for(var u in this.rolePickers){if(this.rolePickers.hasOwnProperty(u)){this.rolePickers[u].set("name","");this.rolePickers[u].set("label",this.msg("role.None"))}}var t=this.options.files[0].node.permissions.roles,r;for(q=0,p=t.length;q<p;q++){r=t[q].split(";");if(r[1] in this.rolePickers&&r[2] in this.options.roles){this.rolePickers[r[1]].set("name",r[2]);this.rolePickers[r[1]].set("label",this.msg("role."+r[2]))}else{this.hiddenRoles.push({user:r[1],role:r[2]})}}var o=new YAHOO.util.KeyListener(document,{keys:YAHOO.util.KeyListener.KEY.ESCAPE},{fn:function(w,v){this.onCancel()},scope:this,correctScope:true});o.enable();this.widgets.dialog.show()},_hideDialog:function j(){var n=h.get(this.id+"-form");Alfresco.util.undoCaretFix(n);this.widgets.dialog.hide()},_parseUI:function k(){var q=[],r;for(var o in this.rolePickers){if(this.rolePickers.hasOwnProperty(o)){r=this.rolePickers[o].get("name");if((r!="")&&(r!="None")){q.push({group:this.rolePickers[o].get("value"),role:r})}}}for(var p=0,n=this.hiddenRoles.length;p<n;p++){q.push({group:this.hiddenRoles[p].user,role:this.hiddenRoles[p].role})}return q}});var l=new Alfresco.module.DoclibPermissions("null")})();(function(){var h=YAHOO.util.Dom,o=YAHOO.util.Event;var e=Alfresco.util.encodeHTML;Alfresco.module.DoclibAspects=function(p){Alfresco.module.DoclibAspects.superclass.constructor.call(this,p,["button","container","datasource","datatable"]);this.eventGroup=p;this.currentValues=[];this.selectedValues={};return this};YAHOO.extend(Alfresco.module.DoclibAspects,Alfresco.module.SimpleDialog,{currentValues:null,selectedValues:null,setOptions:function g(p){Alfresco.module.DoclibAspects.superclass.setOptions.call(this,{width:"50em",templateUrl:Alfresco.constants.URL_SERVICECONTEXT+"modules/documentlibrary/aspects",doBeforeDialogShow:{fn:this.doBeforeDialogShow,obj:null,scope:this},doBeforeAjaxRequest:{fn:this.doBeforeAjaxRequest,obj:null,scope:this}});this.options=YAHOO.lang.merge(this.options,p);return this},renderItem:function b(r,q){var p=function(w,y,x){var t="";if(w.toLowerCase()=="icon"){var v="",s="",u;if(x&&x.length>0){u=x.split(" ");v=' width="'+u[0]+'"';if(u.length>1){s=' height="'+u[1]+'"'}}t='<img src="'+y+'"'+v+s+' alt="'+e(r.name)+'" title="'+e(r.name)+'" />'}else{t=e(y)}return t};return YAHOO.lang.substitute(q,r,p)},i18n:function m(p,q){return this.msg("aspect."+p.replace(":","_"))},doBeforeDialogShow:function j(q,s,r){var p='<span class="light">'+e(this.options.file.displayName)+"</span>";h.get(this.id+"-title").innerHTML=this.msg("title",p);if(!this.modules.actions){this.modules.actions=new Alfresco.module.DoclibActions(Alfresco.doclib.MODE_REPOSITORY)}this._createAspectsControls();this._requestAspectData();this.widgets.okButton.set("disabled",false);this.widgets.cancelButton.set("disabled",false)},doBeforeAjaxRequest:function a(s){var q=function r(u){this.hide();Alfresco.util.PopupManager.displayMessage({text:this.msg(u.json.overallSuccess?"message.aspects.success":"message.aspects.failure")});if(u.json.results[0].tagScope){}};var t=function p(u){this.hide();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.aspects.failure")})};this.modules.actions.genericAction({success:{event:{name:"metadataRefresh",obj:{highlightFile:this.options.file.name}},callback:{fn:q,scope:this}},failure:{callback:{fn:t,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:"aspects/node/{nodeRef}",params:{nodeRef:this.options.file.jsNode.nodeRef.uri}},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{added:this.getAddedValues(),removed:this.getRemovedValues()}}});return false},getAddedValues:function n(){var r=[],p=Alfresco.util.arrayToObject(this.currentValues);for(var q in this.selectedValues){if(this.selectedValues.hasOwnProperty(q)){if(!(q in p)){r.push(q)}}}return r},getRemovedValues:function l(){var r=[],p=Alfresco.util.arrayToObject(this.currentValues);for(var q in p){if(p.hasOwnProperty(q)){if(!(q in this.selectedValues)){r.push(q)}}}return r},_createAspectsControls:function k(){var w=this;var u=function u(A,z,B,C){h.setStyle(A.parentNode,"width",B.width+"px");A.innerHTML=w.renderItem(z.getData(),"<div>{icon 16 16}</div>")};var x=function x(A,z,B,C){A.innerHTML=w.renderItem(z.getData(),'<h3 class="name">{name}</h3>')};var p=function p(A,z,B,C){h.setStyle(A.parentNode,"width",B.width+"px");if(z.getData("canAdd")){A.innerHTML='<a href="#" class="add-item add-'+w.eventGroup+'" title="'+w.msg("button.add")+'"><span class="addIcon">&nbsp;</span></a>'}};var s=function s(A,z,B,C){h.setStyle(A.parentNode,"width",B.width+"px");if(z.getData("canRemove")){A.innerHTML='<a href="#" class="remove-item remove-'+w.eventGroup+'" title="'+w.msg("button.remove")+'"><span class="removeIcon">&nbsp;</span></a>'}};this.widgets.dataSourceLeft=new YAHOO.util.DataSource([],{responseType:YAHOO.util.DataSource.TYPE_JSARRAY});var v=[{key:"icon",label:"icon",sortable:false,formatter:u,width:10},{key:"name",label:"name",sortable:false,formatter:x},{key:"id",label:"add",sortable:false,formatter:p,width:16}];this.widgets.dataTableLeft=new YAHOO.widget.DataTable(this.id+"-left",v,this.widgets.dataSourceLeft,{MSG_EMPTY:this.msg("label.loading")});var r=function q(C,B){var z=YAHOO.Bubbling.getOwnerByTagName(B[1].anchor,"div");if(z!==null){var E=B[1].target,D=E.offsetParent,A=w.widgets.dataTableLeft.getRecord(D);if(A){w.widgets.dataTableRight.addRow(A.getData());w.selectedValues[A.getData("id")]=A;w.widgets.dataTableLeft.deleteRow(D)}}return true};YAHOO.Bubbling.addDefaultAction("add-"+this.eventGroup,r);this.widgets.dataSourceRight=new YAHOO.util.DataSource([],{responseType:YAHOO.util.DataSource.TYPE_JSARRAY});var t=[{key:"icon",label:"icon",sortable:false,formatter:u,width:10},{key:"name",label:"name",sortable:false,formatter:x},{key:"id",label:"remove",sortable:false,formatter:s,width:16}];this.widgets.dataTableRight=new YAHOO.widget.DataTable(this.id+"-right",t,this.widgets.dataSourceRight,{MSG_EMPTY:this.msg("label.loading")});var y=function y(C,B){var z=YAHOO.Bubbling.getOwnerByTagName(B[1].anchor,"div");if(z!==null){var E=B[1].target,D=E.offsetParent,A=w.widgets.dataTableRight.getRecord(D);if(A){w.widgets.dataTableLeft.addRow(A.getData());delete w.selectedValues[A.getData("id")];w.widgets.dataTableRight.deleteRow(D)}}return true};YAHOO.Bubbling.addDefaultAction("remove-"+this.eventGroup,y)},_requestAspectData:function f(){this.selectedValues={};Alfresco.util.Ajax.request({method:"GET",url:Alfresco.constants.PROXY_URI+"slingshot/doclib/aspects/node/"+this.options.file.jsNode.nodeRef.uri,successCallback:{fn:this._requestAspectDataSuccess,scope:this},failureCallback:{fn:this._requestAspectDataFailure,scope:this}})},_requestAspectDataFailure:function i(){this.widgets.dataTableLeft.set("MSG_EMPTY",this.msg("label.load-failure"));this.widgets.dataTableRight.set("MSG_EMPTY",this.msg("label.load-failure"))},_requestAspectDataSuccess:function c(s){this.currentValues={};if(typeof s.json!="undefined"){var r=s.json.current,p=Alfresco.util.arrayToObject(r),C=this.options.visible,B=Alfresco.util.arrayToObject(C),y=this.options.addable,t=this.options.removeable,u,A;this.currentValues=r;if(y.length===0){y=C.slice(0)}this._googleDocsFilter(y);if(t.length===0){t=C.slice(0)}var w=Alfresco.util.arrayToObject(y),q=Alfresco.util.arrayToObject(t);var x,z,v;for(u=0,A=r.length;u<A;u++){x=r[u];v={id:x,icon:Alfresco.constants.URL_RESCONTEXT+"components/images/aspect-16.png",name:this.i18n(x),canAdd:x in w,canRemove:x in q};if(x in B){this.widgets.dataTableRight.addRow(v)}this.selectedValues[x]=v}for(u=0,A=y.length;u<A;u++){z=y[u];if((z in B)&&!(z in p)){this.widgets.dataTableLeft.addRow({id:z,icon:Alfresco.constants.URL_RESCONTEXT+"components/images/aspect-16.png",name:this.i18n(z),canAdd:true,canRemove:true})}}this.widgets.dataTableLeft.set("MSG_EMPTY",this.msg("label.no-addable"));this.widgets.dataTableRight.set("MSG_EMPTY",this.msg("label.no-current"));this.widgets.dataTableLeft.render();this.widgets.dataTableRight.render()}},_googleDocsFilter:function d(u){var r={"text/plain":true,"application/msword":true,"application/vnd.ms-excel":true,"application/vnd.ms-powerpoint":true},p=this.options.file.node.mimetype;if(!r.hasOwnProperty(p)){var q=function q(y,x,w){var v=y.slice((w||x)+1||y.length);y.length=x<0?y.length+x:x;return y.push.apply(y,v)};for(var s=0,t=u.length;s<t;s++){if(u[s]=="gd:googleEditable"){q(u,s);break}}}}})})();var doclibAspects=new Alfresco.module.DoclibAspects("null");(function(){var b=YAHOO.util.Dom,v=YAHOO.util.Event,s=YAHOO.util.Selector,p=YAHOO.util.KeyListener;Alfresco.module.socialPublishing=function(y){this.name="Alfresco.module.socialPublishing";this.id=y;var x=Alfresco.util.ComponentManager.get(this.id);if(x!==null){throw new Error("An instance of Alfresco.module.socialPublishing already exists.")}Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container"],this.onComponentsLoaded,this);return this};Alfresco.module.socialPublishing.prototype={defaultShowConfig:{nodeRef:null,filename:null},showConfig:{},widgets:{},updateLimits:{},onComponentsLoaded:function e(){if(this.id===null){return}},setUpdateLimits:function m(x){this.updateLimits=x;return this},show:function u(x){this.showConfig=YAHOO.lang.merge(this.defaultShowConfig,x);if(this.showConfig.nodeRef===undefined||this.showConfig.filename===undefined){throw new Error("A nodeRef & filename must be provided")}if(this.widgets.panel){this.widgets.panel.destroy}Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/social-publishing?nodeRef="+this.showConfig.nodeRef+"&htmlid="+this.id,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:Alfresco.util.message("socialPublish.template.error",this.name),execScripts:true});this.widgets.escapeListener=new p(document,{keys:p.KEY.ESCAPE},{fn:this.onCancelButtonClick,scope:this,correctScope:true})},onTemplateLoaded:function d(x){if(x.serverResponse.responseText.indexOf(this.id)===-1){Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("socialPublish.noChannels")});return}var z=document.createElement("div");z.innerHTML=x.serverResponse.responseText;var y=YAHOO.util.Dom.getFirstChild(z);this.widgets.panel=Alfresco.util.createYUIPanel(y);this.widgets.panel.nodeRef=this.showConfig.nodeRef;this.widgets.selectChannelButton=new YAHOO.widget.Button(this.id+"-channel-select-button",{type:"menu",menu:this.id+"-publishChannel-menu",lazyloadmenu:false});this.widgets.selectStatusUpdateChannels=new YAHOO.widget.Button(this.id+"-statusSelect-button",{type:"menu",menu:this.id+"-statusSelect-menu",lazyloadmenu:false});this.widgets.headerText=b.get(this.id+"-header-span");this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelButtonClick);this.widgets.publishButton=Alfresco.util.createYUIButton(this,"publish-button",this.onPublishButtonClick);this.widgets.formContainer=b.get(this.id+"-publish-form");this.widgets.statusUpdateText=b.get(this.id+"-statusUpdate-text");this.widgets.statusUpdateCount=b.get(this.id+"-statusUpdate-count");this.widgets.statusUpdateCountMsg=b.get(this.id+"-statusUpdate-countMessage");this.widgets.statusUpdateChannelCount=b.get(this.id+"-statusUpdate-channel-count");this.widgets.statusUpdateCountURL=b.get(this.id+"-statusUpdate-count-urlMessage");this.widgets.statusUpdateCheckboxes=b.getElementsByClassName("statusUpdate-checkboxes","input",this.widgets.formContainer);this.widgets.statusUpdateUrlCheckbox=b.get(this.id+"-statusUpdate-checkbox-url");v.addListener(this.widgets.statusUpdateText,"keydown",this.onStatusUpdateKeypress,{},this);v.addListener(this.widgets.statusUpdateText,"keyup",this.onStatusUpdateKeypress,{},this);v.addListener(this.widgets.statusUpdateCheckboxes,"click",this.onStatusCheckboxToggle,{},this);v.addListener(b.get(this.id+"-publishChannel-menu"),"click",this.onSelectPublishChannel,{},this);v.addListener(b.get(this.id+"-statusSelectActionAll"),"click",this.onSelectAllStatusChannels,{},this);v.addListener(b.get(this.id+"-statusSelectActionNone"),"click",this.onSelectNoStatusChannels,{},this);v.addListener(this.widgets.statusUpdateUrlCheckbox,"click",this.onStatusURLToggle,{},this);this._showPanel()},onCancelButtonClick:function k(){this.closeDialogue()},onPublishButtonClick:function l(){var x=this.widgets.selectChannelButton.get("value"),B={channelId:x,publishNodes:[this.showConfig.nodeRef],statusUpdate:{}},A=this,z=[];includeStatus=false;for(var y=0;y<this.widgets.statusUpdateCheckboxes.length;y++){if(this.widgets.statusUpdateCheckboxes[y].checked){z.push(this.widgets.statusUpdateCheckboxes[y].value);includeStatus=true}}if(includeStatus){B.statusUpdate={message:this.widgets.statusUpdateText.value,channelIds:z};if(this.widgets.statusUpdateUrlCheckbox.checked){B.statusUpdate.nodeRef=this.showConfig.nodeRef}}var D=function C(F){var G=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentPublishing");if(G!==null){G.doRefresh()}var I=A.showConfig.filename,E=this.widgets.selectChannelButton.getAttributeConfig("label").value,H=Alfresco.constants.URL_PAGECONTEXT+"document-details?nodeRef="+A.showConfig.nodeRef;linkText=Alfresco.util.message("socialPublish.confirm.link",A.name,{"0":I}),linkHTML="<a href='"+H+"'>"+linkText+"</a>",channelHTML="<span class='channel'>"+E+"</span>",trackingText=Alfresco.util.message("socialPublish.confirm.track",A.name,{"0":linkHTML}),successText=Alfresco.util.message("socialPublish.confirm.success",A.name,{"0":I,"1":channelHTML}),balloonHTML="<div class='publishConfirm'><div class='success'>"+successText+"</div><div class='tracking'>"+trackingText+"</div></div>",doclib=Alfresco.util.ComponentManager.findFirst("Alfresco.DocumentList");balloonElement=(doclib)?b.get(doclib.id):b.getElementsByClassName("document-thumbnail")[0];balloon=Alfresco.util.createBalloon(balloonElement,{html:balloonHTML,width:"48em"});balloon.show();YAHOO.lang.later(10000,this,function(){balloon.hide()})};Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/publishing/queue",method:Alfresco.util.Ajax.POST,requestContentType:"application/json",responseContentType:"application/json",dataObj:B,successCallback:{fn:D,scope:this},failureMessage:Alfresco.util.message("socialPublish.confirm.failure",this.name)});this.closeDialogue()},closeDialogue:function w(){this.resetTruncationMsg();this.widgets.panel.hide();this.widgets.escapeListener.disable()},onStatusUpdateKeypress:function q(){this.checkUpdateLength()},onStatusCheckboxToggle:function r(x){Alfresco.util.toggleClass(b.getAncestorByClassName(b.get(x.target),"status-channel"),"selected");this.onSelectedStatusChannelChange()},onSelectAllStatusChannels:function f(z){for(var x in this.widgets.statusUpdateCheckboxes){var y=this.widgets.statusUpdateCheckboxes[x];y.checked=true;b.addClass(b.getAncestorByClassName(y,"status-channel"),"selected")}this.onSelectedStatusChannelChange();z.preventDefault()},onSelectNoStatusChannels:function n(z){for(var x in this.widgets.statusUpdateCheckboxes){var y=this.widgets.statusUpdateCheckboxes[x];y.checked=false;b.removeClass(b.getAncestorByClassName(y,"status-channel"),"selected")}this.onSelectedStatusChannelChange();z.preventDefault()},onSelectedStatusChannelChange:function a(){this.resetTruncationMsg();this.checkUpdateLength();var x=s.filter(this.widgets.statusUpdateCheckboxes,":checked").length;this.widgets.statusUpdateChannelCount.innerHTML=Alfresco.util.message("socialPublish.dialogue.statusUpdate.select.count",this.name,{"0":x,"1":this.widgets.statusUpdateCheckboxes.length});if(x>0){this.widgets.statusUpdateText.removeAttribute("disabled");this.widgets.statusUpdateUrlCheckbox.removeAttribute("disabled")}else{b.setAttribute(this.widgets.statusUpdateText,"disabled","disabled");b.setAttribute(this.widgets.statusUpdateUrlCheckbox,"disabled","disabled")}},onStatusURLToggle:function o(){this.checkUpdateLength()},onSelectPublishChannel:function i(y,z){var x;if(s.test(y.target,"a.publishChannel")){x=y.target}else{x=b.getAncestorByClassName(y.target,"publishChannel")}this.widgets.selectChannelButton.set("label",x.innerHTML);this.widgets.selectChannelButton.set("value",x.rel);y.preventDefault()},checkUpdateLength:function h(){var z=null,D=0,y=0,F=s.filter(this.widgets.statusUpdateCheckboxes,":checked"),C={};if(F.length>0){for(var A=0;A<F.length;A++){var x=parseInt(b.getAttribute(F[A],"rel"),10),B=b.getAttribute(F[A],"name");if(x>0&&(x<z||z===null)){z=x}if(C[B]===undefined&&x!==0){C[B]=x}}if(z!==null){if(this.widgets.statusUpdateUrlCheckbox.checked){var G=parseInt(b.getAttribute(this.widgets.statusUpdateUrlCheckbox,"rel"),10);D=D+G;this.widgets.statusUpdateCountURL.innerHTML=Alfresco.util.message("socialPublish.dialogue.statusUpdate.urlChars",this.name,{"0":G})}else{this.widgets.statusUpdateCountURL.innerHTML=""}D=D+this.widgets.statusUpdateText.value.length;y=z-D;this.widgets.statusUpdateCount.innerHTML=Alfresco.util.message("socialPublish.dialogue.statusUpdate.charsRemaining",this.name,{"0":y});this.widgets.statusUpdateCountMsg.innerHTML=Alfresco.util.message("socialPublish.dialogue.statusUpdate.countMessage",this.name);if(y<0){b.addClass(b.getAncestorByClassName(this.widgets.statusUpdateCount,"statusUpdate-count-container","div"),"warning");var E=[];for(var A in C){if(parseInt(C[A],10)<D){E.push(A)}}this.showTruncationMsg(E)}else{this.resetTruncationMsg();b.removeClass(b.getAncestorByClassName(this.widgets.statusUpdateCount,"statusUpdate-count-container","div"),"warning")}}else{this.widgets.statusUpdateCount.innerHTML=this.widgets.statusUpdateCountURL.innerHTML=""}}else{this.widgets.statusUpdateCount.innerHTML=this.widgets.statusUpdateCountURL.innerHTML=this.widgets.statusUpdateCountMsg=""}},showTruncationMsg:function j(y){if(this.widgets.truncationNotification===null||this.widgets.truncationNotification.truncationChannels.length!==y.length){this.resetTruncationMsg();var x=(y.length>1)?"plural":"singular";this.widgets.truncationNotification=Alfresco.util.createBalloon(this.widgets.statusUpdateText,{text:Alfresco.util.message("socialPublish.dialogue.statusUpdate.truncationMessage."+x,this.name,{"0":y.join(", ")}),width:"24em"});this.widgets.truncationNotification.truncationChannels=y;this.widgets.truncationNotification.show()}},resetTruncationMsg:function t(){if(this.widgets.truncationNotification){this.widgets.truncationNotification.hide()}this.widgets.truncationNotification=null},_applyConfig:function c(){var x=Alfresco.util.message("socialPublish.dialogue.header",this.name,{"0":"<strong>"+this.showConfig.filename+"</strong>"});this.widgets.headerText.innerHTML=x;this.widgets.cancelButton.set("disabled",false)},_showPanel:function g(){this._applyConfig();this.widgets.escapeListener.enable();this.widgets.panel.show()}}})();Alfresco.module.getSocialPublishingInstance=function(){var a="alfresco-socialPublishing-instance";return Alfresco.util.ComponentManager.get(a)||new Alfresco.module.socialPublishing(a)};