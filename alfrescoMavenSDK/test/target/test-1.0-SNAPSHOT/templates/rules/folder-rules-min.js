(function(){var c=YAHOO.util.Dom;Alfresco.FolderRules=function f(){Alfresco.FolderRules.superclass.constructor.call(this,"Alfresco.FolderRules",null,["button"]);YAHOO.Bubbling.on("rulesCopiedFrom",this.onRulesCopiedFrom,this);YAHOO.Bubbling.on("rulesLinkedTo",this.onRulesLinkedTo,this);YAHOO.Bubbling.on("folderRulesetDetailsAvailable",this.onFolderRulesetDetailsAvailable,this);YAHOO.Bubbling.on("folderRulesDetailsChanged",this.onFolderRulesDetailsChanged,this);return this};YAHOO.extend(Alfresco.FolderRules,Alfresco.component.Base,{options:{nodeRef:null,siteId:"",folderName:"",pathToFolder:"",ruleset:null},onComponentsLoaded:function b(){YAHOO.util.Event.onDOMReady(this.onReady,this,true)},onReady:function h(){this.widgets.inheritedRulesList=c.get("inherited-rules-container");YAHOO.Bubbling.fire("folderDetailsAvailable",{folderDetails:{nodeRef:this.options.nodeRef.toString(),location:{path:this.options.folder.path,file:this.options.folder.name},fileName:this.options.folder.name,type:"folder"}});if(this.options.linkedToFolder){YAHOO.Bubbling.fire("linkedToFolderDetailsAvailable",{linkedToFolder:this.options.linkedToFolder})}this._fireFolderRulesetDetailsAvailable();this._displayInheritedRules()},onRulesCopiedFrom:function j(l,k){document.location.reload()},onRulesLinkedTo:function i(l,k){document.location.reload()},onFolderRulesetDetailsAvailable:function g(m,l){var k=l[1].folderRulesetDetails;if(this.options.ruleset.linkedToRuleSet!=k.linkedToRuleSet||!this.options.ruleset.rules&&k.rules||this.options.ruleset.rules&&!k.rules){document.location.reload()}},_displayInheritedRules:function e(l,k){var m=this.options.ruleset?this.options.ruleset.inheritedRules:null;if(m&&m.length>0){c.removeClass(this.widgets.inheritedRulesList,"hidden")}else{c.addClass(this.widgets.inheritedRulesList,"hidden")}},onFolderRulesDetailsChanged:function a(m,k){var l=this.options.ruleset&&this.options.ruleset.rules?this.options.ruleset.rules.length:0;Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI_RELATIVE+"api/node/"+this.options.nodeRef.uri+"/ruleset",successCallback:{fn:function(n,p){if(n.json){this.options.ruleset=n.json.data;this._fireFolderRulesetDetailsAvailable();var o=this.options.ruleset&&this.options.ruleset.rules?this.options.ruleset.rules.length:0;if((o==0&&p!=0)||(o!=0&&p==0)){window.location.reload()}}},obj:l,scope:this},failureMessage:this.msg("message.getRuleFailure",this.name)})},_fireFolderRulesetDetailsAvailable:function d(){YAHOO.Bubbling.fire("folderRulesetDetailsAvailable",{folderRulesetDetails:this.options.ruleset})}})})();