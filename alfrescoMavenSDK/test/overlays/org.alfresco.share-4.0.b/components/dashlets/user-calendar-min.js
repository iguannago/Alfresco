(function(){var c=YAHOO.util.Dom,g=YAHOO.util.Event;var b=Alfresco.util.encodeHTML,a=Alfresco.thirdparty.dateFormat,f=Alfresco.util.message("date-format.longDate");Alfresco.dashlet.UserCalendar=function e(k){Alfresco.dashlet.UserCalendar.superclass.constructor.call(this,"Alfresco.dashlet.UserCalendar",k,["container","datasource","datatable"]);return this};YAHOO.extend(Alfresco.dashlet.UserCalendar,Alfresco.component.Base,{events:null,options:{listSize:100},loadEvents:function(){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"calendar/events/user?from=now&size="+this.options.listSize,successCallback:{fn:this.onEventsLoaded,scope:this}})},onEventsLoaded:function d(k){this.events=k.json.events;var l=function m(n,o,p){o.results=this.events;this.widgets.dataTable.onDataReturnInitializeTable.call(this.widgets.dataTable,n,o,p)};this.widgets.dataSource.sendRequest(this.sites,{success:l,scope:this})},onReady:function j(){this.widgets.dataSource=new YAHOO.util.DataSource(this.events,{responseType:YAHOO.util.DataSource.TYPE_JSARRAY});var k=[{key:"icon",label:"",sortable:false,formatter:this.bind(this.renderCellIcon),width:32},{key:"event",label:"",sortable:false,formatter:this.bind(this.renderCellEvent)}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-events",k,this.widgets.dataSource,{MSG_EMPTY:this.msg("label.noEvents")});this.loadEvents()},renderCellIcon:function i(l,k,m,o){c.setStyle(l,"width",m.width+"px");var n='<div class="icon"><img src="'+Alfresco.constants.URL_RESCONTEXT+'/components/calendar/images/calendar-16.png" alt="event"/></div>';l.innerHTML=n},renderCellEvent:function h(p,s,o,k){var l=s.getData("when"),m=s.getData("endDate");var r=Alfresco.thirdparty.fromISO8601(l),q=Alfresco.thirdparty.fromISO8601(m);var n='<div class="detail"><h4><a href="'+Alfresco.constants.URL_CONTEXT+s.getData("url")+'" class="theme-color-1">'+b(s.getData("title"))+"</a></h4>";n+="<div>";if(l!=m&&s.getData("allday")!="true"){n+=a(r,f)+" "+s.getData("start")+" - "+a(q,f)+" "+s.getData("end")}else{n+=a(r,f);if(s.getData("allday")=="true"){if(l!=m){n+=" - "+a(q,f)}n+=" "+this.msg("label.allday")}else{n+=a(r,f);if(s.getData("start")!=s.getData("end")){n+=" - "+s.getData("end")}}}n+='</div><div><a href="'+Alfresco.constants.URL_PAGECONTEXT+"site/"+s.getData("site")+'/dashboard" class="theme-link-1">'+b(s.getData("siteTitle"))+"</a></div></div>";p.innerHTML=n}})})();