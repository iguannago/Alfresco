(function(){var v=YAHOO.util.Dom,I=YAHOO.util.Event,G=YAHOO.util.DragDropMgr;var f=Alfresco.util.encodeHTML,ab=Alfresco.util.activateLinks,at=Alfresco.util.combinePaths,l=Alfresco.util.userProfileLink,b=Alfresco.util.siteURL,H=function H(aK,aL){return Alfresco.util.formatDate(Alfresco.util.fromISO8601(aK),aL)},S=Alfresco.util.relativeTime,A=Alfresco.util.isValueSet;var aE="org.alfresco.share.documentList",ap=aE+".sortAscending",d=aE+".sortField",Q=aE+".showFolders",L=aE+".simpleView";Alfresco.DnD=function(aO,aL,aK,aM){Alfresco.DnD.superclass.constructor.call(this,aO,aK,aM);var aN=this.getDragEl();v.setStyle(aN,"opacity",0.67);this.docLib=aL};YAHOO.extend(Alfresco.DnD,YAHOO.util.DDProxy,{_inFlight:false,startDrag:function m(aL,aO){var aK=this.getDragEl();var aN=this.getEl();v.setStyle(aN,"visibility","hidden");var aM=document.createElement("img");aM.src=aN.src;aK.removeChild(aK.firstChild);aK.appendChild(aM);v.setStyle(aK,"border","none")},endDrag:function Z(aM){if(!this._inFlight){var aK=this.getEl();var aL=this.getDragEl();this.animateResult(aL,aK)}},animateResult:function ag(aN,aK){v.setStyle(aN,"visibility","");var aL=new YAHOO.util.Motion(aN,{points:{to:v.getXY(aK)}},0.2,YAHOO.util.Easing.easeOut);var aM=aN.id;var aO=this.id;aL.onComplete.subscribe(function(){v.setStyle(aM,"visibility","hidden");v.setStyle(aO,"visibility","")});aL.animate()},onDragDrop:function q(aO,aQ){var aP=v.get(aQ);if(G.interactionInfo.drop.length>0){if(v.isAncestor(this.docLib.widgets.dataTable.getContainerEl(),aP)){var aK=this.docLib.widgets.dataTable.getRecord(v.get(aQ)),aN=aK.getData();if(aN.node.isContainer){this._inFlight=true;var aL;if(aN.node.isLink){aL=new Alfresco.util.NodeRef(aN.node.linkedNode.nodeRef)}else{aL=new Alfresco.util.NodeRef(aN.node.nodeRef)}this._performMove(aL,aN.location.path+"/"+aN.location.file)}}else{if(v.hasClass(aP,"documentDroppable")){var aM={elementId:aQ,callback:this.onDropTargetOwnerCallBack,scope:this};this._inFlight=true;YAHOO.Bubbling.fire("dropTargetOwnerRequest",aM);this._setFailureTimeout()}}}},_performMove:function af(aP,aS){var aM=this.docLib.widgets.dataTable.getRecord(this.getEl()),aN="move-to/node/{nodeRef}",aR=[];aR.push(this.getEl().id);var aQ=function aO(aV){this._inFlight=false;var aT,aW=aV.json.successCount,aX=aV.json.failureCount;if(!aV.json.overallSuccess){this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});v.removeClass(this.dragFolderHighlight,"dndFolderHighlight");return}this.docLib._updateDocList.call(this.docLib);var aU=aM.getData();if(aU.node.isContainer){YAHOO.Bubbling.fire("folderMoved",{multiple:true,nodeRef:aU.nodeRef,destination:aS})}};var aL=function aK(aT){this._inFlight=false;this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});v.removeClass(this.dragFolderHighlight,"dndFolderHighlight")};this.docLib.modules.actions.genericAction({success:{callback:{fn:aQ,scope:this}},failure:{callback:{fn:aL,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:aN,params:{nodeRef:aP.uri}},wait:{message:this.docLib.msg("message.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:aR,parentId:this.docLib.doclistMetadata.parent.nodeRef}}})},_currTimeoutId:null,onDropTargetOwnerCallBack:function aj(aK,aM){this._clearTimeout();var aL=new Alfresco.util.NodeRef(aK);this._performMove(aL,aM)},_clearTimeout:function aa(){if(this._currTimeoutId!=null){window.clearTimeout(this._currTimeoutId);this._currTimeoutId=null;this._inFlight=false}},_setFailureTimeout:function aw(){this._clearTimeout();var aK=this;this._currTimeoutId=window.setTimeout(function(){aK.animateResult(aK.getDragEl(),aK.getEl());aK._inFlight=false;aK._currTimeoutId=null},500)},onDragOver:function aH(aM,aN){var aK=v.get(aN);if(aK.tagName=="IMG"||aK.className=="droppable"){this.dragFolderHighlight=v.getAncestorByClassName(aK,"folder");v.addClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(v.hasClass(aK,"documentDroppableHighlights")){var aL={elementId:aN,event:aM};YAHOO.Bubbling.fire("documentDragOver",aL)}}},onDragOut:function ax(aM,aN){var aK=v.get(aN);if(aK.tagName=="IMG"||aK.className=="droppable"){this.dragFolderHighlight=v.getAncestorByClassName(aK,"folder");v.removeClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(v.hasClass(aK,"documentDroppableHighlights")){var aL={elementId:aN,event:aM};YAHOO.Bubbling.fire("documentDragOut",aL)}}}});Alfresco.DocumentList=function(aK){Alfresco.DocumentList.superclass.constructor.call(this,"Alfresco.DocumentList",aK,["button","menu","container","datasource","datatable","paginator","json","history"]);this.currentPath="";this.currentPage=1;this.totalRecords=0;this.totalRecordsUpper=null;this.showingMoreActions=false;this.state={actionEditOfflineActive:false};this.currentFilter={filterId:"path",filterData:""};this.actions={};this.selectedFiles={};this.afterDocListUpdate=[];this.doclistMetadata={};this.previewTooltips=[];this.insituEditors=[];this.dynamicControls=[];this.dragAndDropAllowed=true;this.dragAndDropEnabled=false;this.dragEventRefCount=0;this.actionsView="browse";this.renderers={};YAHOO.Bubbling.on("activateDynamicControls",this.onActivateDynamicControls,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("metadataRefresh",this.onDocListRefresh,this);YAHOO.Bubbling.on("fileRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("changeFilter",this.onChangeFilter,this);YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("folderCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("nodeCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("folderRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("highlightFile",this.onHighlightFile,this);YAHOO.Bubbling.on("registerRenderer",this.onRegisterRenderer,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);YAHOO.Bubbling.on("fileCopied",this.onFileAction,this);YAHOO.Bubbling.on("fileDeleted",this.onFileAction,this);YAHOO.Bubbling.on("fileMoved",this.onFileAction,this);YAHOO.Bubbling.on("filePermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("folderCopied",this.onFileAction,this);YAHOO.Bubbling.on("folderDeleted",this.onFileAction,this);YAHOO.Bubbling.on("folderMoved",this.onFileAction,this);YAHOO.Bubbling.on("folderPermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("filesCopied",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesDeleted",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesMoved",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesPermissionsUpdated",this.onDocListRefresh,this);return this};YAHOO.extend(Alfresco.DocumentList,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocumentList,Alfresco.doclib.Actions);Alfresco.DocumentList.generateFilterMarkup=function r(aK){var aL=Alfresco.util.cleanBubblingObject(aK);return YAHOO.lang.substitute("{filterOwner}|{filterId}|{filterData}|{filterDisplay}",aL,function(aN,aO,aM){return typeof aO==="undefined"?"":window.escape(aO)})};Alfresco.DocumentList.generatePathMarkup=function ac(aK){return Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:at(aK.path,aK.file)})};Alfresco.DocumentList.generateCategoryMarkup=function h(aK){return Alfresco.DocumentList.generateFilterMarkup({filterId:"category",filterData:at(aK[1],aK[0])})};Alfresco.DocumentList.generateFileFolderLinkMarkup=function g(aM,aK){var aN=aK.jsNode,aL;if(aN.isLink&&A(aM.options.siteId)&&aK.location.site.name!==aM.options.siteId){if(aN.isContainer){aL=b("documentlibrary?path="+encodeURIComponent(aK.location.path),{site:aK.location.site.name})}else{aL=aM.getActionUrls(aK,aK.location.site.name).documentDetailsUrl}}else{if(aN.isContainer){aL='#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(aK.location)}else{aL=aM.getActionUrls(aK).documentDetailsUrl}}return'<a href="'+aL+'">'};Alfresco.DocumentList.generateThumbnailUrl=function U(aK){var aM=aK.jsNode,aL=aM.isLink?aM.linkedNode.nodeRef:aM.nodeRef;return Alfresco.constants.PROXY_URI+"api/node/"+aL.uri+"/content/thumbnails/doclib?c=queue&ph=true"};Alfresco.DocumentList.generateFavourite=function au(aM,aK){var aN=aK.jsNode,aO="favourite."+(aN.isContainer?"folder.":"document."),aL="";if(aK.isFavourite){aL='<a class="favourite-action enabled" title="'+aM.msg(aO+"remove.tip")+'" tabindex="0"></a>'}else{aL='<a class="favourite-action" title="'+aM.msg(aO+"add.tip")+'" tabindex="0">'+aM.msg(aO+"add.label")+"</a>"}return aL};Alfresco.DocumentList.generateLikes=function n(aN,aK){var aO=aK.node,aL=aK.likes,aP="like."+(aO.isContainer?"folder.":"document."),aM="";if(aL.isLiked){aM='<a class="like-action enabled" title="'+aN.msg(aP+"remove.tip")+'" tabindex="0"></a>'}else{aM='<a class="like-action" title="'+aN.msg(aP+"add.tip")+'" tabindex="0">'+aN.msg(aP+"add.label")+"</a>"}aM+='<span class="likes-count">'+f(aL.totalLikes)+"</span>";return aM};Alfresco.DocumentList.generateComments=function ay(aN,aK){var aP=aK.node,aO=aN.getActionUrls(aK),aL=aO[aP.isContainer?"folderDetailsUrl":"documentDetailsUrl"]+"#comment",aQ="comment."+(aP.isContainer?"folder.":"document.");var aM='<a href="'+aL+'" class="comment" title="'+aN.msg(aQ+"tip")+'" tabindex="0">'+aN.msg(aQ+"label")+"</a>";if(aP.properties["fm:commentCount"]!==undefined){aM+='<span class="comment-count">'+f(aP.properties["fm:commentCount"])+"</span>"}return aM};Alfresco.DocumentList.generateUserLink=function aB(aL,aK){if(aK.isDeleted===true){return"<span>"+aL.msg("details.user.deleted",f(aK.userName))+"</span>"}return l(aK.userName,YAHOO.lang.trim(aK.firstName+" "+aK.lastName))};YAHOO.lang.augmentObject(Alfresco.DocumentList.prototype,{options:{sortAscending:true,showFolders:false,simpleView:false,usePagination:false,siteId:"",containerId:"documentLibrary",rootNode:null,initialPage:1,pageSize:50,initialFilter:{},actionsPopupTimeout:700,loadingMessageDelay:1000,highlightFile:null,previewTooltips:null,insituEditors:null,groupActivitiesAt:5,inlineEditMimetypes:{"text/plain":true,"text/html":true,"text/xml":true},replicationUrlMapping:{},listUpdated:false,repositoryBrowsing:true,useTitle:true,userIsSiteManager:false},state:{actionEditOfflineActive:false},currentPath:null,currentPage:null,totalRecords:null,currentFilter:null,fileUpload:null,actions:null,selectedFiles:null,currentActionsMenu:null,showingMoreActions:null,deferredActionsMenu:null,afterDocListUpdate:null,doclistMetadata:null,dynamicControls:null,dragAndDropAllowed:null,dragAndDropEnabled:null,dragEventRefCount:null,dragFolderHighlight:null,renderers:null,onReady:function N(){var aT=this;this.dragAndDropEnabled=this.dragAndDropAllowed&&("draggable" in document.createElement("span"))&&YAHOO.env.ua.mobile===null;this._setupMetadataRenderers();this._setupHistoryManagers();this.widgets.sortAscending=Alfresco.util.createYUIButton(this,"sortAscending-button",this.onSortAscending);if(this.widgets.sortAscending!==null){this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(!this.options.sortAscending){v.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.dynamicControls.push(this.widgets.sortAscending)}this.widgets.sortField=Alfresco.util.createYUIButton(this,"sortField-button",this.onSortField,{type:"menu",menu:"sortField-menu",lazyloadmenu:false});if(this.widgets.sortField!==null){this.dynamicControls.push(this.widgets.sortField);var aL=this.widgets.sortField.getMenu().getItems(),aO;for(aO in aL){if(aL.hasOwnProperty(aO)){if(aL[aO].value===this.options.sortField){this.widgets.sortField.set("label",aL[aO].cfg.getProperty("text"));break}}}}this.widgets.showFolders=Alfresco.util.createYUIButton(this,"showFolders-button",this.onShowFolders,{type:"checkbox",checked:this.options.showFolders});if(this.widgets.showFolders!==null){this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.dynamicControls.push(this.widgets.showFolders)}this.widgets.simpleDetailed=new YAHOO.widget.ButtonGroup(this.id+"-simpleDetailed");if(this.widgets.simpleDetailed!==null){this.widgets.simpleDetailed.check(this.options.simpleView?0:1);this.widgets.simpleDetailed.on("checkedButtonChange",this.onSimpleDetailed,this.widgets.simpleDetailed,this);v.addClass(this.id+"-simpleView","simple-view");v.addClass(this.id+"-detailedView","detailed-view");this.dynamicControls.push(this.widgets.simpleDetailed)}this.widgets.fileSelect=Alfresco.util.createYUIButton(this,"fileSelect-button",this.onFileSelect,{type:"menu",menu:"fileSelect-menu"});if(this.widgets.fileSelect!==null){this.dynamicControls.push(this.widgets.fileSelect)}this.services.preferences=new Alfresco.service.Preferences();this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);this._setupDataSource();this._setupDataTable();this.widgets.previewTooltip=new YAHOO.widget.Tooltip(this.id+"-previewTooltip",{width:"108px"});this.widgets.previewTooltip.contextTriggerEvent.subscribe(function(aZ,aX){var aY=aX[0],a0=aT.widgets.dataTable.getRecord(aY.id),aW=a0.getData();this.cfg.setProperty("text",'<img src="'+Alfresco.DocumentList.generateThumbnailUrl(aW)+'" />')});var aU=function aM(aZ,aY){var aW=YAHOO.Bubbling.getOwnerByTagName(aY[1].anchor,"div");if(aW!==null){if(typeof aT[aW.title]==="function"){aY[1].stop=true;var aX=aT.widgets.dataTable.getRecord(aY[1].target.offsetParent).getData();try{aT[aW.title].call(aT,aX,aW)}catch(a0){Alfresco.logger.error("DL_fnActionHandler",aW.title,a0)}}}return true};YAHOO.Bubbling.addDefaultAction("action-link",aU);YAHOO.Bubbling.addDefaultAction("show-more",aU);var aR=function aV(aY,aX){var aW=YAHOO.Bubbling.getOwnerByTagName(aX[1].anchor,"div");if(aW!==null){aT.onLikes.call(aT,aX[1].target.offsetParent,aW)}return true};YAHOO.Bubbling.addDefaultAction("like-action",aR);var aQ=function aK(aY,aX){var aW=YAHOO.Bubbling.getOwnerByTagName(aX[1].anchor,"div");if(aW!==null){aT.onFavourite.call(aT,aX[1].target.offsetParent,aW)}return true};YAHOO.Bubbling.addDefaultAction("favourite-action",aQ);var aS=function aN(aY,aX){var aW=aX[1].anchor;if(aW!==null){var aZ=aW.rel,a0,a1={};if(aZ&&aZ!==""){aX[1].stop=true;a0=aZ.split("|");a1={filterOwner:window.unescape(a0[0]||""),filterId:window.unescape(a0[1]||""),filterData:window.unescape(a0[2]||""),filterDisplay:window.unescape(a0[3]||"")};Alfresco.logger.debug("DL_fnChangeFilterHandler","changeFilter =>",a1);YAHOO.Bubbling.fire("changeFilter",a1)}}return true};YAHOO.Bubbling.addDefaultAction("filter-change",aS);this.modules.actions=new Alfresco.module.DoclibActions();YAHOO.util.History.onReady(this.onHistoryManagerReady,this,true);try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(aP){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",aP);this.onHistoryManagerReady()}},_insituCallback:function ad(aM,aL){var aP=aL.jsNode,aO=aP.nodeRef;Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/documentlibrary/data/node/"+aO.uri+"?filter="+encodeURIComponent(this.currentFilter.filterId)+"&view="+this.actionsView+"&noCache="+new Date().getTime(),successCallback:{fn:function aK(aQ){aQ.json.item.jsNode=new Alfresco.util.Node(aQ.json.item.node);YAHOO.Bubbling.fire(aP.isContainer?"folderRenamed":"fileRenamed",{file:aQ.json.item});return false},scope:this},failureCallback:{fn:function aN(aQ){},scope:this}})},fnRenderCellSelected:function an(){var aK=this;return function aL(aP,aO,aQ,aR){v.setStyle(aP,"width",aQ.width+"px");v.setStyle(aP.parentNode,"width",aQ.width+"px");var aN=aO.getData("jsNode"),aM=aN.nodeRef;aP.innerHTML='<input id="checkbox-'+aO.getId()+'" type="checkbox" name="fileChecked" value="'+aM+'"'+(aK.selectedFiles[aM]?' checked="checked">':">")}},fnRenderCellStatus:function J(){var aK=this;return function aL(aU,aX,aR,aM){v.setStyle(aU,"width",aR.width+"px");v.setStyle(aU.parentNode,"width",aR.width+"px");var aP=aX.getData(),aN=aP.jsNode,aT=aP.indicators,aV,aS,aQ="";if(aT&&aT.length>0){for(var aO=0,aW=aT.length;aO<aW;aO++){aV=aT[aO];aS=Alfresco.util.message(aV.label,aK.name,aV.labelParams);aS=Alfresco.util.substituteDotNotation(aS,aP);aQ+='<div class="status"><img src="'+Alfresco.constants.URL_RESCONTEXT+"components/documentlibrary/indicators/"+aV.icon+'" title="'+aS+'" alt="'+aV.id+'" /></div>'}}aU.innerHTML=aQ}},fnRenderCellThumbnail:function aF(){var aK=this;return function aL(aZ,a0,aV,aR){var aU=a0.getData(),aS=aU.jsNode,aX=aS.properties,aN=aU.displayName,aQ=aS.isContainer,aT=aS.isLink,aW=aN.substring(aN.lastIndexOf(".")),aM=aS.nodeRef.nodeRef;var aY;if(aK.options.simpleView){aV.width=40;v.setStyle(aZ,"width",aV.width+"px");v.setStyle(aZ.parentNode,"width",aV.width+"px");if(aQ){aZ.innerHTML='<span class="folder-small">'+(aT?'<span class="link"></span>':"")+(aK.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(aK,aU)+'<img id="'+aM+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-32.png" /></a>';aY=new YAHOO.util.DDTarget(aM)}else{var aP=aK.id+"-preview-"+a0.getId();aZ.innerHTML='<span id="'+aP+'" class="icon32">'+(aT?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(aK,aU)+'<img id="'+aM+'" src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+Alfresco.util.getFileIcon(aN)+'" alt="'+aW+'" title="'+f(aN)+'" /></a></span>';aK.previewTooltips.push(aP)}}else{aV.width=100;v.setStyle(aZ,"width",aV.width+"px");v.setStyle(aZ.parentNode,"width",aV.width+"px");if(aQ){aZ.innerHTML='<span class="folder">'+(aT?'<span class="link"></span>':"")+(aK.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(aK,aU)+'<img id="'+aM+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-64.png" /></a>';aY=new YAHOO.util.DDTarget(aM)}else{aZ.innerHTML='<span class="thumbnail">'+(aT?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(aK,aU)+'<img id="'+aM+'" src="'+Alfresco.DocumentList.generateThumbnailUrl(aU)+'" alt="'+aW+'" title="'+f(aN)+'" /></a></span>'}}var aO=new Alfresco.DnD(aM,aK)}},fnRenderCellDescription:function aC(){var aK=this;return function aL(aQ,a7,aX,a2){var a5="",a4,a3,aM=a7.getData(),a6=aM.jsNode,aS=a6.properties,aT=a6.isContainer,aU=a6.isLink,ba="",a0="",aN="",aO=a6.permissions.user.CreateChildren;if(a6.isLink){a7.setData("displayName",aK.msg("details.link-to",aM.location.file))}else{if(aS.title&&aS.title!==aM.displayName&&aK.options.useTitle){a0='<span class="title">('+f(aS.title)+")</span>"}}if(A(aM.version)&&!a6.isContainer&&!a6.isLink){aN='<span class="document-version">'+f(aM.version)+"</span>"}if(A(aS.lockOwner)||A(aS.workingCopyOwner)){var a9=aS.lockOwner||aS.workingCopyOwner,aR=Alfresco.DocumentList.generateUserLink(aK,a9);if(A(aM.workingCopy.googleDocUrl)){if(a9.userName===Alfresco.constants.USERNAME){a5+='<div class="info-banner">'+aK.msg("details.banner.google-docs-owner",'<a href="'+aM.workingCopy.googleDocUrl+'" target="_blank">'+aK.msg("details.banner.google-docs.link")+"</a>")+"</div>"}else{a5+='<div class="info-banner">'+aK.msg("details.banner.google-docs-locked",aR,'<a href="'+aM.workingCopy.googleDocUrl+'" target="_blank">'+aK.msg("details.banner.google-docs.link")+"</a>")+"</div>"}}else{if(a9.userName===Alfresco.constants.USERNAME){a5+='<div class="info-banner">'+aK.msg("details.banner."+(aM.workingCopy.isWorkingCopy?"editing":"lock-owner"))+"</div>"}else{a5+='<div class="info-banner">'+aK.msg("details.banner.locked",aR)+"</div>"}}}var aP=Alfresco.util.generateDomId();if(a6.hasPermission("Write")&&!a6.isLocked){aK.insituEditors.push({context:aP,params:{type:"textBox",nodeRef:a6.nodeRef.toString(),name:"prop_cm_name",value:aM.fileName,fnSelect:function aW(bc,bd){var bb=bd.lastIndexOf(Alfresco.util.getFileExtension(bd))-1;if(bb>0){Alfresco.util.selectText(bc,0,bb)}else{bc.select()}},validations:[{type:Alfresco.forms.validation.nodeName,when:"keyup",message:aK.msg("validation-hint.nodeName")},{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true},when:"keyup",message:aK.msg("validation-hint.length.min.max",1,255)}],title:aK.msg("tip.insitu-rename"),errorMessage:aK.msg("message.insitu-edit.name.failure")},callback:{fn:aK._insituCallback,scope:aK,obj:aM}})}a5+='<h3 class="filename"><span id="'+aP+'">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(aK,aM);a5+=f(aM.displayName)+"</a></span>"+a0+aN+"</h3>";var a1=aM.metadataTemplate;if(a1&&YAHOO.lang.isArray(a1.lines)){var a8=function aV(bd,bf,bc){var bb=(bc!==null?"<em>"+aK.msg(bc)+"</em>: ":""),be="";if(aK.renderers.hasOwnProperty(bd)&&typeof aK.renderers[bd]==="function"){be=aK.renderers[bd].call(aK,aM,bb)}else{be='<span class="item">'+bb+f(a6.properties[bd])+"</span>"}return be};var aZ,aY;for(a4=0,a3=a1.lines.length;a4<a3;a4++){aY=a1.lines[a4];if(!A(aY.view)||aY.view==(aK.options.simpleView?"simple":"detailed")){aZ=YAHOO.lang.substitute(aY.template,aK.renderers,a8);if(A(aZ)){a5+='<div class="detail">'+aZ+"</div>"}}}}aQ.innerHTML=a5}},fnRenderCellActions:function aG(){var aL=this;return function aK(aN,aM,aO,aP){if(aL.options.simpleView){aO.width=80}else{aO.width=200}v.setStyle(aN,"width",aO.width+"px");v.setStyle(aN.parentNode,"width",aO.width+"px");v.addClass(aN.parentNode,aM.getData("type"));aN.innerHTML='<div id="'+aL.id+"-actions-"+aM.getId()+'" class="hidden"></div>'}},onRegisterRenderer:function K(aL,aK){var aM=aK[1];if(aM&&A(aM.propertyName)&&A(aM.renderer)){this.registerRenderer(aM.propertyName,aM.renderer)}else{Alfresco.logger.error("DL_onRegisterRenderer: Custom renderer registion invalid: "+aM)}},registerRenderer:function aq(aK,aL){if(A(aK)&&A(aL)){this.renderers[aK]=aL;return true}return false},_setupMetadataRenderers:function w(){this.registerRenderer("date",function(aK,aL){var aP=aK.jsNode,aN=aP.properties,aM="";var aO="modified",aQ=aN.modified.iso8601;if(aK.workingCopy&&aK.workingCopy.isWorkingCopy){aO="editing-started"}else{if(aQ===aN.created.iso8601){aO="created"}}aM='<span class="item">'+aL+this.msg("details."+aO+"-by",S(aQ),Alfresco.DocumentList.generateUserLink(this,aN.modifier))+"</span>";return aM});this.registerRenderer("size",function(aK,aL){var aO=aK.jsNode,aN=aO.properties,aM="";if(!aO.isContainer&&!aO.isLink){aM+='<span class="item">'+aL+Alfresco.util.formatFileSize(aO.size)+"</span>"}return aM});this.registerRenderer("description",function(aK,aL){var aO=aK.jsNode,aN=aO.properties,aP=Alfresco.util.generateDomId(),aM='<span id="'+aP+'" class="faded">'+aL+this.msg("details.description.none")+"</span>";if(aN.description&&aN.description!==""){aM='<span id="'+aP+'" class="item">'+aL+ab(f(aN.description))+"</span>"}return aM});this.registerRenderer("tags",function(aP,aR){var aL=aP.jsNode,aQ=aL.properties,aK=Alfresco.util.generateDomId(),aO="";var aS=aL.tags,aT;if(aL.hasAspect("cm:taggable")&&aS.length>0){for(var aN=0,aM=aS.length;aN<aM;aN++){aT=f(aS[aN]);aO+='<span class="tag"><a href="#" class="tag-link" rel="'+aT+'">'+aT+"</a></span>"}}else{aO+='<span class="faded">'+aR+this.msg("details.tags.none")+"</span>"}if(aL.hasPermission("Write")&&!aL.isLocked){this.insituEditors.push({context:aK,params:{type:"tagEditor",nodeRef:aL.nodeRef.toString(),name:"prop_cm_taggable",value:aP.node.properties["cm:taggable"],validations:[{type:Alfresco.forms.validation.nodeName,when:"keyup",message:this.msg("validation-hint.nodeName")}],title:this.msg("tip.insitu-tag"),errorMessage:this.msg("message.insitu-edit.tag.failure")},callback:{fn:this._insituCallback,scope:this,obj:aP}})}return'<span id="'+aK+'" class="item">'+aR+aO+"</span>"});this.registerRenderer("categories",function(aQ,aS){var aK=aQ.jsNode,aR=aK.properties,aO="";if(aK.hasAspect("cm:generalclassifiable")){var aP=aK.categories,aL;aO+='<span class="category-item item">&nbsp;</span><span class="item">'+aS;if(aP.length>0){for(var aN=0,aM=aP.length;aN<aM;aN++){aL=aP[aN];aO+='<span class="category"><a href="#" class="filter-change" rel="'+Alfresco.DocumentList.generateCategoryMarkup(aL)+'">'+f(aL[0])+"</a></span>"+(aM-aN>1?", ":"")}}else{aO+='<span class="faded">'+aS+this.msg("details.categories.none")+"</span>"}aO+="</span>"}return aO});this.registerRenderer("social",function(aK){var aN=aK.jsNode,aM=aN.properties,aL="";aL+='<span class="item item-social">'+Alfresco.DocumentList.generateFavourite(this,aK)+"</span>";aL+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateLikes(this,aK)+"</span>";if(aN.permissions.user.CreateChildren){aL+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateComments(this,aK)+"</span>"}return aL})},_setupHistoryManagers:function ak(){var aN=YAHOO.util.History.getBookmarkedState("filter");aN=aN||"path|/";try{while(aN!==(aN=decodeURIComponent(aN))){}}catch(aQ){}var aL=function aS(aT){var aU=aT.split("|"),aV={filterId:window.unescape(aU[0]||""),filterData:window.unescape(aU[1]||"")};aV.filterOwner=Alfresco.util.FilterManager.getOwner(aV.filterId);return aV};this.options.initialFilter=aL(aN);YAHOO.util.History.register("filter",aN,function aK(aT){Alfresco.logger.debug("HistoryManager: filter changed:"+aT);if(YAHOO.env.ua.gecko>0){aT=window.unescape(aT);Alfresco.logger.debug("HistoryManager: filter (after Firefox fix):"+aT)}this._updateDocList.call(this,{filter:aL(aT),page:this.currentPage})},null,this);var aM=function aO(aU,aT){aT.widgets.paginator.setState(aU);YAHOO.util.History.navigate("page",String(aU.page))};if(this.options.usePagination){var aR=YAHOO.util.History.getBookmarkedState("page")||"1";while(aR!==(aR=decodeURIComponent(aR))){}this.currentPage=parseInt(aR||this.options.initialPage,10);YAHOO.util.History.register("page",aR,function aP(aT){Alfresco.logger.debug("HistoryManager: page changed:"+aT);if(this.currentPage!==aT){this._updateDocList.call(this,{page:aT})}else{Alfresco.logger.debug("...page changed event ignored.")}},null,this);this.widgets.paginator=new YAHOO.widget.Paginator({containers:[this.id+"-paginator",this.id+"-paginatorBottom"],rowsPerPage:this.options.pageSize,initialPage:this.currentPage,template:this.msg("pagination.template"),pageReportTemplate:this.msg("pagination.template.page-report"),previousPageLinkLabel:this.msg("pagination.previousPageLinkLabel"),nextPageLinkLabel:this.msg("pagination.nextPageLinkLabel")});this.widgets.paginator.subscribe("changeRequest",aM,this);v.setStyle(this.id+"-doclistBarBottom","display","block")}},_setupDataSource:function T(){var aL=this;this.widgets.dataSource=new YAHOO.util.DataSource(at(Alfresco.constants.URL_SERVICECONTEXT,"components/documentlibrary/data/doclist/"),{responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{paginationRecordOffset:"startIndex",totalRecords:"totalRecords",totalRecordsUpper:"totalRecordsUpper"}}});this.widgets.dataSource.doBeforeCallback=function aK(aO,aZ,a1){aL.doclistMetadata=aZ.metadata;YAHOO.Bubbling.fire("doclistMetadata",{metadata:aL.doclistMetadata});var aX=null;if(aL.doclistMetadata.parent){aX=aL.doclistMetadata.parent.permissions;if(aX&&aX.user){YAHOO.Bubbling.fire("userAccess",{userAccess:aX.user})}}var aP=aL.doclistMetadata.itemCounts,aV=(aP.documents===0&&aP.folders===0),aW=(aP.documents===0&&!aL.options.showFolders&&aP.folders>0);var aT=function aU(a5){var a3=v.getChildren(a5);for(var a2=0,a4=a3.length;a2<a4;a2++){if(a3[a2].id!==null&&a3[a2].id!==""){a3[a2].id+="-instance"}}};var a0=v.get(aL.id+"-main-template"),aS=a0.cloneNode(true),aN=v.getFirstChild(aS),aR=null,aM=null;if(aX){var aQ=aL.doclistMetadata.parent.permissions.user.CreateChildren&&YAHOO.env.ua.mobile===null;if(aQ&&aL.dragAndDropEnabled){v.addClass(aN,"docListInstructionsWithDND")}else{v.addClass(aN,"docListInstructions")}if(aV&&!aQ){a0=v.get(aL.id+"-no-items-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aN.appendChild(aR)}else{if(aW){a0=v.get(aL.id+"-hidden-subfolders-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aT(aR);aM=v.getElementsByClassName("docListLinkedInstruction","a",aR);if(aM.length==1){aM[0].innerHTML=aL.msg("show.folders",aP.folders)}aN.appendChild(aR)}else{if(aV&&aQ&&aL.dragAndDropEnabled){a0=v.get(aL.id+"-dnd-instructions-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aN.appendChild(aR)}else{if(aV&&aQ&&!aL.dragAndDropEnabled){a0=v.get(aL.id+"-upload-instructions-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aT(aR);aN.appendChild(aR)}}}}if(aV&&aQ&&aL.dragAndDropEnabled){a0=v.get(aL.id+"-other-options-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aN.appendChild(aR);if(aV&&aQ){if(aL.dragAndDropEnabled){a0=v.get(aL.id+"-standard-upload-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aT(aR);aN.appendChild(aR)}a0=v.get(aL.id+"-new-folder-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aT(aR);aN.appendChild(aR)}}}else{v.addClass(aN,"docListInstructions");if(aW){a0=v.get(aL.id+"-hidden-subfolders-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aT(aR);aM=v.getElementsByClassName("docListLinkedInstruction","a",aR);if(aM.length==1){aM[0].innerHTML=aL.msg("show.folders",aP.folders)}aN.appendChild(aR)}else{a0=v.get(aL.id+"-no-items-template");aR=a0.cloneNode(true);v.removeClass(aR,"hidden");aN.appendChild(aR)}}var aY=document.createElement("div");v.setStyle(aY,"clear","both");aN.appendChild(aY);aL.widgets.dataTable.set("MSG_EMPTY",aS.innerHTML);return a1}},_setupDataTable:function aD(){var aN=this;var aP=[{key:"nodeRef",label:"Select",sortable:false,formatter:this.fnRenderCellSelected(),width:16},{key:"status",label:"Status",sortable:false,formatter:this.fnRenderCellStatus(),width:16},{key:"thumbnail",label:"Preview",sortable:false,formatter:this.fnRenderCellThumbnail(),width:100},{key:"fileName",label:"Description",sortable:false,formatter:this.fnRenderCellDescription()},{key:"actions",label:"Actions",sortable:false,formatter:this.fnRenderCellActions(),width:200}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-documents",aP,this.widgets.dataSource,{renderLoopSize:this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE,initialLoad:false,dynamicData:true,MSG_EMPTY:this.msg("message.loading")});this.widgets.dataTable.handleDataReturnPayload=function aM(aR,aQ,aS){aN.totalRecords=aQ.meta.totalRecords;aN.totalRecordsUpper=aQ.meta.totalRecordsUpper;return aQ.meta};this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.subscribe("tableMsgShowEvent",function(aV){this._elMsgTbody.parentNode.style.width="";if(aV.html&&aV.html.indexOf("docListInstructions")!==-1){var aY=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListToolbar");if(aY!==null){var aW=v.get(aN.id+"-standard-upload-link-template-instance");if(aW!==null){var aZ=v.getChildren(aW);I.addListener(aZ[0],"click",aY.onFileUpload,aY,true);I.addListener(v.getFirstChild(aZ[1]),"click",aY.onFileUpload,aY,true)}var aU=v.get(aN.id+"-new-folder-link-template-instance");if(aU!==null){var aX=v.getChildren(aU);I.addListener(aX[0],"click",aY.onNewFolder,aY,true);I.addListener(v.getFirstChild(aX[1]),"click",aY.onNewFolder,aY,true)}}var aQ=v.get(aN.id+"-show-folders-template-instance");if(aQ!==null){var aS=function aR(){this.widgets.showFolders.set("checked",true)};var aT=v.getChildren(aQ);I.addListener(aT[0],"click",aS,aN,true);I.addListener(aT[1],"click",aS,aN,true)}}});this.widgets.dataTable.doBeforeLoadData=function aK(aS,aU,aW){this.hideTableMessage();if(aU.error){try{var aQ=YAHOO.lang.JSON.parse(aU.responseText);this.set("MSG_ERROR",aQ.message)}catch(aV){aN._setDefaultDataTableErrors(this)}}else{if(aU.results.length===0){this.fireEvent("renderEvent",{type:"renderEvent"})}else{for(var aR=0,aT=aU.results.length;aR<aT;aR++){aU.results[aR].jsNode=new Alfresco.util.Node(aU.results[aR].node)}}}return true};this.widgets.dataTable.subscribe("checkboxClickEvent",function aL(aQ){var aR=aQ.target.value;this.selectedFiles[aR]=aQ.target.checked;YAHOO.Bubbling.fire("selectedFilesChanged")},this,true);this.widgets.dataTable.subscribe("renderEvent",function aO(){Alfresco.logger.debug("DataTable renderEvent");if(0<YAHOO.env.ua.ie&&YAHOO.env.ua.ie<7){var aR=this.widgets.dataTable.getTableEl().parentNode;aR.className=aR.className}if(this.widgets.paginator){Alfresco.logger.debug("Setting paginator state: page="+this.currentPage+", totalRecords="+this.totalRecords);this.widgets.paginator.setState({page:this.currentPage,totalRecords:this.totalRecords});if(this.totalRecordsUpper){this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report.more"))}else{this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report"))}this.widgets.paginator.render()}if(this.options.highlightFile){YAHOO.Bubbling.fire("highlightFile",{fileName:window.unescape(this.options.highlightFile)})}else{if(this.listUpdated){var aV=v.getY(this.id+"-documents"),aQ=YAHOO.env.ua.ie>0?((document.compatMode&&document.compatMode!=="BackCompat")?document.documentElement:document.body).scrollTop:window.scrollY;if(aQ>aV){window.scrollTo(0,aV)}}}var aU,aT;for(aU=0,aT=this.afterDocListUpdate.length;aU<aT;aU++){this.afterDocListUpdate[aU].call(this)}this.afterDocListUpdate=[];this.widgets.previewTooltip.cfg.setProperty("context",this.previewTooltips);var aS;for(aU=0,aT=this.insituEditors.length;aU<aT;aU++){aS=this.insituEditors[aU];Alfresco.util.createInsituEditor(aS.context,aS.params,aS.callback)}this.widgets.dataTable.set("renderLoopSize",this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE)},this,true);this.widgets.dataTable.subscribe("rowMouseoverEvent",this.onEventHighlightRow,this,true);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.onEventUnhighlightRow,this,true);if(this.dragAndDropEnabled){I.addListener(document.body,"dragenter",this._swallowDragEnter,this,true);I.addListener(document.body,"dragover",this._swallowDragOver,this,true);I.addListener(document.body,"drop",this._swallowDragDrop,this,true);I.addListener(document.body,"dragstart",this._swallowDragStart,this,true)}},_removeDragAndDrop:function ai(){if(this.dragAndDropEnabled){try{var aL=v.get(this.id+"-body");I.removeListener(aL,"dragenter");I.removeListener(aL,"dragover");I.removeListener(aL,"dragleave");I.removeListener(aL,"drop")}catch(aK){Alfresco.logger.error("_addDragAndDrop: The following exception occurred: ",aK)}}},_addDragAndDrop:function C(){if(this.dragAndDropEnabled){try{var aL=v.get(this.id+"-body");I.addListener(aL,"dragenter",this.onDocumentListDragEnter,this,true);I.addListener(aL,"dragover",this.onDocumentListDragOver,this,true);I.addListener(aL,"dragleave",this.onDocumentListDragLeave,this,true);I.addListener(aL,"drop",this.onDocumentListDrop,this,true)}catch(aK){Alfresco.logger.error("_addDragAndDrop: The following exception occurred: ",aK)}}},_swallowDragStart:function o(aK){aK.stopPropagation();aK.preventDefault()},_swallowDragEnter:function p(aK){aK.stopPropagation();aK.preventDefault()},_swallowDragOver:function V(aK){aK.dataTransfer.dropEffect="none";aK.stopPropagation();aK.preventDefault()},_swallowDrop:function al(aK){aK.stopPropagation();aK.preventDefault()},onDocumentListDragEnter:function ae(aP){var aL=aP.target,aN=this.widgets.dataTable.getRecord(aL),aK=this.widgets.dataTable.getColumn(aL),aO=this.widgets.dataTable.getContainerEl(),aM;if(aN&&aK&&(aL.tagName=="IMG"||aL.className=="droppable")&&aK.getKey()=="thumbnail"){aM=aN.getData("jsNode");if(aM&&aM.isContainer){this.dragFolderHighlight=v.getAncestorByClassName(aL,"folder");v.addClass(this.dragFolderHighlight,"dndFolderHighlight");v.removeClass(aO,"dndDocListHighlight")}}else{this.dragEventRefCount=Math.min(++this.dragEventRefCount,2);v.addClass(aO,"dndDocListHighlight");if(this.dragFolderHighlight){v.removeClass(this.dragFolderHighlight,"dndFolderHighlight");this.dragFolderHighlight=null}}aP.stopPropagation();aP.preventDefault()},onDocumentListDragOver:function j(aK){aK.dataTransfer.dropEffect=Math.floor(YAHOO.env.ua.gecko)===1?"move":"copy";aK.stopPropagation();aK.preventDefault()},onDocumentListDragLeave:function aI(aO){var aL=aO.target,aM=this.widgets.dataTable.getRecord(aL),aN=this.widgets.dataTable.getColumn(aL),aK=aM?aM.getData():null;if(aM&&aN&&(aL.tagName=="IMG"||aL.className=="droppable")&&aK.node.isContainer&&aN.getKey()=="thumbnail"){}else{if(--this.dragEventRefCount===0){v.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight")}}aO.stopPropagation();aO.preventDefault()},onDocumentListDrop:function X(aU){try{if(aU.dataTransfer.files!==undefined&&aU.dataTransfer.files!==null&&aU.dataTransfer.files.length>0){var aR=Alfresco.getDNDUploadProgressInstance();var aL=false;var aV="",aO,aN;aN=aU.dataTransfer.files.length;for(aO=0;aO<aN;aO++){if(aU.dataTransfer.files[aO].size>0){aL=true}else{aV+='"'+aU.dataTransfer.files[aO].fileName+'", '}}if(!aL){aV=aV.substring(0,aV.lastIndexOf(", "));Alfresco.util.PopupManager.displayMessage({text:aR.msg("message.zeroByteFiles",aV)})}if(aL&&aR.uploadMethod===aR.INMEMORY_UPLOAD){var aY=0;aN=aU.dataTransfer.files.length;for(aO=0;aO<aN;aO++){aY+=aU.dataTransfer.files[aO].size}if(aY>aR.getInMemoryLimit()){aL=false;Alfresco.util.PopupManager.displayPrompt({text:aR.msg("inmemory.uploadsize.exceeded",Alfresco.util.formatFileSize(aR.getInMemoryLimit()))})}}if(aL){var aT=this.currentPath,aK=aT.substring(aT.lastIndexOf("/")+1),aW=this.doclistMetadata.parent?this.doclistMetadata.parent.nodeRef:null;var aZ=this.widgets.dataTable.getRecord(aU.target);if(aZ!==null){var aS=this.widgets.dataTable.getColumn(aU.target),aQ=aZ.getData();if(aZ&&aS&&(aU.target.tagName=="IMG"||(aU.target.tagName=="SPAN"&&v.hasClass(aU.target,"droppable")))&&aQ.node.isContainer&&aS.getKey()=="thumbnail"){var aX=aQ.location;aK=aX.file;aT=at(aX.path,aX.file);aW=aQ.nodeRef}}v.removeClass(this.widgets.dataTable.getTrEl(aU.target),"dndFolderHighlight");v.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight");var aP={files:aU.dataTransfer.files,uploadDirectoryName:aK,filter:[],mode:aR.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};if(A(this.options.siteId)){aP.siteId=this.options.siteId;aP.containerId=this.options.containerId;aP.uploadDirectory=aT}else{aP.destination=aW}aR.show(aP)}}else{Alfresco.logger.debug("DL_onDocumentListDrop: A drop event was detected, but no files were present for upload: ",aU.dataTransfer)}}catch(aM){Alfresco.logger.error("DL_onDocumentListDrop: The following error occurred when files were dropped onto the Document List: ",aM)}aU.stopPropagation();aU.preventDefault()},onHistoryManagerReady:function t(){if(this.options.initialFilter.filterId==="path"&&window.location.hash=="#upload"){window.location.hash="";var aK=function aL(){YAHOO.Bubbling.fire("showFileUploadDialog",{tooltip:this.msg("dnd.upload.tooltip")})};this.afterDocListUpdate.push(aK)}Alfresco.logger.debug("DL_onHistoryManagerReady","changeFilter =>",this.options.initialFilter);YAHOO.Bubbling.fire("changeFilter",YAHOO.lang.merge({doclistFirstTimeNav:true},this.options.initialFilter));v.setStyle(this.id+"-body","visibility","visible")},getSelectedFiles:function aJ(){var aO=[],aP=this.widgets.dataTable.getRecordSet(),aN,aM,aL,aK;for(aL=0,aK=aP.getLength();aL<aK;aL++){aN=aP.getRecord(aL);aM=aN.getData("node");if(this.selectedFiles[aM.nodeRef]){aO.push(aN.getData())}}return aO},selectFiles:function u(aU){var aR=this.widgets.dataTable.getRecordSet(),aM=YAHOO.util.Selector.query('input[type="checkbox"]',this.widgets.dataTable.getTbodyEl()),aQ=aM.length,aW,aO,aN,aV;switch(aU){case"selectAll":aV=function aS(aX,aY){return true};break;case"selectNone":aV=function aP(aX,aY){return false};break;case"selectInvert":aV=function aL(aX,aY){return !aY};break;case"selectDocuments":aV=function aK(aX,aY){return !(aX.node.isContainer)};break;case"selectFolders":aV=function aK(aX,aY){return aX.node.isContainer};break;default:aV=function aT(aX,aY){return aY}}for(aN=0;aN<aQ;aN++){aW=aR.getRecord(aN);aO=aW.getData();this.selectedFiles[aO.nodeRef]=aM[aN].checked=aV(aO,aM[aN].checked)}YAHOO.Bubbling.fire("selectedFilesChanged")},onSortAscending:function P(aK,aL){this.options.sortAscending=!this.options.sortAscending;this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(this.options.sortAscending){v.removeClass(this.widgets.sortAscending.get("element"),"sort-descending")}else{v.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.services.preferences.set(ap,this.options.sortAscending);YAHOO.Bubbling.fire("metadataRefresh");if(aK){I.preventDefault(aK)}},onSortField:function aA(aP,aO,aN){var aK=aO[0],aL=aO[1];if(aL){this.options.sortField=aL.value;this.widgets.sortField.set("label",aL.cfg.getProperty("text"));this.services.preferences.set(d,this.options.sortField);var aM=aL.srcElement.getAttribute("title");if(aM==="true"||aM==="false"){this.options.sortAscending=(aM==="false");this.onSortAscending()}else{YAHOO.Bubbling.fire("metadataRefresh")}}I.preventDefault(aK)},onShowFolders:function i(aK,aL){this.options.showFolders=this.widgets.showFolders.get("checked");this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.services.preferences.set(Q,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh");if(aK){I.preventDefault(aK)}},onSimpleDetailed:function z(aK,aL){this.options.simpleView=aK.newValue.index===0;this.services.preferences.set(L,this.options.simpleView);YAHOO.Bubbling.fire("metadataRefresh");if(aK){I.preventDefault(aK)}},onFileSelect:function c(aO,aN,aM){var aK=aN[0],aL=aN[1];this.selectFiles(Alfresco.util.findEventClass(aL));I.preventDefault(aK)},onEventHighlightRow:function R(aN){this.widgets.dataTable.onEventHighlightRow.call(this.widgets.dataTable,aN);var aM=v.get(this.id+"-actions-"+aN.target.id);if(aM&&aM.firstChild===null){var aZ=this.widgets.dataTable.getRecord(aN.target.id),aT=aZ.getData(),aK=aT.jsNode,aP=aT.actions,aQ=document.createElement("div"),aV="",aS;aT.actionParams={};for(var aR=0,aY=aP.length;aR<aY;aR++){aV+=this.renderAction(aP[aR],aT)}aQ.innerHTML=YAHOO.lang.substitute(aV,this.getActionUrls(aT));v.addClass(aQ,"action-set");v.addClass(aQ,this.options.simpleView?"simple":"detailed");var aW=aK.isContainer?2:3;aS=YAHOO.util.Selector.query("div",aQ);if(aS.length>aW+(this.options.simpleView?0:1)){var aO=v.get(this.id+"-moreActions").cloneNode(true),aX=YAHOO.util.Selector.query("div",aO);v.insertBefore(aX[0],aS[aW]);v.insertBefore(aX[1],aS[aW]);var aU,aL=aS.slice(aW);for(aU in aL){if(aL.hasOwnProperty(aU)){aX[1].appendChild(aL[aU])}}}aM.appendChild(aQ)}if(this.showingMoreActions){this.deferredActionsMenu=aM}else{if(!v.hasClass(document.body,"masked")){this.currentActionsMenu=aM;v.removeClass(aM,"hidden");this.deferredActionsMenu=null}}},onEventUnhighlightRow:function E(aL){this.widgets.dataTable.onEventUnhighlightRow.call(this.widgets.dataTable,aL);var aK=v.get(this.id+"-actions-"+(aL.target.id));if((aK&&!this.showingMoreActions)||v.hasClass(document.body,"masked")){v.addClass(aK,"hidden");this.deferredActionsMenu=null}},onActionShowMore:function y(aL,aO){var aQ=this;v.addClass(aO.firstChild,"highlighted");var aT=v.getNextSibling(aO);v.removeClass(aT,"hidden");aQ.showingMoreActions=true;var aS=function aR(){I.removeListener(aT,"mouseover");I.removeListener(aT,"mouseout");v.removeClass(aO.firstChild,"highlighted");v.addClass(aT,"hidden");aQ.showingMoreActions=false;if(aQ.deferredActionsMenu!==null){v.addClass(aQ.currentActionsMenu,"hidden");aQ.currentActionsMenu=aQ.deferredActionsMenu;aQ.deferredActionsMenu=null;v.removeClass(aQ.currentActionsMenu,"hidden")}};if(aT.hideTimerId){window.clearTimeout(aT.hideTimerId)}aT.hideTimerId=window.setTimeout(aS,aQ.options.actionsPopupTimeout*4);var aM=function aK(aV,aU){if(aU.hideTimerId){window.clearTimeout(aU.hideTimerId);aU.hideTimerId=null}};var aP=function aN(aW,aV){var aX=I.getTarget(aW);var aU=aX.relatedTarget;if((aU!==aV)&&(!v.isAncestor(aV,aU))){if(aV.hideTimerId){window.clearTimeout(aV.hideTimerId)}aV.hideTimerId=window.setTimeout(aS,aQ.options.actionsPopupTimeout)}};I.on(aT,"mouseover",aM,aT);I.on(aT,"mouseout",aP,aT)},onActionEditOffline:function M(aM){if(!this.state.actionEditOfflineActive){this.state.actionEditOfflineActive=true;var aN=aM.jsNode.nodeRef,aL=aM.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},callback:{fn:function aO(aR){this.state.actionEditOfflineActive=false;this.options.highlightFile=aL;var aQ=function aP(){var aU=Alfresco.constants.PROXY_URI+aR.json.results[0].downloadUrl;if(YAHOO.env.ua.ie>6){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-offline.success",aL),text:this.msg("message.edit-offline.success.ie7"),buttons:[{text:this.msg("button.download"),handler:function aT(){window.location=aU;this.destroy()},isDefault:true},{text:this.msg("button.close"),handler:function aS(){this.destroy()}}]})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-offline.success",aL)});YAHOO.lang.later(3000,this,function(){window.location=aU})}};this.afterDocListUpdate.push(aQ)},scope:this}},failure:{callback:{fn:function aK(){this.state.actionEditOfflineActive=false},scope:this},message:this.msg("message.edit-offline.failure",aL)},webscript:{method:Alfresco.util.Ajax.POST,name:"checkout/node/{nodeRef}",params:{nodeRef:aN.uri}}})}},onActionCheckoutToGoogleDocs:function az(aM){var aL=aM.displayName,aO=aM.jsNode.nodeRef,aP=aM.location.path,aR=aM.fileName;var aQ=Alfresco.util.PopupManager.displayMessage({displayTime:0,effect:null,text:this.msg("message.checkout-google.inprogress",aL)});this.modules.actions.genericAction({success:{event:{name:"changeFilter",obj:{filterId:"editingMe"}},callback:{fn:function aK(aU){aQ.destroy();this.options.highlightFile=aL;var aS=function aT(){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkout-google.success",aL)})};this.afterDocListUpdate.push(aS)},scope:this},activity:{siteId:this.options.siteId,activityType:"google-docs-checkout",page:"document-details",activityData:{fileName:aR,path:aP,nodeRef:aO.toString()}}},failure:{callback:{fn:function aN(aS){aQ.destroy();Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkout-google.failure",aL)})},scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:"checkout/node/{nodeRef}",params:{nodeRef:aO.uri}}})},onActionCheckinFromGoogleDocs:function k(aM){var aL=aM.displayName,aN=aM.jsNode.nodeRef,aK=new Alfresco.util.NodeRef(aM.workingCopy.sourceNodeRef),aO=aM.location.path;var aQ=Alfresco.util.PopupManager.displayMessage({displayTime:0,effect:null,text:this.msg("message.checkin-google.inprogress",aL)});this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},callback:{fn:function aP(aT){aQ.destroy();var aR=function aS(){Alfresco.util.PopupManager.displayMessage({text:this.msg("message.checkin-google.success",aL)})};this.afterDocListUpdate.push(aR)},scope:this},activity:{siteId:this.options.siteId,activityType:"google-docs-checkin",page:"document-details",activityData:{fileName:aL,path:aO,nodeRef:aK.toString()}}},failure:{message:this.msg("message.checkin-google.failure",aL)},webscript:{method:Alfresco.util.Ajax.POST,name:"checkin/node/{nodeRef}",params:{nodeRef:aN.uri}}})},onFileAction:function ao(aL,aK){var aM=aK[1];if(aM){if(!aM.multiple){this._updateDocList.call(this)}}},onFileRenamed:function F(aL,aK){var aO=aK[1];if(aO&&(aO.file!==null)){var aN=this._findRecordByParameter(aO.file.node.nodeRef,"nodeRef");if(aN!==null){this.widgets.dataTable.updateRow(aN,aO.file);var aM=this.widgets.dataTable.getTrEl(aN);Alfresco.util.Anim.pulse(aM)}}},onDocListRefresh:function W(aL,aK){var aM=aK[1];if(aM&&(aM.highlightFile!==null)){this.options.highlightFile=aM.highlightFile}this._updateDocList.call(this)},onChangeFilter:function D(aM,aL){var aP=aL[1];if((aP!==null)&&(aP.filterId!==null)){var aO=Alfresco.util.cleanBubblingObject(aP),aN=window.escape(aP.filterId)+(typeof aP.filterData!=="undefined"?"|"+window.escape(aP.filterData):"");Alfresco.logger.debug("DL_onChangeFilter: ",aO);this._removeDragAndDrop();if(aP.filterId==="path"){this._addDragAndDrop()}this.listUpdated=true;var aK={filter:aN};if(aP.doclistFirstTimeNav){this._updateDocList.call(this,{filter:aO,page:this.currentPage})}else{if(this.options.usePagination){this.currentPage=1;aK.page="1"}Alfresco.logger.debug("DL_onChangeFilter: objNav = ",aK);if(this.options.highlightFile&&aK.filter===YAHOO.util.History.getCurrentState("filter")){YAHOO.Bubbling.fire("highlightFile",{fileName:this.options.highlightFile})}YAHOO.util.History.multiNavigate(aK)}}},onFilterChanged:function s(aL,aK){var aM=aK[1];if((aM!==null)&&(aM.filterId!==null)){aM.filterOwner=aM.filterOwner||Alfresco.util.FilterManager.getOwner(aM.filterId);this.currentFilter=Alfresco.util.cleanBubblingObject(aM);Alfresco.logger.debug("DL_onFilterChanged: ",this.currentFilter)}},onHighlightFile:function Y(aL,aK){var aP=aK[1];if((aP!==null)&&(A(aP.fileName))){Alfresco.logger.debug("DL_onHighlightFile: ",aP.fileName);var aO=this._findRecordByParameter(aP.fileName,"displayName");if(aO!==null){var aM=this.widgets.dataTable.getTrEl(aO),aN=v.getY(aM);if(YAHOO.env.ua.ie>0){aN=aN-(document.body.clientHeight/3)}else{aN=aN-(window.innerHeight/3)}window.scrollTo(0,aN);Alfresco.util.Anim.pulse(aM);this.options.highlightFile=null;v.get("checkbox-"+aO.getId()).checked=true;this.selectedFiles[aO.getData("nodeRef")]=true;YAHOO.Bubbling.fire("selectedFilesChanged")}}},onDeactivateAllControls:function O(aM,aL){var aK,aN=Alfresco.util.disableYUIButton;for(aK in this.widgets){if(this.widgets.hasOwnProperty(aK)){aN(this.widgets[aK])}}},onDeactivateDynamicControls:function ah(aM,aL){var aK,aN=Alfresco.util.disableYUIButton;for(aK in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(aK)){aN(this.dynamicControls[aK])}}},onActivateDynamicControls:function B(aM,aL){var aK,aN=Alfresco.util.enableYUIButton;for(aK in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(aK)){aN(this.dynamicControls[aK])}}},onLikes:function x(aQ){var aP=this.widgets.dataTable.getRecord(aQ),aK=aP.getData(),aO=aK.jsNode.nodeRef,aL=aK.likes;aL.isLiked=!aL.isLiked;aL.totalLikes+=(aL.isLiked?1:-1);var aM={successCallback:{fn:function aR(aY,aV){var aZ=aY.json.data;if(aZ){var aX=this._findRecordByParameter(aV,"nodeRef"),aS=aX.getData(),aW=aS.node,aT=aS.likes;aT.totalLikes=aZ.ratingsCount;this.widgets.dataTable.updateRow(aX,aS);if(aT.isLiked){var aU={fileName:aS.fileName,nodeRef:aW.nodeRef};if(aW.isContainer){this.modules.actions.postActivity(this.options.siteId,"folder-liked","folder-details",aU)}else{this.modules.actions.postActivity(this.options.siteId,"file-liked","document-details",aU)}}}},scope:this,obj:aO.toString()},failureCallback:{fn:function aN(aW,aU){var aV=this._findRecordByParameter(aU,"nodeRef"),aS=aV.getData(),aT=aS.likes;aT.isLiked=!aT.isLiked;aT.totalLikes+=(aT.isLiked?1:-1);this.widgets.dataTable.updateRow(aV,aS);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",aS.displayName)})},scope:this,obj:aO.toString()}};if(aL.isLiked){this.services.likes.set(aO,1,aM)}else{this.services.likes.remove(aO,aM)}this.widgets.dataTable.updateRow(aP,aK)},onFavourite:function am(aQ){var aR=this.widgets.dataTable.getRecord(aQ),aO=aR.getData(),aN=aO.node,aP=aN.nodeRef;aO.isFavourite=!aO.isFavourite;this.widgets.dataTable.updateRow(aR,aO);var aS={failureCallback:{fn:function aK(aX,aT){var aW=this.widgets.dataTable.getRecord(aT),aU=aW.getData(),aV=aU.node;aU.isFavourite=!aU.isFavourite;this.widgets.dataTable.updateRow(aW,aU);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",aU.displayName)})},scope:this,obj:aQ}};var aL=aO.isFavourite?"add":"remove",aM=aN.isContainer?Alfresco.service.Preferences.FAVOURITE_FOLDERS:Alfresco.service.Preferences.FAVOURITE_DOCUMENTS;this.services.preferences[aL].call(this.services.preferences,aM,aP,aS)},_setDefaultDataTableErrors:function e(aK){var aL=Alfresco.util.message;aK.set("MSG_EMPTY",aL("message.empty","Alfresco.DocumentList"));aK.set("MSG_ERROR",aL("message.error","Alfresco.DocumentList"))},_updateDocList:function ar(aX){aX=aX||{};Alfresco.logger.debug("DL__updateDocList: ",aX.filter,aX.page);var aZ=YAHOO.lang.merge({doclistFirstTimeNav:false},aX.filter!==undefined?aX.filter:this.currentFilter),aL=aX.page!==undefined?aX.page:this.currentPage,aT=null,aP=null,aV=this,aN={filter:aZ,page:aL};var aQ=function aU(){Alfresco.logger.debug("DL__uDL_fnShowLoadingMessage: slow data webscript detected.");if(aP){aT=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+f(this.msg("message.loading"))+"</span>",noEscape:true});if(YAHOO.env.ua.ie>0){this.loadingMessageShowing=true}else{aT.showEvent.subscribe(function(){this.loadingMessageShowing=true},this,true)}}};this._setDefaultDataTableErrors(this.widgets.dataTable);this.previewTooltips=[];this.insituEditors=[];this.showingMoreActions=false;this.loadingMessageShowing=false;aP=YAHOO.lang.later(this.options.loadingMessageDelay,this,aQ);var aY=function aR(){if(aP){aP.cancel();aP=null}if(aT){if(this.loadingMessageShowing){aT.destroy();aT=null}else{YAHOO.lang.later(100,aV,aY)}}};var aS=function aM(a2,a3,a4){aY();var a0=function a1(){YAHOO.Bubbling.fire("activateDynamicControls");YAHOO.Bubbling.fire("selectedFilesChanged");this.listUpdated=false};this.afterDocListUpdate.push(a0);Alfresco.logger.debug("currentFilter was:",this.currentFilter,"now:",aZ);Alfresco.logger.debug("currentPage was ["+this.currentPage+"] now ["+aL+"]");this.currentFilter=aZ;this.currentPage=aL;if(aZ.filterId==="path"){Alfresco.logger.debug("currentPath was ["+this.currentPath+"] now ["+aZ.filterData+"]");this.currentPath=aZ.filterData}delete aZ.doclistFirstTimeNav;YAHOO.Bubbling.fire("filterChanged",aZ);this.widgets.dataTable.onDataReturnInitializeTable.call(this.widgets.dataTable,a2,a3,a4)};var aK=function aO(a0,a1){aY();this.afterDocListUpdate=[];if(a1.status===401){window.location.reload(true)}else{try{if(a1.status===404){YAHOO.Bubbling.fire("deactivateDynamicControls")}else{YAHOO.Bubbling.fire("deactivateAllControls")}var a4=function a2(a6){return function a5(){this.widgets.paginator.setState({totalRecords:0});this.widgets.paginator.render();this.widgets.dataTable.set("MSG_ERROR",a6);this.widgets.dataTable.showTableMessage(a6,YAHOO.widget.DataTable.CLASS_ERROR)}};this.afterDocListUpdate.push(a4(YAHOO.lang.JSON.parse(a1.responseText).message));this.widgets.dataTable.initializeTable();this.widgets.dataTable.render();this.listUpdated=false}catch(a3){Alfresco.logger.error(a3);this._setDefaultDataTableErrors(this.widgets.dataTable)}}};if(aN.filter&&aN.filter.filterId==="path"){aN.path=aN.filter.filterData}var aW=this._buildDocListParams(aN);Alfresco.logger.debug("DataSource requestParams: ",aW);this.widgets.dataSource.sendRequest(aW,{success:aS,failure:aK,scope:this})},_buildDocListParams:function a(aO){var aL=A(this.options.siteId),aM={path:this.currentPath,type:this.options.showFolders?"all":"documents",site:this.options.siteId,container:this.options.containerId,filter:this.currentFilter};if(this.options.usePagination){aM.page=this.widgets.paginator.getCurrentPage()||this.currentPage;aM.pageSize=this.widgets.paginator.getRowsPerPage()}if(typeof aO==="object"){aM=YAHOO.lang.merge(aM,aO)}var aK=aL?"site/{site}/{container}":"node/alfresco/company/home",aN=YAHOO.lang.substitute("{type}/"+aK+(aM.filter.filterId==="path"?"{path}":""),{type:encodeURIComponent(aM.type),site:encodeURIComponent(aM.site),container:encodeURIComponent(aM.container),path:at("/",Alfresco.util.encodeURIPath(aM.path).replace(/%25/g,"%2525"))});aN+="?filter="+encodeURIComponent(aM.filter.filterId);if(aM.filter.filterData&&aM.filter.filterId!=="path"){aN+="&filterData="+encodeURIComponent(aM.filter.filterData)}if(this.options.usePagination){aN+="&size="+aM.pageSize+"&pos="+aM.page}aN+="&sortAsc="+this.options.sortAscending+"&sortField="+encodeURIComponent(this.options.sortField);if(!aL){aN+="&libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}aN+="&view="+this.actionsView+"&noCache="+new Date().getTime();return aN},_findRecordByParameter:function av(aQ,aP){var aO=this.widgets.dataTable.getRecordSet(),aN,aK,aM,aL;for(aM=0,aL=aO.getLength();aM<aL;aM++){aN=aO.getRecord(aM);aK=aN.getData();if(aK[aP]===aQ||(aK.node&&aK.node[aP]===aQ)){return aN}}return null}},true)})();