(function(){var k=YAHOO.util.Dom,l=YAHOO.util.Event,d=YAHOO.util.KeyListener;var h=Alfresco.util.encodeHTML;Alfresco.DateRange=function(n,m){Alfresco.DateRange.superclass.constructor.call(this,"Alfresco.DateRange",n,["button","calendar"]);this.valueHtmlId=m;this.currentFromDate="";this.currentToDate="";return this};YAHOO.extend(Alfresco.DateRange,Alfresco.component.Base,{currentFromDate:null,currentToDate:null,onReady:function c(){var m=new Date();var n=new Date();n.setMonth(m.getMonth()-1);var p=(n.getMonth()+1)+"/"+n.getFullYear();var o=(n.getMonth()+1)+"/"+n.getDate()+"/"+n.getFullYear();this.widgets.calendarFrom=new YAHOO.widget.Calendar(this.id+"-from",this.id+"-from",{title:this.msg("form.control.date-picker.choose"),close:true});this.widgets.calendarFrom.cfg.setProperty("pagedate",p);this.widgets.calendarFrom.cfg.setProperty("selected",o);this.widgets.calendarFrom.hideEvent.subscribe(function(){k.getElementsByClassName("datepicker-icon","img",this.id+"-icon-from")[0].focus()},this,true);Alfresco.util.calI18nParams(this.widgets.calendarFrom);Alfresco.util.useAsButton(k.getElementsByClassName("datepicker-icon","img",this.id+"-icon-from")[0],this._showPickerFrom,null,this);p=(m.getMonth()+1)+"/"+m.getFullYear();o=(m.getMonth()+1)+"/"+m.getDate()+"/"+m.getFullYear();this.widgets.calendarTo=new YAHOO.widget.Calendar(this.id+"-to",this.id+"-to",{title:this.msg("form.control.date-picker.choose"),close:true});this.widgets.calendarTo.cfg.setProperty("pagedate",p);this.widgets.calendarTo.cfg.setProperty("selected",o);this.widgets.calendarTo.hideEvent.subscribe(function(){k.getElementsByClassName("datepicker-icon","img",this.id+"-icon-to")[0].focus()},this,true);Alfresco.util.calI18nParams(this.widgets.calendarTo);Alfresco.util.useAsButton(k.getElementsByClassName("datepicker-icon","img",this.id+"-icon-to")[0],this._showPickerTo,null,this);this.widgets.calendarFrom.selectEvent.subscribe(this._handlePickerChangeFrom,this,true);l.addListener(this.id+"-date-from","keyup",this._handleFieldChangeFrom,this,true);l.addListener(this.id+"-icon-from","click",this._showPickerFrom,this,true);this.widgets.calendarTo.selectEvent.subscribe(this._handlePickerChangeTo,this,true);l.addListener(this.id+"-date-to","keyup",this._handleFieldChangeTo,this,true);l.addListener(this.id+"-icon-to","click",this._showPickerTo,this,true);this.widgets.calendarFrom.render();this.widgets.calendarTo.render()},_showPickerFrom:function e(m){this.widgets.calendarFrom.show()},_showPickerTo:function i(m){this.widgets.calendarTo.show()},_handlePickerChangeFrom:function f(r,o,s){var q=o[0];var p=this.widgets.calendarFrom.toDate(q[0]);var n=p.toString(this.msg("form.control.date-picker.entry.date.format"));k.get(this.id+"-date-from").value=n;if(p!=null){var m=Alfresco.util.toISO8601(p,{milliseconds:false});this.currentFromDate=m;this._updateCurrentValue();k.removeClass(this.id+"-date-from","invalid")}if(k.getStyle(this.id+"-from","display")!="none"){this.widgets.calendarFrom.hide()}},_handlePickerChangeTo:function j(r,o,s){var q=o[0];var p=this.widgets.calendarTo.toDate(q[0]);var n=p.toString(this.msg("form.control.date-picker.entry.date.format"));k.get(this.id+"-date-to").value=n;if(p!=null){var m=Alfresco.util.toISO8601(p,{milliseconds:false});this.currentToDate=m;this._updateCurrentValue();k.removeClass(this.id+"-date-to","invalid")}if(k.getStyle(this.id+"-to","display")!="none"){this.widgets.calendarTo.hide()}},_updateCurrentValue:function a(){var m=this.currentFromDate+"|"+this.currentToDate;m=m=="|"?"":m;k.get(this.valueHtmlId).value=m},_handleFieldChangeFrom:function b(p){var q=k.get(this.id+"-date-from").value;if(q.length>0){if(p==undefined||(p.keyCode!=d.KEY.TAB&&p.keyCode!=d.KEY.SHIFT)){var o=Date.parseExact(q,this.msg("form.control.date-picker.entry.date.format"));if(o!=null){this.widgets.calendarFrom.select((o.getMonth()+1)+"/"+o.getDate()+"/"+o.getFullYear());var n=this.widgets.calendarFrom.getSelectedDates();if(n.length>0){k.removeClass(this.id+"-date-from","invalid");var m=n[0];this.widgets.calendarFrom.cfg.setProperty("pagedate",(m.getMonth()+1)+"/"+m.getFullYear());this.widgets.calendarFrom.render()}}else{k.addClass(this.id+"-date-from","invalid")}}}else{k.removeClass(this.id+"-date-from","invalid");this.currentFromDate="";this._updateCurrentValue()}},_handleFieldChangeTo:function g(p){var q=k.get(this.id+"-date-to").value;if(q.length>0){var o=Date.parseExact(q,this.msg("form.control.date-picker.entry.date.format"));if(o!=null){this.widgets.calendarTo.select((o.getMonth()+1)+"/"+o.getDate()+"/"+o.getFullYear());var n=this.widgets.calendarTo.getSelectedDates();if(n.length>0){k.removeClass(this.id+"-date-to","invalid");var m=n[0];this.widgets.calendarTo.cfg.setProperty("pagedate",(m.getMonth()+1)+"/"+m.getFullYear());this.widgets.calendarTo.render()}}else{k.addClass(this.id+"-date-to","invalid")}}else{k.removeClass(this.id+"-date-to","invalid");this.currentToDate="";this._updateCurrentValue()}}})})();