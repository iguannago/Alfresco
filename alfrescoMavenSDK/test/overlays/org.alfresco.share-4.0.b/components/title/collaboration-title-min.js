(function(){var e=YAHOO.util.Dom,b=YAHOO.util.Event;Alfresco.CollaborationTitle=function(i){Alfresco.CollaborationTitle.superclass.constructor.call(this,"Alfresco.CollaborationTitle",i);this.preferencesService=new Alfresco.service.Preferences();return this};YAHOO.extend(Alfresco.CollaborationTitle,Alfresco.component.Base,{options:{user:null,site:null,siteTitle:null},onReady:function a(){b.on(e.get(this.id+"-join-link"),"click",function(i){this.joinSite();b.stopEvent(i)},this,true);b.on(e.get(this.id+"-requestJoin-link"),"click",function(i){this.requestJoinSite();b.stopEvent(i)},this,true);this.widgets.more=new YAHOO.widget.Button(this.id+"-more",{type:"menu",menu:this.id+"-more-menu"});if(this.widgets.more.getMenu()){this.widgets.more.getMenu().subscribe("click",function(k,j){var l=j[1];if(l){switch(l.value){case"editSite":Alfresco.module.getEditSiteInstance().show({shortName:this.options.site});break;case"customiseSite":window.location=Alfresco.constants.URL_PAGECONTEXT+"site/"+this.options.site+"/customise-site";break;case"leaveSite":var m=this;Alfresco.util.PopupManager.displayPrompt({title:m.msg("message.leave",m.options.siteTitle),text:m.msg("message.leave-site-prompt",m.options.siteTitle),buttons:[{text:m.msg("button.ok"),handler:function n(){m.leaveSite();this.destroy()}},{text:m.msg("button.cancel"),handler:function i(){this.destroy()},isDefault:true}]});break}}},this,true)}},joinSite:function h(){Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships",dataObj:{role:"SiteConsumer",person:{userName:this.options.user}},successCallback:{fn:function i(){window.location.reload()},scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.join-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.joining",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},requestJoinSite:function f(){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/invitations",dataObj:{invitationType:"MODERATED",inviteeUserName:this.options.user,inviteeComments:"",inviteeRoleName:"SiteConsumer"},successCallback:{fn:this._requestJoinSuccess,scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.request-join-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request-joining",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},_requestJoinSuccess:function g(i){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.success"),text:this.msg("message.request-join-success",this.options.user,this.options.siteTitle),buttons:[{text:this.msg("button.ok"),handler:function j(){this.destroy();window.location=Alfresco.constants.URL_CONTEXT},isDefault:true}]})},leaveSite:function c(){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships/"+encodeURIComponent(this.options.user),method:"DELETE",successCallback:{fn:function i(){window.location.href=Alfresco.constants.URL_CONTEXT},scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.leave-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.leaving",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},_failureCallback:function d(j,i){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}if(i){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:i})}}})})();