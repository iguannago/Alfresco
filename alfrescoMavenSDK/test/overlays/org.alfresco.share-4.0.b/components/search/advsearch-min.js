(function(){var e=YAHOO.util.Dom,i=YAHOO.util.Event;var c=Alfresco.util.encodeHTML;Alfresco.AdvancedSearch=function(j){Alfresco.AdvancedSearch.superclass.constructor.call(this,"Alfresco.AdvancedSearch",j,["button","container"]);YAHOO.Bubbling.on("beforeFormRuntimeInit",this.onBeforeFormRuntimeInit,this);return this};YAHOO.extend(Alfresco.AdvancedSearch,Alfresco.component.Base,{options:{siteId:"",searchForms:[],savedQuery:""},currentForm:null,onReady:function a(){var m=this,p=this.id+"-form-list",k=e.get(p);var j=this.options.searchForms[0];if(this.options.savedQuery.length!==0){var o=YAHOO.lang.JSON.parse(this.options.savedQuery);if(o.datatype){for(var n in this.options.searchForms){var l=this.options.searchForms[n];if(l.type===o.datatype){j=l;break}}}}this.widgets.searchButton1=Alfresco.util.createYUIButton(this,"search-button-1",this.onSearchClick);this.widgets.searchButton2=Alfresco.util.createYUIButton(this,"search-button-2",this.onSearchClick);this.widgets.formButton=Alfresco.util.createYUIButton(this,"selected-form-button",function(s,r){var t=this.options.searchForms[r[1].index];this.widgets.formButton.set("label",t.label);this.widgets.formButton.set("title",t.description);this.renderFormTemplate(t)},{label:j.label,title:j.description,type:"menu",menu:"selected-form-list"});this.renderFormTemplate(j,true);var q=e.get(this.id+"-search-text");this.widgets.enterListener=new YAHOO.util.KeyListener(q,{keys:YAHOO.util.KeyListener.KEY.ENTER},{fn:m._searchEnterHandler,scope:this,correctScope:true},"keydown").enable();e.setStyle(this.id+"-body","visibility","visible")},renderFormTemplate:function b(k,q){this.currentForm=k;this.currentForm.repopulate=q;var p=e.get(this.id+"-forms");var o=function(){for(var s=0,t=p.children;s<t.length;s++){if(!e.hasClass(t[s],"hidden")){e.addClass(t[s],"hidden");break}}e.removeClass(k.htmlid,"hidden");e.get(this.id+"-search-text").focus()};if(!k.htmlid){var r=this.id+"_"+p.children.length;var l=document.createElement("div");l.id=r;e.addClass(l,"hidden");e.addClass(l,"share-form");k.htmlid=r;var j=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?itemKind=type&itemId={itemId}&formId={formId}&mode=edit&showSubmitButton=false&showCancelButton=false",{itemId:k.type,formId:k.id});var n={htmlid:r};Alfresco.util.Ajax.request({url:j,dataObj:n,successCallback:{fn:function m(s){l.innerHTML=s.serverResponse.responseText;p.appendChild(l);o.call(this)},scope:this},failureMessage:"Could not load form component '"+j+"'.",scope:this,execScripts:true})}else{o.call(this)}},repopulateCurrentForm:function g(){if(this.options.savedQuery.length!==0){var q=YAHOO.lang.JSON.parse(this.options.savedQuery);var k=e.get(this.currentForm.runtime.formId);for(var o=0,m=k.elements.length;o<m;o++){var n=k.elements[o];var l=n.name;if(l!=undefined&&l!=="-"){var p=q[l];if(p!==undefined){if(n.type==="checkbox"||n.type==="radio"){n.checked=(p==="true")}else{n.value=p}}}}}},onSearchClick:function f(m,l){var k=this.currentForm.runtime.getFormData();k.datatype=this.currentForm.type;var j=YAHOO.lang.substitute(Alfresco.constants.URL_PAGECONTEXT+"{site}search?t={terms}&q={query}",{site:(this.options.siteId.length!==0?("site/"+this.options.siteId+"/"):""),terms:encodeURIComponent(e.get(this.id+"-search-text").value),query:encodeURIComponent(YAHOO.lang.JSON.stringify(k))});window.location.href=j},onBeforeFormRuntimeInit:function h(k,j){this.currentForm.runtime=j[1].runtime;if(this.currentForm.repopulate){this.currentForm.repopulate=false;this.repopulateCurrentForm()}},_searchEnterHandler:function d(k,j){this.onSearchClick(k,j)}})})();