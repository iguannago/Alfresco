(function(){var f=YAHOO.util.Dom,j=YAHOO.util.Event,a=YAHOO.util.Element;var d=Alfresco.util.encodeHTML;Alfresco.ConsoleGroups=function(A){this.name="Alfresco.ConsoleGroups";Alfresco.ConsoleGroups.superclass.constructor.call(this,A);Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","datasource","datatable","json","history","columnbrowser"],this.onComponentsLoaded,this);YAHOO.Bubbling.on("newGroup",this.onNewGroup,this);YAHOO.Bubbling.on("updateGroup",this.onUpdateGroup,this);var y=this;this.panelHandlers={};SearchPanelHandler=function ae(){SearchPanelHandler.superclass.constructor.call(this,"search")};YAHOO.extend(SearchPanelHandler,Alfresco.ConsolePanelHandler,{_visible:false,isSearching:false,_selectedParentGroupShortName:null,onLoad:function C(){var ar=this;var ao=new YAHOO.widget.Button(y.id+"-search-button",{});ao.on("click",this.onSearchClick,ao,this);this.widgets.searchButton=ao;this.widgets.columnbrowser=new YAHOO.extension.ColumnBrowser(y.id+"-columnbrowser",{numVisible:3,rootUrl:Alfresco.constants.PROXY_URI+"api/rootgroups?sortBy=displayName",pagination:{rowsPerPage:y.options.maxPageSize,rowsPerPageParam:"maxItems",recordOffsetParam:"skipCount",firstPageLinkLabel:y._msg("tinyPagination.firstPageLinkLabel"),lastPageLinkLabel:y._msg("tinyPagination.lastPageLinkLabel"),previousPageLinkLabel:y._msg("tinyPagination.previousPageLinkLabel"),nextPageLinkLabel:y._msg("tinyPagination.nextPageLinkLabel"),pageReportTemplate:y._msg("tinyPagination.pageReportTemplate"),template:y._msg("tinyPagination.template")},columnInfoBuilder:{fn:this.onBuildColumnInfo,scope:this}});this.widgets.breadcrumb=new YAHOO.extension.ColumnBrowserBreadCrumb(y.id+"-breadcrumb",{columnBrowser:this.widgets.columnbrowser,root:y._msg("label.breadcrumb.root")});var aq=new YAHOO.widget.Button(y.id+"-browse-button",{});aq.on("click",this.onBrowseClick,aq,this);var ap=f.get(y.id+"-show-all");j.addListener(ap,"change",function(){var av={showAll:ap.checked};y.refreshUIState(av)},null,this);this.widgets.dataSource=new YAHOO.util.DataSource(Alfresco.constants.PROXY_URI+"api/groups?",{responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"data",metaFields:{recordOffset:"startIndex",totalRecords:"totalRecords"}}});this.widgets.dataSource.doBeforeParseData=function au(ay,ax){var aw=ax;if(ax){var av=ax.data;av.sort(function(aA,az){var aC=aA.shortName?aA.shortName.toLowerCase():"",aB=az.shortName?az.shortName.toLowerCase():"";return(aC>aB)?1:(aC<aB)?-1:0});aw={data:av}}if(av.length==0){ar._setResultsMessage("message.noresults")}else{if(av.length<y.options.maxSearchResults){ar._setResultsMessage("message.results",d(y.query),av.length)}else{ar._setResultsMessage("message.maxresults",y.options.maxSearchResults)}}return aw};this._setupDataTable();var at=f.get(y.id+"-search-text");new YAHOO.util.KeyListener(at,{keys:YAHOO.util.KeyListener.KEY.ENTER},{fn:function(){this.onSearchClick()},scope:this,correctScope:true},"keydown").enable();Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/people-finder/people-finder",dataObj:{htmlid:y.id+"-search-peoplefinder"},successCallback:{fn:this.onPeopleFinderLoaded,scope:this},failureMessage:"Could not load People Finder component",execScripts:true});Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"components/people-finder/group-finder",dataObj:{htmlid:y.id+"-search-groupfinder"},successCallback:{fn:this.onGroupFinderLoaded,scope:this},failureMessage:"Could not load Group Finder component",execScripts:true});this.widgets.deleteGroupPanel=new Alfresco.util.createYUIPanel(y.id+"-deletegroupdialog",{visible:false});this.widgets.deleteGroupCancelButton=new YAHOO.widget.Button(y.id+"-cancel-button",{});this.widgets.deleteGroupCancelButton.on("click",function(){this.widgets.deleteGroupPanel.hide()},null,this);this.widgets.deleteGroupOkButton=Alfresco.util.createYUIButton(y,"remove-button",null)},onShow:function w(){this._visible=true;f.get(y.id+"-search-text").focus();var ao=f.get(y.id+"-show-all");ao.checked=y.showAll},onUpdate:function an(){if(y.refresh==undefined||y.query!==undefined){f.addClass(y.id+"-browse-panel","hidden");f.removeClass(y.id+"-search-panel","hidden");if(y.query!==undefined){var ao=f.get(y.id+"-search-text");ao.value=y.query;this.doSearch()}}else{f.addClass(y.id+"-search-panel","hidden");f.removeClass(y.id+"-browse-panel","hidden");var ap=this.widgets.columnbrowser.get("urlPath");if(!ap||ap.length==0){this.widgets.columnbrowser.load()}else{if(y.refresh){this.widgets.columnbrowser.load(ap,true)}}}},onHide:function F(){this._visible=false},onSearchClick:function r(){var ao=YAHOO.lang.trim(f.get(y.id+"-search-text").value);if(ao.replace(/\*/g,"").length<y.options.minSearchTermLength){Alfresco.util.PopupManager.displayMessage({text:y._msg("message.minimum-length",y.options.minSearchTermLength)});return}y.refreshUIState({query:ao})},onBrowseClick:function B(){y.refreshUIState({query:undefined,refresh:"false"})},onConfirmedDeleteGroupClick:function ad(ap,ao){this.widgets.deleteGroupPanel.hide();if(ao.multiParentMode&&f.get(y.id+"-remove").checked){this._removeGroup(ao.fullName,ao.parentShortName,ao.displayName)}else{this._deleteGroup(ao.shortName,ao.displayName)}},onGroupSelected:function O(aq,ap){if(this._visible){var ao=ap[1].displayName;this.widgets.addGroupPanel.hide();this._addToGroup(ap[1].itemName,this._selectedParentGroupShortName,y._msg("message.addgroup-success",ao),y._msg("message.addgroup-failure",ao))}},onPersonSelected:function v(aq,ap){if(this._visible){var ao=ap[1].firstName+" "+ap[1].lastName;this.widgets.addUserPanel.hide();this._addToGroup(ap[1].userName,this._selectedParentGroupShortName,y._msg("message.adduser-success",ao),y._msg("message.adduser-failure",ao))}},onNewGroupClick:function Q(ao){YAHOO.Bubbling.fire("newGroup",{group:ao.parent?ao.parent.shortName:undefined,groupDisplayName:ao.parent?ao.parent.label:y._msg("label.theroot")})},onAddGroupClick:function T(ao){this._selectedParentGroupShortName=ao.parent.shortName;this.modules.searchGroupFinder.clearResults();this.widgets.addGroupPanel.show()},onAddUserClick:function ai(ao){this._selectedParentGroupShortName=ao.parent.shortName;this.modules.searchPeopleFinder.clearResults();this.widgets.addUserPanel.show()},onDeleteClick:function ah(ao){this._confirmDeleteGroup(ao.itemInfo.shortName,ao.itemInfo.fullName,ao.itemInfo.label,ao.columnInfo.parent?ao.columnInfo.parent.shortName:null,ao.columnInfo.parent?ao.columnInfo.parent.label:y._msg("label.theroot"))},onUserRemoveClick:function al(ao){this._confirmRemoveUser(ao.columnInfo.parent.shortName,ao.itemInfo.shortName,ao.itemInfo.label)},onUpdateClick:function ag(ao){YAHOO.Bubbling.fire("updateGroup",{group:ao.itemInfo.shortName,groupDisplayName:ao.itemInfo.label})},onPeopleFinderLoaded:function t(ap){var ao=f.get(y.id+"-search-peoplefinder");ao.innerHTML=ap.serverResponse.responseText;this.widgets.addUserPanel=Alfresco.util.createYUIPanel(y.id+"-peoplepicker");this.modules.searchPeopleFinder=Alfresco.util.ComponentManager.get(y.id+"-search-peoplefinder");this.modules.searchPeopleFinder.setOptions({singleSelectMode:true});YAHOO.Bubbling.on("personSelected",this.onPersonSelected,this)},onGroupFinderLoaded:function z(ap){var ao=f.get(y.id+"-search-groupfinder");ao.innerHTML=ap.serverResponse.responseText;this.widgets.addGroupPanel=Alfresco.util.createYUIPanel(y.id+"-grouppicker");this.modules.searchGroupFinder=Alfresco.util.ComponentManager.get(y.id+"-search-groupfinder");this.modules.searchGroupFinder.setOptions({singleSelectMode:true});YAHOO.Bubbling.on("itemSelected",this.onGroupSelected,this)},onBuildColumnInfo:function s(av,ao){var au=[];if(!ao||ao.cssClass=="groups-item-group"){au.push({title:(ao?y._msg("button.newsubgroup"):y._msg("button.newgroup")),cssClass:"groups-newgroup-button",click:{fn:this.onNewGroupClick,scope:this}})}if(ao&&ao.cssClass=="groups-item-group"){au.push({title:y._msg("button.addgroup"),cssClass:"groups-addgroup-button",click:{fn:this.onAddGroupClick,scope:this}});au.push({title:y._msg("button.adduser"),cssClass:"groups-adduser-button",click:{fn:this.onAddUserClick,scope:this}})}var aq={parent:ao,header:{buttons:au},body:{items:[]}};var ar={};if(av){ar=YAHOO.lang.JSON.parse(av.responseText);if(ar.paging){aq.pagination={totalRecords:ar.paging.totalItems,recordOffset:ar.paging.skipCount}}}var aw=[{title:y._msg("button.updategroup"),cssClass:"groups-update-button",click:{fn:this.onUpdateClick,scope:this}},{title:y._msg("button.deletegroup"),cssClass:"groups-delete-button",click:{fn:this.onDeleteClick,scope:this}}];var ay=[{title:y._msg("button.removeuser"),cssClass:"users-remove-button",click:{fn:this.onUserRemoveClick,scope:this}}];for(var at=0;ar.data&&at<ar.data.length;at++){var ap=ar.data[at];var ax=ap.displayName;if(ap.displayName!==ap.shortName){ax+=" ("+ap.shortName+")"}var az={shortName:ap.shortName,fullName:ap.fullName,url:ap.authorityType=="GROUP"?Alfresco.constants.PROXY_URI+ap.url+"/children?sortBy=displayName":null,hasNext:ap.groupCount>0||ap.userCount>0,label:ax,next:null,cssClass:ap.authorityType=="GROUP"?"groups-item-group":"groups-item-user",buttons:ap.authorityType=="GROUP"?aw:ay};aq.body.items.push(az)}return aq},doSearch:function L(){if(!this.isSearching&&y.query!==undefined&&y.query.length>=y.options.minSearchTermLength){this.isSearching=true;var aq=this;aq._setDefaultDataTableErrors(aq.widgets.dataTable);aq.widgets.dataTable.set("MSG_EMPTY",y._msg("message.searching"));aq.widgets.dataTable.deleteRows(0,aq.widgets.dataTable.getRecordSet().getLength());var ao=function ar(au,av,aw){aq._enableSearchUI();aq._setDefaultDataTableErrors(aq.widgets.dataTable);aq.widgets.dataTable.onDataReturnInitializeTable.call(aq.widgets.dataTable,au,av,aw)};var ap=function at(au,av){aq._enableSearchUI();if(av.status==401){window.location.reload()}else{try{aq.widgets.dataTable.set("MSG_ERROR",y._msg("message.noresults.short"));aq.widgets.dataTable.showTableMessage(y._msg("message.noresults.short"),YAHOO.widget.DataTable.CLASS_ERROR);aq._setResultsMessage("message.noresults")}catch(aw){aq._setDefaultDataTableErrors(aq.widgets.dataTable)}}};aq.widgets.dataSource.sendRequest(aq._buildSearchParams(y.query),{success:ao,failure:ap,scope:y});aq._setResultsMessage("message.searchingFor",d(y.query));aq.widgets.searchButton.set("disabled",true);YAHOO.lang.later(2000,aq,function(){if(aq.isSearching){if(!aq.widgets.feedbackMessage){aq.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.searching",y.name),spanClass:"wait",displayTime:0})}else{if(!aq.widgets.feedbackMessage.cfg.getProperty("visible")){aq.widgets.feedbackMessage.show()}}}},[])}},_enableSearchUI:function ac(){if(this.widgets.feedbackMessage&&this.widgets.feedbackMessage.cfg.getProperty("visible")){this.widgets.feedbackMessage.hide()}this.widgets.searchButton.set("disabled",false);this.isSearching=false},_confirmDeleteGroup:function K(ao,at,ap,ar,au){var aq=this;y.getParentGroups(ao,{fn:function(av){this.widgets.deleteGroupOkButton.removeListener("click",this.onConfirmedDeleteGroupClick);var ax={shortName:ao,fullName:at,displayName:ap,parentShortName:ar,parentDisplayName:au};if(!av||av.length==0||av.length==1){f.addClass(y.id+"-multiparent","hidden");f.removeClass(y.id+"-singleparent","hidden");f.get(y.id+"-singleparent-message").innerHTML=y._msg("panel.deletegroup.singleparentmessage",d(ap));this.widgets.deleteGroupOkButton.on("click",this.onConfirmedDeleteGroupClick,ax,this)}else{f.addClass(y.id+"-singleparent","hidden");f.removeClass(y.id+"-multiparent","hidden");f.get(y.id+"-multiparent-message").innerHTML=y._msg("panel.deletegroup.multiparentmessage",d(ap));f.get(y.id+"-remove-message").innerHTML=y._msg("panel.deletegroup.removemessage",d(ap),d(au));f.get(y.id+"-delete-message").innerHTML=y._msg("panel.deletegroup.deletemessage",d(ap));f.get(y.id+"-searchdelete-message").innerHTML=y._msg("panel.deletegroup.searchdeletemessage",d(ap));var ay="",az=10;for(var aw=0;aw<av.length&&aw<az;aw++){ay+=av[aw].displayName+(aw<av.length-1?", ":"")}if(aw>=az){ay+=y._msg("label.moregroups",av.length-az)}f.get(y.id+"-parents").innerHTML=d(ay);if(ar){f.get(y.id+"-remove").checked=true;f.removeClass(y.id+"-removerow","hidden");f.removeClass(y.id+"-deleterow","hidden");f.addClass(y.id+"-searchdeleterow","hidden")}else{f.get(y.id+"-delete").checked=true;f.addClass(y.id+"-removerow","hidden");f.addClass(y.id+"-deleterow","hidden");f.removeClass(y.id+"-searchdeleterow","hidden")}ax.multiParentMode=true;this.widgets.deleteGroupOkButton.on("click",this.onConfirmedDeleteGroupClick,ax,this)}this.widgets.deleteGroupPanel.show()},scope:this},"message.delete-failure")},_confirmRemoveUser:function x(ar,aq,au){var at=this;Alfresco.util.PopupManager.displayPrompt({title:y._msg("message.confirm.removeuser.title"),text:y._msg("message.confirm.removeuser",au),buttons:[{text:y._msg("button.yes"),handler:function ao(){this.destroy();at._removeUser.call(at,ar,aq,au)}},{text:y._msg("button.no"),handler:function ap(){this.destroy()},isDefault:true}]})},_deleteGroup:function D(ao,ap){var aq=Alfresco.constants.PROXY_URI+"api/groups/"+encodeURIComponent(ao);this._doDeleteCall(aq,ap)},_removeGroup:function aa(ar,aq,ao){if(aq==null){Alfresco.util.PopupManager.displayPrompt({title:y._msg("message.failure"),text:y._msg("message.noRemoveGroupFromRootSupport")});return}var ap=Alfresco.constants.PROXY_URI+"api/groups/"+encodeURIComponent(aq)+"/children/"+encodeURIComponent(ar);this._doDeleteCall(ap,ao)},_doDeleteCall:function aj(aq,ap){var ao=ap;Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.DELETE,url:aq,successCallback:{fn:function(at){var ar=this.widgets.columnbrowser.get("urlPath");this.widgets.columnbrowser.load(ar,true);this.doSearch();Alfresco.util.PopupManager.displayMessage({text:y._msg("message.delete-success",ao)})},scope:this},failureMessage:y._msg("message.delete-failure",ao)})},_removeUser:function J(aq,ap,ar){var ao=ar;Alfresco.util.Ajax.request({method:Alfresco.util.Ajax.DELETE,url:Alfresco.constants.PROXY_URI+"api/groups/"+encodeURIComponent(aq)+"/children/"+encodeURIComponent(ap),successCallback:{fn:function(au){var at=this.widgets.columnbrowser.get("urlPath");this.widgets.columnbrowser.load(at,true);Alfresco.util.PopupManager.displayMessage({text:y._msg("message.removeuser-success",ao)})},scope:this},failureMessage:y._msg("message.removeuser-failure",ao)})},_addToGroup:function M(ao,ar,ap,aq){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"api/groups/"+encodeURIComponent(ar)+"/children/"+encodeURIComponent(ao),successCallback:{fn:function(au){var at=this.widgets.columnbrowser.get("urlPath");this.widgets.columnbrowser.load(at,true);Alfresco.util.PopupManager.displayMessage({text:ap})},scope:this},failureMessage:aq})},_setupDataTable:function E(){var ao=this;var ar=function ar(au,at,av,aw){au.innerHTML=d(aw)};var ap=function ap(aw,av,ax,ay){var at=document.createElement("a");f.addClass(at,"update");at.innerHTML="&nbsp;";YAHOO.util.Event.addListener(at,"click",function(az){YAHOO.Bubbling.fire("updateGroup",{group:av.getData("shortName"),groupDisplayName:av.getData("displayName"),query:this.query})},null,y);aw.appendChild(at);var au=document.createElement("a");f.addClass(au,"delete");au.innerHTML="&nbsp;";YAHOO.util.Event.addListener(au,"click",function(az){ao._confirmDeleteGroup(av.getData("shortName"),null,av.getData("displayName"),null,null)});aw.appendChild(au)};var aq=[{key:"shortName",label:y._msg("label.shortname"),sortable:true,formatter:ar},{key:"displayName",label:y._msg("label.displayname"),sortable:true,formatter:ar},{key:"actions",label:y._msg("label.actions"),sortable:false,formatter:ap}];this.widgets.dataTable=new YAHOO.widget.DataTable(y.id+"-datatable",aq,this.widgets.dataSource,{initialLoad:false,renderLoopSize:32,sortedBy:{key:"displayName",dir:"asc"},MSG_EMPTY:y._msg("message.empty")})},_setDefaultDataTableErrors:function Z(ao){ao.set("MSG_EMPTY",y._msg("message.empty","Alfresco.ConsoleGroups"));ao.set("MSG_ERROR",y._msg("message.error","Alfresco.ConsoleGroups"))},_buildSearchParams:function W(ap){var ap="shortNameFilter="+encodeURIComponent(ap);var ao=f.get(y.id+"-show-all").checked;return ao?ap:ap+"&zone=APP.DEFAULT"},_setResultsMessage:function l(ar,aq,ap){var ao=f.get(y.id+"-search-bar-text");ao.innerHTML=y._msg(ar,aq,ap)}});this.panelHandlers.searchPanelHandler=new SearchPanelHandler();CreatePanelHandler=function n(){CreatePanelHandler.superclass.constructor.call(this,"create")};YAHOO.extend(CreatePanelHandler,Alfresco.ConsolePanelHandler,{_visible:false,_refresh:false,onLoad:function P(){this.widgets.creategroupOkButton=new YAHOO.widget.Button(y.id+"-creategroup-ok-button",{type:"button"});this.widgets.creategroupOkButton.on("click",this.onCreateGroupOKClick,null,this);this.widgets.creategroupOkButton.set("disabled",true);this.widgets.creategroupAnotherButton=new YAHOO.widget.Button(y.id+"-creategroup-another-button",{type:"button"});this.widgets.creategroupAnotherButton.on("click",this.onCreateGroupAnotherClick,null,this);this.widgets.creategroupAnotherButton.set("disabled",true);this.widgets.creategroupCancelButton=new YAHOO.widget.Button(y.id+"-creategroup-cancel-button",{type:"button"});this.widgets.creategroupCancelButton.on("click",this.onCreateGroupCancelClick,null,this);var ao=new Alfresco.forms.Form(y.id+"-create-form");ao.setSubmitElements([this.widgets.creategroupOkButton,this.widgets.creategroupAnotherButton]);ao.setShowSubmitStateDynamically(true);ao.addValidation(y.id+"-create-shortname",Alfresco.forms.validation.mandatory,null,"keyup");ao.addValidation(y.id+"-create-shortname",Alfresco.forms.validation.nodeName,null,"keyup");ao.addValidation(y.id+"-create-shortname",Alfresco.forms.validation.length,{min:3,max:100,crop:true,includeWhitespace:false},"keyup");ao.addValidation(y.id+"-create-displayname",Alfresco.forms.validation.mandatory,null,"keyup");ao.addValidation(y.id+"-create-displayname",Alfresco.forms.validation.length,{min:3,max:255,crop:true,includeWhitespace:false},"keyup");ao.init();this.forms.createForm=ao},onBeforeShow:function u(){f.setStyle(y.id+"-create-main","visibility","hidden");this.clear()},clear:function ab(){f.get(y.id+"-create-shortname").value="";f.get(y.id+"-create-displayname").value="";if(this.forms.createForm!==null){this.forms.createForm.init()}},onShow:function I(){this._visible=true;this._refresh=false;window.scrollTo(0,0);f.setStyle(y.id+"-create-main","visibility","visible");f.get(y.id+"-create-shortname").focus()},onHide:function U(){this._visible=false},onCreateGroupOKClick:function q(aq,ap){var ao=function(ar){window.scrollTo(0,0);Alfresco.util.PopupManager.displayMessage({text:y._msg("message.create-success")});y.refreshUIState({panel:"search",refresh:"true"})};this._createGroup(ao)},onCreateGroupCancelClick:function af(ap,ao){y.refreshUIState({panel:"search",refresh:this._refresh?"true":"false"})},onCreateGroupAnotherClick:function H(aq,ap){var ao=function(ar){window.scrollTo(0,0);Alfresco.util.PopupManager.displayMessage({text:y._msg("message.create-success")});this._refresh=true;this.clear();f.get(y.id+"-create-shortname").focus()};this._createGroup(ao)},_createGroup:function ak(ap){var aq=this;var ao=YAHOO.lang.trim(f.get(y.id+"-create-shortname").value);y.getParentGroups(ao,{fn:function(ar){if(ar){var ax=false;var au="";for(var at=0;at<ar.length;at++){au+=ar[at].displayName+(at<ar.length-1?", ":"")}au=au.length>0?au:y._msg("label.theroot");Alfresco.util.PopupManager.displayPrompt({text:y._msg("message.confirm.add",ao,au,y.group?y.group:y._msg("label.theroot")),buttons:[{text:y._msg("button.ok"),handler:function aw(){this.destroy();if(y.group){aq._createGroupAfterExistCheck.call(aq,ap)}else{Alfresco.util.PopupManager.displayPrompt({title:y._msg("message.failure"),text:y._msg("message.noAddGroupFromRootSupport")});return}}},{text:y._msg("button.cancel"),handler:function av(){this.destroy()},isDefault:true}]})}else{aq._createGroupAfterExistCheck.call(aq,ap)}},scope:this},"message.create-failure")},_createGroupAfterExistCheck:function V(ar){var ao=YAHOO.lang.trim(f.get(y.id+"-create-shortname").value);var ap=YAHOO.lang.trim(f.get(y.id+"-create-displayname").value);ap=ap==""?undefined:ap;var au={};var aq=Alfresco.constants.PROXY_URI+"api/";var at=ar;if(y.group&&y.group.length>0){aq+="groups/"+encodeURIComponent(y.group)+"/children/GROUP_"+encodeURIComponent(ao);at=function(av){if(ap&&ao!=ap){au.displayName=ap;y.panelHandlers.updatePanelHandler.updateGroupRequest(ao,au,{fn:ar,scope:this})}else{ar.call(this,av)}}}else{aq+="rootgroups/"+encodeURIComponent(ao);if(ap){au.displayName=ap}}Alfresco.util.Ajax.jsonPost({url:aq,dataObj:au,successCallback:{fn:at,scope:this},failureCallback:{fn:function(aw){var av=YAHOO.lang.JSON.parse(aw.serverResponse.responseText);Alfresco.util.PopupManager.displayPrompt({title:y._msg("message.failure"),text:y._msg("message.create-failure",av.message)})},scope:this}})}});this.panelHandlers.createPanelHandler=new CreatePanelHandler();UpdatePanelHandler=function p(){UpdatePanelHandler.superclass.constructor.call(this,"update")};YAHOO.extend(UpdatePanelHandler,Alfresco.ConsolePanelHandler,{_visible:false,onLoad:function S(){this.widgets.updategroupSaveButton=new YAHOO.widget.Button(y.id+"-updategroup-save-button",{type:"button"});this.widgets.updategroupSaveButton.on("click",this.onUpdateGroupOKClick,null,this);this.widgets.updategroupCancelButton=new YAHOO.widget.Button(y.id+"-updategroup-cancel-button",{type:"button"});this.widgets.updategroupCancelButton.on("click",this.onUpdateGroupCancelClick,null,this);var ao=new Alfresco.forms.Form(y.id+"-update-form");ao.setSubmitElements(this.widgets.updategroupSaveButton);ao.setShowSubmitStateDynamically(true);ao.addValidation(y.id+"-update-displayname",Alfresco.forms.validation.mandatory,null,"keyup");ao.addValidation(y.id+"-update-displayname",Alfresco.forms.validation.length,{min:3,max:255,crop:true,includeWhitespace:false},"keyup");ao.init();this.forms.updateForm=ao},onBeforeShow:function G(){f.setStyle(y.id+"-update-main","visibility","hidden")},onShow:function N(){this._visible=true},onHide:function X(){this._visible=false},onUpdate:function R(){var ao=function(aq){var ap=aq.json.data;f.get(y.id+"-update-title").innerHTML=d(ap.displayName);f.get(y.id+"-update-shortname").innerHTML=d(ap.shortName);f.get(y.id+"-update-displayname").value=ap.displayName;if(this.forms.updateForm){this.forms.updateForm.init()}window.scrollTo(0,0);f.setStyle(y.id+"-update-main","visibility","visible");f.get(y.id+"-update-displayname").focus()};Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"api/groups/"+encodeURIComponent(y.group),successCallback:{fn:ao,scope:this},failureMessage:y._msg("message.getgroup-failure",d(y.group))})},onUpdateGroupOKClick:function Y(aq,ao){var ap=function(ar){window.scrollTo(0,0);Alfresco.util.PopupManager.displayMessage({text:y._msg("message.update-success")});var at={panel:"search",refresh:"true"};if(y.query){at.query=y.query}y.refreshUIState(at)};this._updateGroup(ap)},onUpdateGroupCancelClick:function m(aq,ao){var ap={panel:"search",refresh:"false"};if(y.query){ap.query=y.query}y.refreshUIState(ap)},updateGroupRequest:function am(ap,aq,ao){Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"api/groups/"+encodeURIComponent(ap),dataObj:aq,successCallback:ao,failureCallback:{fn:function(ar){Alfresco.util.PopupManager.displayPrompt({title:y._msg("message.failure"),text:y._msg("message.update-failure",ar.json.message)})},scope:this}})},_updateGroup:function o(ao){this.updateGroupRequest(y.group,{displayName:YAHOO.lang.trim(f.get(y.id+"-update-displayname").value)},{fn:ao,scope:this})}});this.panelHandlers.updatePanelHandler=new UpdatePanelHandler();return this};YAHOO.extend(Alfresco.ConsoleGroups,Alfresco.ConsoleTool,{query:null,refresh:false,group:null,groupDisplayName:null,options:{minSearchTermLength:1,maxSearchResults:100,maxPageSize:50},onReady:function i(){Alfresco.ConsoleGroups.superclass.onReady.call(this)},onStateChanged:function g(o,m){this.query=undefined;this.refresh=undefined;this.group=undefined;this.groupDisplayName=undefined;var n=this.decodeHistoryState(m[1].state);if(n.query!==undefined){this.query=n.query}if(n.refresh){this.refresh=n.refresh=="true"?true:false}if(n.group){this.group=n.group}if(n.groupDisplayName){this.groupDisplayName=n.groupDisplayName}if(n.showAll){this.showAll=n.showAll=="true"?true:false;var l=Alfresco.constants.PROXY_URI+"api/rootgroups"+(this.showAll?"":"?zone=APP.DEFAULT");this.panelHandlers.searchPanelHandler.widgets.columnbrowser.load([l],true)}if(n.panel){this.showPanel(n.panel)}if(this.currentPanelId==="search"){this.updateCurrentPanel()}else{if(this.currentPanelId==="create"||(n.group&&(this.currentPanelId==="view"||this.currentPanelId==="update"))){this.updateCurrentPanel()}}},onNewGroup:function h(n,l){var m=l[1].group;this.refreshUIState({panel:"create",group:m})},onUpdateGroup:function b(p,l){var o=l[1].group;var n=l[1].query;var m={panel:"update",group:o};if(n){m.query=n}this.refreshUIState(m)},encodeHistoryState:function c(n){var l={};if(this.currentPanelId!==""){l.panel=this.currentPanelId}var m="";if(n.panel||l.panel){m+="panel="+encodeURIComponent(n.panel?n.panel:l.panel)}if(n.group){m+=m.length>0?"&":"";m+="group="+encodeURIComponent(n.group)}if(n.query!==undefined){m+=m.length>0?"&":"";m+="query="+encodeURIComponent(n.query)}if(n.refresh){m+=m.length>0?"&":"";m+="refresh="+encodeURIComponent(n.refresh)}if(n.showAll!==undefined){m+=m.length>0?"&":"";m+="showAll="+encodeURIComponent(n.showAll)}return m},getParentGroups:function e(m,l,n){Alfresco.util.Ajax.jsonGet({url:Alfresco.constants.PROXY_URI+"api/groups/"+encodeURIComponent(m)+"/parents?level=ALL&maxSize=10",successCallback:{fn:function(q){var p=q.json.data?q.json.data:[];l.fn.call(l.scope?l.scope:this,p)},scope:this},failureCallback:{fn:function(p){if(p.serverResponse.status==404){l.fn.call(l.scope?l.scope:this,null)}else{Alfresco.util.PopupManager.displayPrompt({title:this._msg("message.failure"),text:this._msg(n,p.json.message)})}},scope:this}})},_msg:function k(l){return Alfresco.util.message.call(this,l,"Alfresco.ConsoleGroups",Array.prototype.slice.call(arguments).slice(1))}})})();