(function(){var b=YAHOO.util.Dom,B=YAHOO.util.Selector,I=YAHOO.util.Event;var y=Alfresco.util.encodeHTML,F=Alfresco.util.hasEventInterest,r=Alfresco.util.combinePaths;Alfresco.RuleConfig=function w(J){Alfresco.RuleConfig.superclass.constructor.call(this,"Alfresco.RuleConfig",J,["button"]);this._configDefs={};this._datePickerConfigDefMap={};YAHOO.Bubbling.on("mandatoryControlValueUpdated",this.onDatePickerMandatoryControlValueUpdated,this);return this};var s=Alfresco.RuleConfig;YAHOO.lang.augmentObject(s,{MODE_TEXT:"text",MODE_EDIT:"edit"});YAHOO.extend(Alfresco.RuleConfig,Alfresco.component.Base,{options:{siteId:"",rootNode:null,mode:s.MODE_EDIT,ruleConfigType:null,ruleConfigDefinitionKey:"name",menuMap:[],ruleConfigDefinitions:[],customisationsMap:[],constraints:{},constraintsFilter:{},form:null},_configDefs:null,_datePickerConfigDefMap:null,onReady:function H(){var K=b.get(this.id+"-"+this.options.ruleConfigType+"-checkbox");if(K){I.addListener(K,"click",function(N,M){var L=b.get(this.id+"-configs");if(M.checked){b.removeClass(L,"hidden");this._toggleDisableOnElements(B.query("[param]",L),false);this._toggleDisableOnElements(B.query("select.config-name",L),false)}else{b.addClass(L,"hidden");this._toggleDisableOnElements(B.query("[param]",L),true);this._toggleDisableOnElements(B.query("select.config-name",L),true)}this._updateSubmitElements()},K,this)}var J=b.get(this.id+"-"+this.options.ruleConfigType+"-menubutton");if(J){this.widgets.relationButton=new YAHOO.widget.Button(J,{type:"menu",menu:this.id+"-"+this.options.ruleConfigType+"-menubuttonselect",menualignment:["tr","br"]})}this.widgets.configTemplateEl=b.get(this.id+"-configTemplate");this.widgets.selectTemplateEl=this._createSelectMenu();YAHOO.Bubbling.fire("ruleConfigReady",{eventGroup:this})},getRuleConfigs:function k(){var P=[];if(!b.hasClass(this.id+"-configs","hidden")){var M=B.query("li.config",this.id+"-body"),N,O,K;for(var L=0,J=M.length;L<J;L++){N=M[L];O=this._getSelectedConfigDef(N);if(O){K={};if(N.getAttribute("paramid")){K.id=N.getAttribute("paramid")}K[this.options.ruleConfigDefinitionKey]=O.name;K.parameterValues=this._getParameters(O);P.push(K)}}}return P},displayRuleConfigs:function c(O){b.removeClass(this.id+"-body",s.MODE_EDIT);b.removeClass(this.id+"-body",s.MODE_TEXT);b.addClass(this.id+"-body",this.options.mode);b.get(this.id+"-configs").innerHTML="";var M=b.get(this.id+"-"+this.options.ruleConfigType+"-checkbox");if(M&&this.options.mode==s.MODE_EDIT){b.removeClass(M,"hidden");M.checked=O.length>0}if(!O||O.length==0){if(this.options.mode==s.MODE_TEXT){b.addClass(this.id+"-body","hidden")}else{O.push({});b.addClass(this.id+"-configs","hidden")}}else{b.removeClass(this.id+"-body","hidden");b.removeClass(this.id+"-configs","hidden")}var N,L;for(var K=0,J=O.length;K<J;K++){N=O[K];this._createConfigUI(N,null,null)}this._refreshRemoveButtonState()},onAddExtraParameterIconClick:function x(K,J){this._addExtraParameter(J.paramDef,J.addButton,J.configDef,J.ruleConfig,J.paramRenderer,value)},onDeleteExtraParameterIconClick:function l(K,J){J.parentNode.removeChild(J)},onConfigNameSelectChange:function G(K,J){this._createConfigParameterUI({},J)},onAddConfigButtonClick:function g(J,K){this._createConfigUI({},null,K);this._refreshRemoveButtonState()},onRemoveConfigButtonClick:function m(J,K){K.parentNode.removeChild(K);this._refreshRemoveButtonState();this._updateSubmitElements()},onDatePickerMandatoryControlValueUpdated:function p(K,J){var L=this._datePickerConfigDefMap[J[1].id];if(L){this._updateSubmitElements(L)}},_addExtraParameter:function q(S,Q,J,M,K,R){var N=document.createElement("span");Q.parentNode.insertBefore(N,Q);if(this.options.mode==s.MODE_TEXT&&S._type!="hidden"){Q.parentNode.insertBefore(document.createTextNode(", "),N)}var P=K[this.options.mode],L=P.call(this,N,J,S,M,R);b.addClass(L,"param");if(this.options.mode==s.MODE_EDIT&&S._type!="hidden"){var O=document.createElement("span");O.setAttribute("title",this.msg("button.deleteExtraParameter",S.displayLabel?S.displayLabel:S.name));b.addClass(O,"delete-extra-parameter-button");O.innerHTML="-";b.setStyle(O,"width","10px");b.setStyle(O,"height","10px");I.addListener(O,"click",this.onDeleteExtraParameterIconClick,N,this);N.appendChild(O)}this._updateSubmitElements(J)},_toggleDisableOnElements:function A(M,J){for(var L=0,K=M.length;L<K;L++){if(J){M[L].setAttribute("disabled",true)}else{M[L].removeAttribute("disabled")}}},_createSelectMenu:function e(T){var V={};var O=Alfresco.util.deepCopy(this.options.menuMap),ac,ab,Z,M,ae,N,ad;for(var J=1;J<=2;J++){for(var Y=0,R=O.length;Y<R;Y++){ac=O[Y];for(var S=0,aa=ac.length;S<aa;S++){ab=ac[S];for(var K in ab){if(ab.hasOwnProperty(K)){Z=ab[K];M=false;for(var Q in Z){if(K!="_menuItems"&&Z.hasOwnProperty(Q)&&Z[Q].indexOf("*")>-1){M=true;break}}if((J==1&&!M)||(J==2&&M)){if(!ab._menuItems){ab._menuItems=[]}ae=this._getConfigItems(K,Z,T);for(var X=0,W=ae.length;X<W;X++){N=ae[X];ad=N.type+"_"+N.id;if(!V[ad]){ab._menuItems.push(N);V[ad]=true}if(!this._configDefs[ad]){this._configDefs[ad]=N.descriptor}}}}}}}}var U=document.createElement("select"),L,P;U.setAttribute("name","-");b.addClass(U,"config-name");for(Y=0,R=O.length;Y<R;Y++){ac=O[Y];L=null;for(S=0,aa=ac.length;S<aa;S++){ab=ac[S];ae=ab._menuItems;for(X=0,W=ae.length;X<W;X++){if(!L){L=document.createElement("optgroup");U.appendChild(L)}N=ae[X];P=document.createElement("option");P.setAttribute("value",N.id);P.appendChild(document.createTextNode(N.label));P.setAttribute("rel",N.type);L.appendChild(P)}}}return U},_getConfigItems:function o(P,N,O){var M=[],L;if(P==this.options.ruleConfigType){for(var K=0,J=this.options.ruleConfigDefinitions.length;K<J;K++){L=this.options.ruleConfigDefinitions[K];if(Alfresco.util.objectMatchesPattern(L,N)){M.push({id:L.name,type:this.options.ruleConfigType,label:L.displayLabel||L.name,descriptor:L})}}}else{if(P=="item"){M.push({id:N.id,type:"item",label:this.msg("menu.item."+N.id),descriptor:N})}}return M},_getConstraintValues:function D(O,P){var L=this.options.constraints[O.constraint],N;if(O._constraintFilter){N=Alfresco.util.findValueByDotNotation(this.options.constraintsFilter[O.constraint],O._constraintFilter)}if(!L){L=[]}else{if(N){var J=[];for(var M=0,K=L.length;M<K;M++){if(Alfresco.util.arrayContains(N,L[M].value)){J.push(L[M])}}L=J}}return L},_createConfigUI:function t(M,J,L){var K=this._createConfigNameUI(M,J?J:this.widgets.selectTemplateEl.cloneNode(true),L);this._createConfigParameterUI(M,K);return K},_createConfigNameUI:function u(O,Q,K){var P=this.widgets.configTemplateEl.cloneNode(true);Alfresco.util.generateDomId(P);if(K){K.parentNode.insertBefore(P,K.nextSibling)}else{b.get(this.id+"-configs").appendChild(P)}if(!Q.getAttribute("id")){Alfresco.util.generateDomId(Q)}I.addListener(Q,"change",this.onConfigNameSelectChange,P,this);var L=B.query("div.name",P)[0];L.appendChild(Q);if(O.id){P.setAttribute("paramid",O.id)}Alfresco.util.setSelectedIndex(Q,O[this.options.ruleConfigDefinitionKey]);if(this.options.mode==s.MODE_EDIT){var M=B.query("div.actions .add-config",P,true);var R=new YAHOO.widget.Button(M,{type:"push"});R.on("click",this.onAddConfigButtonClick,P,this);R.addClass("add-config");var S=B.query("div.actions .remove-config",P,true);var N=new YAHOO.widget.Button(S,{type:"push",disabled:true});N.on("click",this.onRemoveConfigButtonClick,P,this);N.addClass("remove-config")}else{if(this.options.mode==s.MODE_TEXT){b.addClass(B.query("div.actions",P,true),"hidden");var J=document.createElement("span");b.addClass(Q,"hidden");J.appendChild(document.createTextNode(Q.options[Q.selectedIndex].text));L.appendChild(J);if(this._getCustomisedMessage(this._getSelectedConfigDef(P),O)){b.addClass(B.query("div.name",P,true),"hidden");b.addClass(B.query("div.parameters",P,true),"hidden")}}}return P},_createConfigParameterUI:function E(O,K){K.removeAttribute("id");var L=B.query("div.parameters",K)[0];var T=this._getSelectedConfigDef(K);if(T){T=Alfresco.util.deepCopy(T);T._id=Alfresco.util.generateDomId(K);var X=B.query("select",K)[0],R=X.options[X.selectedIndex],W=this._getConfigCustomisation(R.getAttribute("rel"),T),Q=W?W[this.options.mode]:null;if(!Q||!(W.manual&&W.manual[this.options.mode])){L.innerHTML=""}if(Q){T=Q.call(this,T,O,K,L)}if(T&&T.parameterDefinitions){var M,aa,Z;for(var ac=0,U=T.parameterDefinitions.length;ac<U;ac++){M=T.parameterDefinitions[ac];if(M._type=="hidden"&&this.options.mode==s.MODE_TEXT){continue}aa=this._getParamRenderer(M.type);var S=aa[this.options.mode];Z=O.parameterValues?O.parameterValues[M.name]:null;if(!aa||!S){var N=document.createElement("span");b.addClass(N,"error");N.innerHTML=this.msg("label.noRendererForType",M.type);L.appendChild(N);continue}var ad=document.createElement("span");b.addClass(ad,"menutype_"+R.getAttribute("rel"));b.addClass(ad,"menuname_"+R.value);b.addClass(ad,"paramtype_"+M.type.replace(":","_"));b.addClass(ad,"paramname_"+M.name);L.appendChild(ad);if(aa.manual&&aa.manual[this.options.mode]){S.call(this,ad,T,M,O,Z)}else{var J;if(M.constraint&&this.options.mode==s.MODE_EDIT){var af=this._getConstraintValues(M,O);J=this._createSelect(ad,T,M,af,Z)}else{J=S.call(this,ad,T,M,O,YAHOO.lang.isArray(Z)&&Z.length>0?Z[0]:Z);var Y=document.createElement("span");ad.appendChild(Y);var ab=YAHOO.lang.isArray(Z)?Z.length:-1;for(var ae=1;ae<ab;ae++){this._addExtraParameter(M,Y,T,O,aa,Z[ae])}if(M.isMultiValued&&this.options.mode==s.MODE_EDIT&&M._type!="hidden"){Y.setAttribute("title",this.msg("button.addExtraParameter",M.displayLabel?M.displayLabel:M.name));b.addClass(Y,"add-extra-parameter-button");Y.innerHTML="+";b.setStyle(Y,"width","10px");b.setStyle(Y,"height","10px");I.addListener(Y,"click",this.onAddExtraParameterIconClick,{paramRenderer:aa,paramDef:M,configDef:T,ruleConfig:O,addButton:Y},this)}b.addClass(J,"param")}if(M._type!="hidden"){if(M.displayLabel){this._createLabel(M.displayLabel+(M._hideColon?"":":"),J,M._displayLabelToRight)}if(M._unit){var P=document.createElement("span");b.addClass(P,"unit");P.appendChild(document.createTextNode(M._unit));J.parentNode.appendChild(P)}}}}}if(this.options.mode==s.MODE_TEXT){var V=T._customMessageKey?this.msg(T._customMessageKey):undefined;if(V==T._customMessageKey){V=this._getCustomisedMessage(T,O)}if(V){this._renderByCustomisedMessage(K,V)}}}this._updateSubmitElements(T)},_getCustomisedMessage:function a(L){var J="customise."+L.name+"."+this.options.mode,K=this.msg(J);return K!=J?K:null},_renderByCustomisedMessage:function v(P,N){var Q=document.createElement("div"),S,O,L,J,R,M;b.addClass(Q,"parameters");P.insertBefore(Q,B.query("div.parameters",P,true));if(N){N=N.replace(/''/g,"'")}while(N){S=N.indexOf("{");O=N.indexOf("}");if(S>-1&&O>-1){L=N.substring(0,N.indexOf("{"));J=N.substring(N.indexOf("{")+1,N.indexOf("}"));N=N.substring(N.indexOf("}")+1)}else{L=N;J=null;N=null}if(L){Q.appendChild(document.createTextNode(L))}if(J){if(J.indexOf("param.")==0){M=J.substring(J.indexOf(".")+1);R=B.query("div.parameters span.paramname_"+M+" span",P,true);if(R){var K=document.createElement("span");K.setAttribute("class",R.parentNode.getAttribute("class"));b.removeClass(R,"param");b.addClass(R,"custom-param");K.appendChild(R);Q.appendChild(K)}}else{if(J==("name")){Q.appendChild(B.query("div.name span",P,true))}}}}},_getSelectedConfigDef:function f(K){var M=B.query("select",K)[0];if(M.selectedIndex>-1){var J=M.options[M.selectedIndex];var L=this._configDefs[J.getAttribute("rel")+"_"+J.value];if(L){L._id=K.getAttribute("id");return L}}return null},_getConfigCustomisation:function C(M,J){var P,Q,R,L;for(var O=1;O<=2;O++){for(var N=0,K=this.options.customisationsMap.length;N<K;N++){P=this.options.customisationsMap[N];if(P.hasOwnProperty(M)){Q=P[M];if(YAHOO.lang.isArray(Q)){R=Q[0];L=this._hasWildcard(Q);if((O==1&&!L)||(O==2&&L)){if(Alfresco.util.objectMatchesPattern(J,R)){return this.customisations[Q[1]]}}}}}}return null},_getParamRenderer:function j(J){return this.renderers[J]},_refreshRemoveButtonState:function d(){var M=B.query("li div.actions .remove-config",this.id+"-configs");for(var K=0,J=M.length,L;K<J;K++){L=M[K].getAttribute("id");if(L){YAHOO.widget.Button.getButton(L).set("disabled",K==0&&M.length==1)}}},_hasWildcard:function n(K){for(var J in K){if(K.hasOwnProperty(J)&&K[J]=="*"){return true}}return false},customisations:{},renderers:{"d:any":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:text":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:mltext":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:content":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:int":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[Alfresco.forms.validation.number],L)}},"d:long":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[Alfresco.forms.validation.number],L)}},"d:float":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:double":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:date":{text:function(N,M,J,K,L){return this._createDateSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createDatePicker(N,M,J,[],L,false)}},"d:datetime":{text:function(N,M,J,K,L){return this._createDateSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createDatePicker(N,M,J,[],L,true)}},"d:boolean":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L?this.msg("label.yes"):this.msg("label.no"))},edit:function(N,M,J,K,L){return this._createCheckbox(N,M,J,null,L)}},"d:qname":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:noderef":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[Alfresco.forms.validation.nodeRef],L)}},"d:childassocref":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[Alfresco.forms.validation.nodeRef],L)}},"d:path":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:category":{manual:{edit:true},text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){}},"d:locale":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}},"d:version":{text:function(N,M,J,K,L){return this._createValueSpan(N,M,J,K,L)},edit:function(N,M,J,K,L){return this._createInputText(N,M,J,[],L)}}},_createInputText:function(N,M,K,J,L){if(K._type=="hidden"){return this._createInputOfType(N,M,K,J,L,"hidden")}else{return this._createInputOfType(N,M,K,J,L,"text")}},_createInputOfType:function(N,J,R,L,Q,O){var K=document.createElement("input");K.setAttribute("type",O);K.setAttribute("name","-");K.setAttribute("title",R.displayLabel?R.displayLabel:R.name);K.setAttribute("param",R.name);K.setAttribute("value",(Q!=undefined&&Q!=null)?Q:"");N.appendChild(K);if(R.isMandatory){this._addValidation(K,Alfresco.forms.validation.mandatory,J)}for(var M=0,P=L?L.length:0;M<P;M++){this._addValidation(K,L[M],J)}return K},_createLabel:function(M,L,J){if(M&&L){var N=L.getAttribute("id")?L.getAttribute("id"):Alfresco.util.generateDomId(L),K=document.createElement("label");K.setAttribute("for",N);K.appendChild(document.createTextNode(M));if(J){L.parentNode.appendChild(K)}else{L.parentNode.insertBefore(K,L)}return K}},_createSelect:function(P,J,S,L,R){if(S._type=="hidden"){return this._createInputOfType(P,J,S,[],R,"hidden")}else{var K=document.createElement("select");K.setAttribute("name","-");K.setAttribute("title",S.displayLabel?S.displayLabel:S.name);K.setAttribute("param",S.name);if(S.isMultiValued){K.setAttribute("multiple","true");K.setAttribute("size","3")}if(P){P.appendChild(K)}if(!S.isMandatory||!L||L.length==0){K.appendChild(document.createElement("option"))}if(S.isMandatory){this._addValidation(K,Alfresco.forms.validation.mandatory,J,"change")}if(L){var Q,O;for(var N=0,M=L.length;N<M;N++){Q=L[N];O=document.createElement("option");O.setAttribute("value",Q.value);O.appendChild(document.createTextNode(Q.displayLabel?Q.displayLabel:Q.value));if(Q.value==R){O.setAttribute("selected","true")}K.appendChild(O)}}return K}},_createCheckbox:function(O,N,K,M,L){if(K._type=="hidden"){return this._createInputOfType(O,N,K,[],L,"hidden")}else{var J=document.createElement("input");J.type="checkbox";J.value="";J.setAttribute("name","-");J.setAttribute("title",K.displayLabel?K.displayLabel:K.name);J.setAttribute("param",K.name);if(O){O.appendChild(J)}J.checked=YAHOO.lang.isBoolean(L)?L:false;return J}},_createDatePicker:function(P,J,W,M,V,Z){if(W._type=="hidden"){return this._createInputOfType(P,J,W,[],"hidden")}else{var L=this._createInputOfType(P,J,W,[],V,"hidden"),K=L.getAttribute("id")?L.getAttribute("id"):Alfresco.util.generateDomId(L);P.appendChild(L);var O=document.createElement("span");b.setStyle(O,"position","relative");var S=document.createElement("div"),R=Alfresco.util.generateDomId(S);b.addClass(S,"datepicker");var X=document.createElement("a");Alfresco.util.setDomId(X,R+"-icon");var U=document.createElement("img");U.setAttribute("src",Alfresco.constants.URL_RESCONTEXT+"components/form/images/calendar.png");b.addClass(U,"datepicker-icon");X.appendChild(U);var N=document.createElement("input");N.setAttribute("name","-");N.setAttribute("title",W.displayLabel?W.displayLabel:W.name);N.setAttribute("type","text");b.addClass(N,"datepicker-date");Alfresco.util.setDomId(N,R+"-date");P.appendChild(N);if(Z){var Q=document.createElement("input");Q.setAttribute("name","-");Q.setAttribute("type","text");b.addClass(Q,"datepicker-time");Alfresco.util.setDomId(Q,R+"-time");P.appendChild(Q)}P.appendChild(X);P.appendChild(O);O.appendChild(S);var Y={showTime:Z,mandatory:W.isMandatory,currentValue:(V&&V!="")?V:null};var T=new Alfresco.DatePicker(R,K).setOptions(Y).setMessages({"form.control.date-picker.choose":"","form.control.date-picker.entry.date.format":this.msg("form.control.date-picker.entry.date.format"),"form.control.date-picker.display.date.format":this.msg("form.control.date-picker.display.date.format"),"form.control.date-picker.entry.time.format":this.msg("form.control.date-picker.entry.time.format"),"form.control.date-picker.display.time.format":this.msg("form.control.date-picker.display.time.format")});this._datePickerConfigDefMap[T.id]=J;return L}},_createButton:function(P,O,L,N,M){var J=document.createElement("button");Alfresco.util.generateDomId(J);P.appendChild(J);var K=new YAHOO.widget.Button(J,{type:"button",label:L._buttonLabel});K.on("click",M,{configDef:O,ruleConfig:N,paramDef:L,containerEl:P},this);return K},_createValueSpan:function h(P,J,S,L,R,O){var K=document.createElement("span");if(R&&S._type!="hidden"){if(S.constraint){var T=this._getConstraintValues(S,L);for(var N=0,Q=T.length;N<Q;N++){if(T[N].value==R){R=T[N].displayLabel?T[N].displayLabel:R;break}}}if(S.type="d:noderef"&&S._type=="path"){return this._createPathSpan(P,J,S,this.id+"-"+J._id+"-"+S.name,R)}else{if(S.type="d:noderef"&&S._type=="category"){return this._createCategorySpan(P,J,S,this.id+"-"+J._id+"-"+S.name,R)}}if(O){var M=this.msg(O,R);R=M!=O?M:R}K.appendChild(document.createTextNode(R))}P.appendChild(K);return K},_createDateSpan:function z(N,M,J,K,L,O){L=Alfresco.util.formatDate(Alfresco.util.fromISO8601(L));return this._createValueSpan(N,M,J,K,L,O)},_createCategorySpan:function(N,M,K,O,L){var J=L?Alfresco.constants.PROXY_URI+"api/forms/picker/items":null;return this._createResolvableValueSpan(N,O,Alfresco.util.Ajax.POST,J,{items:[L]},function(P){var Q=P.data.items[0];return y(Q.name)})},_createPathSpan:function(N,M,K,O,L){var J=document.createElement("span");Alfresco.util.setDomId(J,O);N.appendChild(J);new Alfresco.Location(J).setOptions({siteId:this.options.siteId,rootNode:this.options.rootNode}).displayByNodeRef(L);return J},_createResolvableValueSpan:function(O,Q,P,M,K,N){var J=document.createElement("span");Alfresco.util.setDomId(J,Q);if(M){J.innerHTML=this.msg("message.loading");var L={method:P,url:M,successCallback:{fn:function(R,S){S.pathEl.innerHTML=S.displayValueHandler.call(this,R.json)},obj:{pathEl:J,displayValueHandler:N},scope:this},failureCallback:{fn:function(R,S){S.pathEl.innerHTML=this.msg("message.failure")},obj:{pathEl:J,displayValueHandler:N},scope:this}};if(K){L.dataObj=K}Alfresco.util.Ajax.jsonRequest(L)}else{J.innerHTML=this.msg("label.none")}O.appendChild(J);return J},_addValidation:function(K,J,M,L){if(K&&J&&this.options.form){var O=K.getAttribute("id")?K.getAttribute("id"):Alfresco.util.generateDomId(K),N={configDef:M,me:this,handler:J};this.options.form.addValidation(O,function(V,Q,U,T,P,S){var R=Q.handler(V,Q,U,T,P,S);if(!R){YAHOO.util.Dom.addClass(Q.configDef._id,"invalid")}else{if(R&&YAHOO.util.Dom.hasClass(Q.configDef._id,"invalid")){if(Q.me._validateConfigDef(Q.configDef)){YAHOO.util.Dom.removeClass(Q.configDef._id,"invalid")}}}return R},N,L?L:"keyup");if(!M._validations){M._validations=[]}M._validations.push({fieldId:O,args:N,handler:J})}},_updateSubmitElements:function(J){if(this.options.form){if(J){if(this._validateConfigDef(J)){b.removeClass(J._id,"invalid")}else{b.addClass(J._id,"invalid")}}this.options.form.updateSubmitElements()}},_validateConfigDef:function(N){if(YAHOO.lang.isArray(N._validations)){for(var L=0,K=N._validations.length,J;L<K;L++){J=N._validations[L];var M=b.get(J.fieldId);if(!M.disabled&&!J.handler(M,J.args,"keyup",this,true,null)){return false}}}return true},_getParameters:function(J){var K=B.query("[param]",J._id),O={},L,S,M,U,N;for(var R=0,T=K.length;R<T;R++){L=K[R];S=L.getAttribute("param");M=this._getValue(L,U);U=this._getParamDef(J,S);if(U){if(U.isMultiValued&&M&&!YAHOO.lang.isArray(M)){M=[M]}if(YAHOO.lang.isArray(M)){for(var P=0,Q=M;P<Q;P++){M[P]=this._convertType(M[P],U.type)}}else{M=this._convertType(M,U.type)}N=O[S];if(YAHOO.lang.isArray(N)){if(YAHOO.lang.isArray(M)){M=N.concat(M)}else{if(M!=null){M=N.push(M)}}}if(S&&M!=undefined&&M!=null){O[S]=M}}}return O},_convertType:function(K,J){if(K){if(Alfresco.util.arrayContains(["d:int","d:long"],J)){return parseInt(K)}else{if(Alfresco.util.arrayContains(["d:float","d:double"],J)){return parseFloat(K)}else{if(Alfresco.util.arrayContains(["d:boolean"],J)){if(K.toLowerCase()=="true"){return true}else{if(K.toLowerCase()=="false"){return false}}}}}}return K},_getValue:function(N){var M=N.tagName.toLowerCase();if(M=="select"){if(N.getAttribute("multiple")!="true"){return N.options[N.selectedIndex].value}else{var K=[];for(var L=0,J=N.options.length;L<J;L++){if(N.options[L].selected){K.push(N.options[L].value)}}return K}}else{if(M=="input"&&(N.type=="checkbox"||N.type=="radio")){if(!N.value||N.value.length==0){return N.checked?"true":"false"}}}return N.value&&N.value.length>0?N.value:null},_getParamDef:function(M,N){if(M.parameterDefinitions){for(var L=0,J=M.parameterDefinitions.length,K;L<J;L++){K=M.parameterDefinitions[L];if(K.name==N){return K}}}return null},_setHiddenParameter:function(J,N,Q,P){var K=B.query("[param="+Q+"]",J._id),V=this._getParamDef(J,Q);if(V.isMultiValued&&YAHOO.lang.isArray(P)){for(var S=K.length,L=P.length,U;S>L;i--){U=K.pop();U.parentNode.removeChild(U)}for(var T=0,M=P.length,O,R=K.length;T<M;T++){if(T>=R){O=this._getParamRenderer(V.type)[this.options.mode].call(this,K[0].parentNode,J,V,N,P[T]);b.addClass(O,"param")}else{K[T].value=P[T]}}}else{K[0].value=P}},_hideParameters:function(M){if(M){for(var L=0,J=M.length,K;L<J;L++){K=M[L];K._type="hidden"}}},_setParameter:function(K,J,L){if(!K.parameterValues){K.parameterValues={}}K.parameterValues[J]=L}})})();