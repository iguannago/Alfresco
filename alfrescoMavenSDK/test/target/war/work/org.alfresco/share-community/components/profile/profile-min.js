(function(){var f=YAHOO.util.Dom,j=YAHOO.util.Event,c=YAHOO.util.Element;Alfresco.UserProfile=function(l){Alfresco.UserProfile.superclass.constructor.call(this,"Alfresco.UserProfile",l,["button"]);return this};YAHOO.extend(Alfresco.UserProfile,Alfresco.component.Base,{options:{userId:"",profile:{}},fileUpload:null,onReady:function a(){if(this.options.profile.isEditable){this.widgets.upload=Alfresco.util.createYUIButton(this,"button-upload",this.onUpload);this.widgets.clearphoto=Alfresco.util.createYUIButton(this,"button-clearphoto",this.onClearPhoto);this.widgets.edit=Alfresco.util.createYUIButton(this,"button-edit",this.onEditProfile);this.widgets.save=Alfresco.util.createYUIButton(this,"button-save",null,{type:"submit"});this.widgets.cancel=Alfresco.util.createYUIButton(this,"button-cancel",this.onCancel);var l=new Alfresco.forms.Form(this.id+"-form");this.widgets.form=l;l.setSubmitElements(this.widgets.save);l.setShowSubmitStateDynamically(true);l.setSubmitAsJSON(true);l.setAJAXSubmit(true,{successCallback:{fn:this.onSuccess,scope:this}});l.addValidation(this.id+"-input-firstName",Alfresco.forms.validation.mandatory,null,"keyup");l.init()}if(this.options.profile.isEditable&&window.location.hash=="#edit"){this.onEditProfile()}else{f.removeClass(this.id+"-readview","hidden")}},onEditProfile:function k(n,o){f.addClass(this.id+"-readview","hidden");var m=this.options.profile,l=this.id+"-input-";f.get(l+"lastName").value=m.lastName;f.get(l+"firstName").value=m.firstName;f.get(l+"jobtitle").value=m.jobtitle;f.get(l+"location").value=m.location;f.get(l+"bio").value=m.bio;f.get(l+"telephone").value=m.telephone;f.get(l+"mobile").value=m.mobile;f.get(l+"email").value=m.email;f.get(l+"skype").value=m.skype;f.get(l+"instantmsg").value=m.instantmsg;f.get(l+"googleusername").value=m.googleusername;f.get(l+"organization").value=m.organization;f.get(l+"companyaddress1").value=m.companyaddress1;f.get(l+"companyaddress2").value=m.companyaddress2;f.get(l+"companyaddress3").value=m.companyaddress3;f.get(l+"companypostcode").value=m.companypostcode;f.get(l+"companytelephone").value=m.companytelephone;f.get(l+"companyfax").value=m.companyfax;f.get(l+"companyemail").value=m.companyemail;this.widgets.form.updateSubmitElements();f.removeClass(this.id+"-editview","hidden")},onUpload:function h(m,n){if(this.fileUpload===null){this.fileUpload=Alfresco.getFileUploadInstance()}var l={flashUploadURL:"slingshot/profile/uploadavatar",htmlUploadURL:"slingshot/profile/uploadavatar.html",username:this.options.userId,mode:this.fileUpload.MODE_SINGLE_UPLOAD,onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};this.fileUpload.show(l);j.preventDefault(m)},onClearPhoto:function d(l,m){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"slingshot/profile/resetavatar/"+encodeURIComponent(this.options.userId),method:Alfresco.util.Ajax.PUT,requestContentType:Alfresco.util.Ajax.JSON,successCallback:{fn:function(n){var o=f.getElementsByClassName("photoimg","img");for(i in o){o[i].src=Alfresco.constants.URL_RESCONTEXT+"components/images/no-user-photo-64.png"}},scope:this}})},onFileUploadComplete:function e(l){var p=l.successful.length;if(p>0){var o=l.successful[0].nodeRef;var q=f.getElementsByClassName("photoimg","img");for(i in q){q[i].src=Alfresco.constants.PROXY_URI+"api/node/"+o.replace("://","/")+"/content/thumbnails/avatar?c=force"}var n={};n[this.id+"-photoref"]=o;var m={method:"POST",url:f.get(this.id+"-form").attributes.action.nodeValue,dataObj:n};Alfresco.util.Ajax.jsonRequest(m)}},onSuccess:function b(l){if(l){if(window.location.hash=="#edit"){window.location=window.location.href.replace(/#.*/,"")}else{location.reload(true)}}else{Alfresco.util.PopupManager.displayPrompt({text:Alfresco.util.message("message.failure",this.name)})}},onCancel:function g(l,m){f.addClass(this.id+"-editview","hidden");f.removeClass(this.id+"-readview","hidden")}})})();