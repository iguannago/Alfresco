(function(){Alfresco.module.DoclibActions=function(){this.name="Alfresco.module.DoclibActions";Alfresco.util.YUILoaderHelper.require(["json"],this.onComponentsLoaded,this);return this};Alfresco.module.DoclibActions.prototype={isReady:false,defaultConfig:{method:"POST",urlStem:Alfresco.constants.PROXY_URI+"slingshot/doclib/action/",dataObj:null,successCallback:null,successMessage:null,failureCallback:null,failureMessage:null,object:null},onComponentsLoaded:function e(){this.isReady=true},_runAction:function b(f,g){if(!this.isReady){return false}if(typeof g=="object"){f=YAHOO.lang.merge(f,g)}if(f.method==Alfresco.util.Ajax.DELETE){if(f.dataObj!==null){f.method=Alfresco.util.Ajax.POST;if(f.url.indexOf("alf_method")<1){f.url+=(f.url.indexOf("?")<0?"?":"&")+"alf_method=delete"}Alfresco.util.Ajax.jsonRequest(f)}else{Alfresco.util.Ajax.request(f)}}else{Alfresco.util.Ajax.jsonRequest(f)}},genericAction:function a(m){var s="",r=m.success,h=m.failure,g=m.webscript,l=m.params?m.params:m.webscript.params,k=m.config,o=m.wait,j=null,p=this;if(m.params){Alfresco.logger.warn("Alfresco.module.DoclibActions.genericAction()","action.params deprecated. Use action.webscript.params instead.")}var n=function q(v,w){if(w){if(w.activity!==undefined){p.postActivity(w.activity.siteId,w.activity.activityType,w.activity.page,w.activity.activityData)}if(w.event&&w.event.name){YAHOO.Bubbling.fire(w.event.name,w.event.obj)}if(YAHOO.lang.isArray(w.events)){for(var t=0,u=w.events.length;t<u;t++){YAHOO.Bubbling.fire(w.events[t].name,w.events[t].obj)}}if(w.popup){w.popup.destroy()}if(w.message){Alfresco.util.PopupManager.displayMessage({text:w.message})}if(w.callback&&w.callback.fn){w.callback.fn.call((typeof w.callback.scope=="object"?w.callback.scope:this),{config:v.config,json:v.json,serverResponse:v.serverResponse},w.callback.obj)}}};if(o&&o.message){if(typeof r!="object"){r={}}if(typeof h!="object"){h={}}r.popup=Alfresco.util.PopupManager.displayMessage({modal:true,displayTime:0,text:o.message,effect:null});h.popup=r.popup}var f;if(g.stem){f=g.stem+g.name}else{f=this.defaultConfig.urlStem+g.name}if(l){f=YAHOO.lang.substitute(f,l);j=l}if(g.queryString){f+="?"+g.queryString}var i=YAHOO.lang.merge(this.defaultConfig,{successCallback:{fn:n,scope:this,obj:r},successMessage:null,failureCallback:{fn:n,scope:this,obj:h},failureMessage:null,url:f,method:g.method,responseContentType:Alfresco.util.Ajax.JSON,object:j});return this._runAction(i,k)},postActivity:function d(k,f,i,h){if(!Alfresco.util.isValueSet(k)){return}var g={method:"POST",url:Alfresco.constants.PROXY_URI+"slingshot/doclib/activity",successCallback:null,successMessage:null,failureCallback:null,failureMessage:null,object:null};g.dataObj=YAHOO.lang.merge({site:k,type:f,page:i},h);Alfresco.logger.debug("Alfresco.module.DoclibActions.postActivity: ",g.dataObj);try{Alfresco.util.Ajax.jsonRequest(g)}catch(j){}}};var c=new Alfresco.module.DoclibActions()})();